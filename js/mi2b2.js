/*! dicom-parser - v1.0.1 - 2015-04-06 | (c) 2014 Chris Hafey | https://github.com/chafey/dicomParser */

/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 * 
 *      "Free software" is a matter of liberty, not price.
 *      "Free" as in "free speech", not as in "free beer".
 *                                         - Richard M. Stallman
 * 
 * FUELED BY:
 *  - the wonderful Constructive Solid Geometry library by Evan Wallace (http://madebyevan.com)
 *    LICENSE: https://raw.github.com/xtk/X/master/lib/csg/LICENSE
 *
 *  - parts of the Google Closure Library (http://code.google.com/closure/library)
 *    LICENSE: https://raw.github.com/xtk/google-closure-library/master/LICENSE
 *
 *  - zlib.js, the ultimate gzip/zlib javascript implementation (https://github.com/imaya/zlib.js)
 *    LICENSE: https://raw.github.com/imaya/zlib.js/master/LICENSE
 *
 * MORE CREDITS: https://raw.github.com/xtk/X/master/LICENSE
 *
 */

function m(e){throw e}function aa(){return function(){}}function ca(e){return function(t){this[e]=t}}function v(e){return function(){return this[e]}}function ga(){}function ha(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t}function ia(e){return e!==p}function la(e){return"array"==ha(e)}function ma(e){var t=ha(e);return"array"==t||"object"==t&&"number"==typeof e.length}function na(e){return"string"==typeof e}function x(e){return"number"==typeof e}function oa(e){return"function"==ha(e)}function pa(e){var n=typeof e;return"object"==n&&e!=t||"function"==n}function qa(e){return e[ra]||(e[ra]=++sa)}function ta(e,t,n){return e.call.apply(e.bind,arguments)}function ua(e,t,n){e||m(Error());if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function va(e,n,r){return va=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ta:ua,va.apply(t,arguments)}function wa(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=Array.prototype.slice.call(arguments);return t.unshift.apply(t,n),e.apply(this,t)}}function A(e,t){var n=e.split("."),r=fa;!(n[0]in r)&&r.execScript&&r.execScript("var "+n[0]);for(var i;n.length&&(i=n.shift());)!n.length&&ia(t)?r[i]=t:r=r[i]?r[i]:r[i]={}}function C(e,t){function n(){}n.prototype=t.prototype,e.u=t.prototype,e.prototype=new n,e.prototype.constructor=e}function ya(e,t,n){this.Za=this.Ya=this.Xa=0,3==arguments.length?(this.Xa=Number(e),this.Ya=Number(t),this.Za=Number(n)):e instanceof ya?(this.Xa=Number(e.x()),this.Ya=Number(e.y()),this.Za=Number(e.d())):(this.Xa=Number(e[0]),this.Ya=Number(e[1]),this.Za=Number(e[2]))}function Da(e){var t=e.length();return new ya(e.Xa/t,e.Ya/t,e.Za/t)}function Aa(e,t){return new ya(e.Xa*t,e.Ya*t,e.Za*t)}function Ca(e,t){return new ya(e.Xa-t.x(),e.Ya-t.y(),e.Za-t.d())}function za(e,t){return new ya(e.Xa+t.x(),e.Ya+t.y(),e.Za+t.d())}function Ea(e){return new ya(-e.Xa,-e.Ya,-e.Za)}function Fa(e,t){for(var n in t){var r=t.__lookupGetter__(n),i=t.__lookupSetter__(n);n in e||(r||i?(r&&e.__defineGetter__(n,r),i&&e.__defineSetter__(n,i)):e[n]=t[n])}}function Ma(){}function Na(e,t){for(var n in e)t.call(p,e[n],n,e)}function Oa(e){var t=[],n=0,r;for(r in e)t[n++]=e[r];return t}function Qa(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var s=0;s<Pa.length;s++)n=Pa[s],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Ra(e){return Sa.test(e)?(-1!=e.indexOf("&")&&(e=e.replace(Ta,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(Ua,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(Va,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(Wa,"&quot;")),e):e}function eb(){return fa.navigator?fa.navigator.userAgent:t}function fb(){return fa.navigator}function rb(){var e=fa.document;return e?e.documentMode:p}function Cb(e){var t;if(!(t=Bb[e])){t=0;for(var n=String(sb).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),r=String(e).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),i=Math.max(n.length,r.length),s=0;0==t&&s<i;s++){var o=n[s]||"",u=r[s]||"",a=RegExp("(\\d*)(\\D*)","g"),f=RegExp("(\\d*)(\\D*)","g");do{var l=a.exec(o)||["","",""],c=f.exec(u)||["","",""];if(0==l[0].length&&0==c[0].length)break;t=((0==l[1].length?0:parseInt(l[1],10))<(0==c[1].length?0:parseInt(c[1],10))?-1:(0==l[1].length?0:parseInt(l[1],10))>(0==c[1].length?0:parseInt(c[1],10))?1:0)||((0==l[2].length)<(0==c[2].length)?-1:(0==l[2].length)>(0==c[2].length)?1:0)||(l[2]<c[2]?-1:l[2]>c[2]?1:0)}while(0==t)}t=Bb[e]=0<=t}return t}function Nb(e,t){var n=Ib(e,t);0<=n&&Hb.splice.call(e,n,1)}function Ob(e,t,n){return 2>=arguments.length?Hb.slice.call(e,t):Hb.slice.call(e,t,n)}function Pb(){0!=Qb&&(this.xl=Error().stack,qa(this))}function Rb(e,t){this.type=e,this.currentTarget=this.target=t}function Sb(e){return Sb[" "](e),e}function Tb(e,t){e&&this.Ca(e,t)}function L(e,n,r,i,s){if(la(n)){for(var o=0;o<n.length;o++)L(e,n[o],r,i,s);return t}return e=Yb(e,n,r,u,i,s),n=e.key,Ub[n]=e,n}function Yb(e,t,n,r,i,s){t||m(Error("Invalid event type")),i=!!i;var o=Vb;t in o||(o[t]={oa:0,Na:0}),o=o[t],i in o||(o[i]={oa:0,Na:0},o.oa++);var o=o[i],a=qa(e),f;o.Na++;if(o[a]){f=o[a];for(var l=0;l<f.length;l++)if(o=f[l],o.bc==n&&o.tf==s){if(o.xc)break;return r||(f[l].ie=u),f[l]}}else f=o[a]=[],o.oa++;var c=Zb,h=Fb?function(e){return c.call(h.src,h.bc,e)}:function(e){e=c.call(h.src,h.bc,e);if(!e)return e},l=h,o=new Ma;return o.Ca(n,l,e,t,i,s),o.ie=r,l.src=e,l.bc=o,f.push(o),Wb[a]||(Wb[a]=[]),Wb[a].push(o),e.addEventListener?(e==fa||!e.customEvent_)&&e.addEventListener(t,l,i):e.attachEvent(t in Xb?Xb[t]:Xb[t]="on"+t,l),o}function $b(e,t,n,r,i){if(la(t))for(var s=0;s<t.length;s++)$b(e,t[s],n,r,i);else e=Yb(e,t,n,q,r,i),Ub[e.key]=e}function ac(e,n,r,i,s){if(la(n))for(var o=0;o<n.length;o++)ac(e,n[o],r,i,s);else{i=!!i;e:{o=Vb;if(n in o&&(o=o[n],i in o&&(o=o[i],e=qa(e),o[e]))){e=o[e];break e}e=t}if(e)for(o=0;o<e.length;o++)if(e[o].bc==r&&e[o].capture==i&&e[o].tf==s){bc(e[o].key);break}}}function bc(e){var t=Ub[e];if(!t||t.xc)return u;var n=t.src,r=t.type,i=t.oh,s=t.capture;n.removeEventListener?(n==fa||!n.customEvent_)&&n.removeEventListener(r,i,s):n.detachEvent&&n.detachEvent(r in Xb?Xb[r]:Xb[r]="on"+r,i),n=qa(n),Wb[n]&&(i=Wb[n],Nb(i,t),0==i.length&&delete Wb[n]),t.xc=q;if(t=Vb[r][s][n])t.fh=q,cc(r,s,n,t);return delete Ub[e],q}function cc(e,n,r,i){if(!i.te&&i.fh){for(var s=0,o=0;s<i.length;s++)i[s].xc?i[s].oh.src=t:(s!=o&&(i[o]=i[s]),o++);i.length=o,i.fh=u,0==o&&(delete Vb[e][n][r],Vb[e][n].oa--,0==Vb[e][n].oa&&(delete Vb[e][n],Vb[e].oa--),0==Vb[e].oa&&delete Vb[e])}}function dc(e){var n=0;if(e!=t){if(e=qa(e),Wb[e]){e=Wb[e];for(var r=e.length-1;0<=r;r--)bc(e[r].key),n++}}else Na(Ub,function(e,t){bc(t),n++})}function ec(e,t){var n=qa(e),r=Wb[n];if(r){var i=ia(t),s=ia(p);return i&&s?(r=Vb[t],!!r&&!!r[p]&&n in r[p]):!i&&!s?q:Mb(r,function(e){return i&&e.type==t||s&&e.capture==p})}return u}function fc(e,t,n,r,i){var s=1;t=qa(t);if(e[t]){var o=--e.Na,a=e[t];a.te?a.te++:a.te=1;try{for(var f=a.length,l=0;l<f;l++){var c=a[l];c&&!c.xc&&(s&=gc(c,i)!==u)}}finally{e.Na=Math.max(o,e.Na),a.te--,cc(n,r,t,a)}}return Boolean(s)}function gc(e,t){return e.ie&&bc(e.key),e.handleEvent(t)}function Zb(e,n){if(e.xc)return q;var r=e.type,i=Vb;if(r in i){var i=i[r],s,o;if(!Fb){var a;if(!(a=n))e:{a=["window","event"];for(var f=fa;s=a.shift();){if(f[s]==t){a=t;break e}f=f[s]}a=f}s=a,a=q in i,f=u in i;if(a){if(0>s.keyCode||s.returnValue!=p)return q;e:{var l=u;if(0==s.keyCode)try{s.keyCode=-1;break e}catch(c){l=q}if(l||s.returnValue==p)s.returnValue=q}}l=new Tb,l.Ca(s,this),s=q;try{if(a){for(var h=[],d=l.currentTarget;d;d=d.parentNode)h.push(d);o=i[q],o.Na=o.oa;for(var v=h.length-1;!l.wc&&0<=v&&o.Na;v--)l.currentTarget=h[v],s&=fc(o,h[v],r,q,l);if(f){o=i[u],o.Na=o.oa;for(v=0;!l.wc&&v<h.length&&o.Na;v++)l.currentTarget=h[v],s&=fc(o,h[v],r,u,l)}}else s=gc(e,l)}finally{h&&(h.length=0)}return s}return r=new Tb(n,this),s=gc(e,r)}return q}function ic(e){return e+"_"+hc++}function jc(){Pb.call(this),this.Bl={},this.ul=this}function M(){jc.call(this),this.f="base",this.qa=window["X.counter"].qk(),this.j=u}function kc(e,t){this.Wa=new ya(e),this.va=new ya(t)}function lc(e,t){this.va=e,this.Pd=t}function mc(e,t){this.Lb=e,this.De=t;var n=e[0].Wa,r=e[2].Wa,r=Da(Ca(e[1].Wa,n).sc(Ca(r,n)));this.Va=new lc(r,r.ac(n))}function nc(e,t,n,r,i,s){for(var o=0,u=[],a=0;a<e.Lb.length;a++){var f=t.va.ac(e.Lb[a].Wa)-t.Pd,f=-0.00001>f?2:1e-5<f?1:0,o=o|f;u.push(f)}switch(o){case 0:(0<t.va.ac(e.Va.va)?n:r).push(e);break;case 1:i.push(e);break;case 2:s.push(e);break;case 3:n=[],r=[];for(a=0;a<e.Lb.length;a++){var l=(a+1)%e.Lb.length,f=u[a],c=u[l],o=e.Lb[a],l=e.Lb[l];2!=f&&n.push(o),1!=f&&r.push(2!=f?o.l():o),3==(f|c)&&(f=(t.Pd-t.va.ac(o.Wa))/t.va.ac(Ca(l.Wa,o.Wa)),f=new kc(o.Wa.se(l.Wa,f),o.va.se(l.va,f)),n.push(f),r.push(f.l()))}3<=n.length&&i.push(new mc(n,e.De)),3<=r.length&&s.push(new mc(r,e.De))}}function oc(e){this.Aa=this.Ba=this.Va=t,this.Z=[],e&&pc(this,e)}function pc(e,t){if(t.length){e.Va||(e.Va=t[0].Va.l());for(var n=[],r=[],i=0;i<t.length;i++)nc(t[i],e.Va,e.Z,e.Z,n,r);n.length&&(e.Ba||(e.Ba=new oc),pc(e.Ba,n)),r.length&&(e.Aa||(e.Aa=new oc),pc(e.Aa,r))}}function qc(e){var t=e.Z.slice();return e.Ba&&(t=t.concat(qc(e.Ba))),e.Aa&&(t=t.concat(qc(e.Aa))),t}function rc(e,t){e.Z=sc(t,e.Z),e.Ba&&rc(e.Ba,t),e.Aa&&rc(e.Aa,t)}function sc(e,t){if(!e.Va)return t.slice();for(var n=[],r=[],i=0;i<t.length;i++)nc(t[i],e.Va,n,r,n,r);return e.Ba&&(n=sc(e.Ba,n)),r=e.Aa?sc(e.Aa,r):[],n.concat(r)}function tc(){this.Z=[]}function uc(e){var t=new tc;return t.Ce(e),t}function vc(){M.call(this),this.f="indexer",this.bf=[],this.pl=[],this.Ka={}}function wc(e){M.call(this),this.f="file",this.$d=e,this.j=q}function xc(){this.$a=this.r=t}function yc(e){if("function"==typeof e.Dd)return e.Dd();if(na(e))return e.split("");if(ma(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}return Oa(e)}function zc(e,t){this.ga={},this.S=[];var n=arguments.length;if(1<n){n%2&&m(Error("Uneven number of arguments"));for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else e&&this.df(e)}function Bc(e){for(var t=0;t<e.S.length;t++){var n=e.S[t];if(Cc(e.ga,n)&&e.ga[n]==u)return q}return u}function Ac(e){if(e.oa!=e.S.length){for(var t=0,n=0;t<e.S.length;){var r=e.S[t];Cc(e.ga,r)&&(e.S[n++]=r),t++}e.S.length=n}if(e.oa!=e.S.length){for(var i={},n=t=0;t<e.S.length;)r=e.S[t],Cc(i,r)||(e.S[n++]=r,i[r]=1),t++;e.S.length=n}}function Cc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Dc(){M.call(this),this.f="colortable",this.Ka=new zc,Fa(this,new xc)}function Ec(e,t,n){this.x=ia(e)?e:0,this.y=ia(t)?t:0,this.d=ia(n)?n:0}function R(e,t,n){this.x=e,this.y=t,this.d=n}function Fc(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.d-t.d;return Math.sqrt(n*n+r*r+i*i)}function Gc(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.d-t.d;return n*n+r*r+i*i}function Hc(e,t){return new R(e.x+t.x,e.y+t.y,e.d+t.d)}function Ic(e,t){return new R(e.y*t.d-e.d*t.y,e.d*t.x-e.x*t.d,e.x*t.y-e.y*t.x)}function Jc(e){this.length=e.length||e;for(var t=0;t<this.length;t++)this[t]=e[t]||0}function Lc(e){this.length=e.length||e;for(var t=0;t<this.length;t++)this[t]=e[t]||0}function Mc(){return new Float32Array(3)}function Nc(e,t,n){var r=Mc();return r[0]=e,r[1]=t,r[2]=n,r}function Oc(e,t){var n=e[0],r=e[1],i=e[2],n=1/Math.sqrt(n*n+r*r+i*i);t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}function Pc(){return new Float32Array(4)}function Qc(e,t,n,r){var i=Pc();return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Rc(){return new Float32Array(16)}function Sc(){var e=Rc();return e[0]=e[5]=e[10]=e[15]=1,e}function Tc(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=o,e[6]=u,e[7]=a,e[8]=f,e[9]=l,e[10]=c,e[11]=h,e[12]=p,e[13]=d,e[14]=v,e[15]=m,e}function Uc(e,t,n,r,i){return e[12]=t,e[13]=n,e[14]=r,e[15]=i,e}function Vc(e,t,n){t*=4,e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3]}function Wc(e,t,n){t*=4,n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3]}function T(e,t,n,r,i,s){e[t]=n,e[t+4]=r,e[t+8]=i,e[t+12]=s}function Xc(e,t,n){e[t]=n[0],e[t+4]=n[1],e[t+8]=n[2],e[t+12]=n[3]}function Yc(e,t,n){n[0]=e[t],n[1]=e[t+4],n[2]=e[t+8],n[3]=e[t+12]}function $c(e,t,n){var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14];e=e[15];var y=t[0],b=t[1],w=t[2],E=t[3],S=t[4],x=t[5],T=t[6],N=t[7],C=t[8],k=t[9],L=t[10],A=t[11],O=t[12],M=t[13],_=t[14];return t=t[15],n[0]=r*y+u*b+c*w+v*E,n[1]=i*y+a*b+h*w+m*E,n[2]=s*y+f*b+p*w+g*E,n[3]=o*y+l*b+d*w+e*E,n[4]=r*S+u*x+c*T+v*N,n[5]=i*S+a*x+h*T+m*N,n[6]=s*S+f*x+p*T+g*N,n[7]=o*S+l*x+d*T+e*N,n[8]=r*C+u*k+c*L+v*A,n[9]=i*C+a*k+h*L+m*A,n[10]=s*C+f*k+p*L+g*A,n[11]=o*C+l*k+d*L+e*A,n[12]=r*O+u*M+c*_+v*t,n[13]=i*O+a*M+h*_+m*t,n[14]=s*O+f*M+p*_+g*t,n[15]=o*O+l*M+d*_+e*t,n}function ad(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=n*a-r*o,w=n*f-i*o,E=n*l-s*o,S=r*f-i*a,x=r*l-s*a,T=i*l-s*f,N=c*m-h*v,C=c*g-p*v,k=c*y-d*v,L=h*g-p*m,A=h*y-d*m,O=p*y-d*g,M=b*O-w*A+E*L+S*k-x*C+T*N;return 0==M?u:(M=1/M,t[0]=(a*O-f*A+l*L)*M,t[1]=(-r*O+i*A-s*L)*M,t[2]=(m*T-g*x+y*S)*M,t[3]=(-h*T+p*x-d*S)*M,t[4]=(-o*O+f*k-l*C)*M,t[5]=(n*O-i*k+s*C)*M,t[6]=(-v*T+g*E-y*w)*M,t[7]=(c*T-p*E+d*w)*M,t[8]=(o*A-a*k+l*N)*M,t[9]=(-n*A+r*k-s*N)*M,t[10]=(v*x-m*E+y*b)*M,t[11]=(-c*x+h*E-d*b)*M,t[12]=(-o*L+a*C-f*N)*M,t[13]=(n*L-r*C+i*N)*M,t[14]=(-v*S+m*w-g*b)*M,t[15]=(c*S-h*w+p*b)*M,q)}function bd(e,t,n){var r=t[0],i=t[1];t=t[2],n[0]=r*e[0]+i*e[4]+t*e[8]+e[12],n[1]=r*e[1]+i*e[5]+t*e[9]+e[13],n[2]=r*e[2]+i*e[6]+t*e[10]+e[14]}function cd(e,t,n){var r=t[0],i=t[1],s=t[2];return t=t[3],n[0]=r*e[0]+i*e[4]+s*e[8]+t*e[12],n[1]=r*e[1]+i*e[5]+s*e[9]+t*e[13],n[2]=r*e[2]+i*e[6]+s*e[10]+t*e[14],n[3]=r*e[3]+i*e[7]+s*e[11]+t*e[15],n}function dd(e,t,n,r){return Uc(e,e[0]*t+e[4]*n+e[8]*r+e[12],e[1]*t+e[5]*n+e[9]*r+e[13],e[2]*t+e[6]*n+e[10]*r+e[14],e[3]*t+e[7]*n+e[11]*r+e[15])}function ed(){M.call(this),this.f="transform",this.Q=D.g.Ed()}function fd(e,t,n){e.Q[t+4*n]*=-1,e.q()}function gd(){M.call(this),this.f="texture",this.Wb=this.ib=this.r=t,this.We=this.Xe=0,this.hg=u,Fa(this,new xc)}function W(e,n){M.call(this),this.f="triplets",this.mb=Infinity,this.jb=-Infinity,this.nb=Infinity,this.kb=-Infinity,this.ob=Infinity,this.lb=-Infinity,this.Rd=[0,0,0],this.gg=q,this.C=0,this.da=new Float32Array(e),n!=t&&(this.da=n.da.subarray(0,n.da.length),this.C=this.da.length,this.mb=n.mb,this.jb=n.jb,this.nb=n.nb,this.kb=n.kb,this.ob=n.ob,this.lb=n.lb,this.Rd=n.Rd.slice(),this.gg=u)}function hd(){this.Ia=id,this.ja=new ed,this.w=[1,1,1],this.nc=this.G=this.pa=this.n=this.h=t,this.Nc=[],this.O=q,this.Lc=this.sd=1,this.Dc=t,this.jd=u,this.za=1,this.ya=0,this.rd=q}function jd(){this.ra=Infinity,this.U=this.ia=-Infinity,this.W=Infinity,this.Rb=[0,0,0],this.Pb=[1,1,1]}function kd(){M.call(this),this.f="scalars",this.dd=this.I=t,this.ug=q,this.Le=0,Fa(this,new xc),Fa(this,new jd),this.Rb=[0,1,0],this.Pb=[1,0,0]}function Y(e){M.call(this),this.f="object",this.c=[],this.F=this.xa=t,Fa(this,new hd),e!=t&&this.rc(e)}function nd(e,n){return(e==t||n==t||!(e instanceof Y)||!(n instanceof Y))&&m(Error("Fatal: Two valid X.objects are required for comparison.")),1==e.za?-1:1==n.za?1:e.ya!=t&&n.ya!=t&&e.ya>n.ya?-1:1}function od(){}function pd(e){for(var t=e.h.count,n=[],r=0,r=0;r<t;r+=3){var i=e.h.get(r),s=e.h.get(r+1),o=e.h.get(r+2),u=e.n.get(r),a=e.n.get(r+1),f=e.n.get(r+2),l=e.w;e.pa&&0<e.pa.length&&(l=e.pa.get(r));var c=[];c.push(new kc(i,u)),c.push(new kc(s,a)),c.push(new kc(o,f)),n.push(new mc(c,l))}return uc(n)}function qd(e,n){(n==t||!(n instanceof tc))&&m(Error("Invalid CSG object."));var r=new vc,i=[];Lb(n.Z,function(e){var t=[],n=e.De,t=Lb(e.Lb,function(e){return e.color=n,r.add(e)});for(e=e=2;e<t.length;e++)i.push([t[0],t[e-1],t[e]])}.bind(e)),e.Vh=Lb(r.unique(),function(e){return[e.Wa.x(),e.Wa.y(),e.Wa.d()]}),e.Uh=Lb(r.unique(),function(e){return[e.va.x(),e.va.y(),e.va.d()]}),e.Th=Lb(r.unique(),function(e){return e.color?[e.color[0],e.color[1],e.color[2]]:t}),e.h=new W(9*i.length),e.n=new W(9*i.length),e.pa=new W(9*i.length),Lb(i,function(e){var t=e[0],n=e[1];e=e[2];var r=this.Vh,i=this.Uh,s=this.Th;this.h.add(r[t][0],r[t][1],r[t][2]),this.h.add(r[n][0],r[n][1],r[n][2]),this.h.add(r[e][0],r[e][1],r[e][2]),this.n.add(i[t][0],i[t][1],i[t][2]),this.n.add(i[n][0],i[n][1],i[n][2]),this.n.add(i[e][0],i[e][1],i[e][2]),s[t]&&this.pa.add(s[t][0],s[t][1],s[t][2]),s[n]&&this.pa.add(s[n][0],s[n][1],s[n][2]),s[e]&&this.pa.add(s[e][0],s[e][1],s[e][2])}.bind(e)),0==e.pa.C&&(e.pa=t),e.Ia=id}function rd(e){Rb.call(this,e),this.f="event"}function Gd(){rd.call(this,xd),this.Qe=this.cf=0}function Hd(){rd.call(this,sd),this.ya=new D.m(0,0,0)}function Id(){rd.call(this,td),this.ya=new D.m(0,0,0)}function Jd(){rd.call(this,ud),this.hb=this.vb=u}function Kd(){rd.call(this,vd),this.V=u}function Ld(){rd.call(this,Bd),this.ge=this.fe=0}function Md(){rd.call(this,Cd)}function Nd(){rd.call(this,wd)}function ld(){rd.call(this,yd),this.v=this.D=t}function md(){rd.call(this,zd),this.v=this.D=t}function Od(){rd.call(this,Ad),this.Ad=0}function Pd(){rd.call(this,Dd),this.D=t}function Qd(){rd.call(this,Fd),this.Ad=0}function Rd(){rd.call(this,Ed),this.D=t}function Sd(e,n,r){e==t&&m(Error("Invalid GL Buffer.")),n==t&&m(Error("Invalid number of items.")),r==t&&m(Error("Invalid item size.")),M.call(this),this.f="buffer",this.P=e,this.ed=n,this.Ob=r}function Ud(e,t){var n;n=e.className,n=na(n)&&n.match(/\S+/g)||[];for(var r=Ob(arguments,1),i=n.length+r.length,s=n,o=0;o<r.length;o++)0<=Ib(s,r[o])||s.push(r[o]);return e.className=n.join(" "),n.length==i}function Vd(e,t){this.width=e,this.height=t}function Xd(e,t){this.x=ia(e)?e:0,this.y=ia(t)?t:0}function Yd(e,t){return new Xd(e.x-t.x,e.y-t.y)}function Zd(e){return e?new $d(ae(e)):Td||(Td=new $d)}function be(e){return na(e)?document.getElementById(e):e}function de(e,t,n){return ee(document,arguments)}function ee(e,n){var r=n[0],i=n[1];if(!Wd&&i&&(i.name||i.type)){r=["<",r],i.name&&r.push(' name="',Ra(i.name),'"');if(i.type){r.push(' type="',Ra(i.type),'"');var s={};Qa(s,i),delete s.type,i=s}r.push(">"),r=r.join("")}var o=e.createElement(r);i&&(na(i)?o.className=i:la(i)?Ud.apply(t,[o].concat(i)):Na(i,function(e,t){"style"==t?o.style.cssText=e:"class"==t?o.className=e:"for"==t?o.htmlFor=e:t in ce?o.setAttribute(ce[t],e):0==t.lastIndexOf("aria-",0)||0==t.lastIndexOf("data-",0)?o.setAttribute(t,e):o[t]=e}));if(2<n.length){i=function(t){t&&o.appendChild(na(t)?e.createTextNode(t):t)};for(r=2;r<n.length;r++){var a=n[r];if(ma(a)&&!(pa(a)&&0<a.nodeType)){var s=Jb,f;e:{if((f=a)&&"number"==typeof f.length){if(pa(f)){f="function"==typeof f.item||"string"==typeof f.item;break e}if(oa(f)){f="function"==typeof f.item;break e}}f=u}if(f)if(f=a.length,0<f){for(var l=Array(f),c=0;c<f;c++)l[c]=a[c];a=l}else a=[];s(a,i)}else i(a)}}return o}function fe(e){return"CSS1Compat"==e.compatMode}function ge(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function he(e){for(;e&&1!=e.nodeType;)e=e.nextSibling;return e}function ie(e,t){if(e.contains&&1==t.nodeType)return e==t||e.contains(t);if("undefined"!=typeof e.compareDocumentPosition)return e==t||Boolean(e.compareDocumentPosition(t)&16);for(;t&&e!=t;)t=t.parentNode;return t==e}function ae(e){return 9==e.nodeType?e:e.ownerDocument||e.document}function $d(e){this.ka=e||fa.document||document}function je(e){return fe(e.ka)}function ke(e){var t=e.ka;return e=!lb&&fe(t)?t.documentElement:t.body,t=t.parentWindow||t.defaultView,K&&Cb("10")&&t.pageYOffset!=e.scrollTop?new Xd(e.scrollLeft,e.scrollTop):new Xd(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)}function le(e,t,n,r){this.top=e,this.right=t,this.bottom=n,this.left=r}function me(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}function ne(e,t){var n=t.x<e.left?e.left-t.x:Math.max(t.x-(e.left+e.width),0),r=t.y<e.top?e.top-t.y:Math.max(t.y-(e.top+e.height),0);return n*n+r*r}function oe(e,n){var r=ae(e);return r.defaultView&&r.defaultView.getComputedStyle&&(r=r.defaultView.getComputedStyle(e,t))?r[n]||r.getPropertyValue(n)||"":""}function pe(e,n){return oe(e,n)||(e.currentStyle?e.currentStyle[n]:t)||e.style&&e.style[n]}function qe(e){return e=e?ae(e):document,K&&!(K&&9<=Eb)&&!je(Zd(e))?e.body:e.documentElement}function re(e){var t=e.getBoundingClientRect();return K&&(e=e.ownerDocument,t.left-=e.documentElement.clientLeft+e.body.clientLeft,t.top-=e.documentElement.clientTop+e.body.clientTop),t}function se(e){if(K&&!(K&&8<=Eb))return e.offsetParent;var n=ae(e),r=pe(e,"position"),i="fixed"==r||"absolute"==r;for(e=e.parentNode;e&&e!=n;e=e.parentNode)if(r=pe(e,"position"),i=i&&"static"==r&&e!=n.documentElement&&e!=n.body,!i&&(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight||"fixed"==r||"absolute"==r||"relative"==r))return e;return t}function te(e){for(var n=new le(0,Infinity,Infinity,0),r=Zd(e),i=r.ka.body,s=r.ka.documentElement,o=!lb&&fe(r.ka)?r.ka.documentElement:r.ka.body;e=se(e);)if((!K||0!=e.clientWidth)&&(!lb||0!=e.clientHeight||e!=i)&&e!=i&&e!=s&&"visible"!=pe(e,"overflow")){var u=ue(e),a;a=e;if(jb&&!Cb("1.9")){var f=parseFloat(oe(a,"borderLeftWidth"));if(ve(a))var l=a.offsetWidth-a.clientWidth-f-parseFloat(oe(a,"borderRightWidth")),f=f+l;a=new Xd(f,parseFloat(oe(a,"borderTopWidth")))}else a=new Xd(a.clientLeft,a.clientTop);u.x+=a.x,u.y+=a.y,n.top=Math.max(n.top,u.y),n.right=Math.min(n.right,u.x+e.clientWidth),n.bottom=Math.min(n.bottom,u.y+e.clientHeight),n.left=Math.max(n.left,u.x)}return i=o.scrollLeft,o=o.scrollTop,n.left=Math.max(n.left,i),n.top=Math.max(n.top,o),r=(r.ka.parentWindow||r.ka.defaultView||window).document,r=fe(r)?r.documentElement:r.body,r=new Vd(r.clientWidth,r.clientHeight),n.right=Math.min(n.right,i+r.width),n.bottom=Math.min(n.bottom,o+r.height),0<=n.top&&0<=n.left&&n.bottom>n.top&&n.right>n.left?n:t}function ue(e){var t,n=ae(e),r=pe(e,"position"),i=jb&&n.getBoxObjectFor&&!e.getBoundingClientRect&&"absolute"==r&&(t=n.getBoxObjectFor(e))&&(0>t.screenX||0>t.screenY),s=new Xd(0,0),o=qe(n);if(e==o)return s;if(e.getBoundingClientRect)t=re(e),e=ke(Zd(n)),s.x=t.left+e.x,s.y=t.top+e.y;else if(n.getBoxObjectFor&&!i)t=n.getBoxObjectFor(e),e=n.getBoxObjectFor(o),s.x=t.screenX-e.screenX,s.y=t.screenY-e.screenY;else{t=e;do{s.x+=t.offsetLeft,s.y+=t.offsetTop,t!=e&&(s.x+=t.clientLeft||0,s.y+=t.clientTop||0);if(lb&&"fixed"==pe(t,"position")){s.x+=n.body.scrollLeft,s.y+=n.body.scrollTop;break}t=t.offsetParent}while(t&&t!=e);if(ib||lb&&"absolute"==r)s.y-=n.body.offsetTop;for(t=e;(t=se(t))&&t!=n.body&&t!=o;)if(s.x-=t.scrollLeft,!ib||"TR"!=t.tagName)s.y-=t.scrollTop}return s}function we(e){var t=new Xd;if(1==e.nodeType){if(e.getBoundingClientRect){var n=re(e);t.x=n.left,t.y=n.top}else{var n=ke(Zd(e)),r=ue(e);t.x=r.x-n.x,t.y=r.y-n.y}if(jb&&!Cb(12)){var i;K?i="-ms-transform":lb?i="-webkit-transform":ib?i="-o-transform":jb&&(i="-moz-transform");var s;i&&(s=pe(e,i)),s||(s=pe(e,"transform")),s?(e=s.match(xe),e=e?new Xd(parseFloat(e[1]),parseFloat(e[2])):new Xd(0,0)):e=new Xd(0,0),t=new Xd(t.x+e.x,t.y+e.y)}}else i=oa(e.Gi),s=e,e.targetTouches?s=e.targetTouches[0]:i&&e.sb.targetTouches&&(s=e.sb.targetTouches[0]),t.x=s.clientX,t.y=s.clientY;return t}function ye(e,t){return"number"==typeof e&&(e=(t?Math.round(e):e)+"px"),e}function ze(e){if("none"!=pe(e,"display"))return Ae(e);var t=e.style,n=t.display,r=t.visibility,i=t.position;return t.visibility="hidden",t.position="absolute",t.display="inline",e=Ae(e),t.display=n,t.position=i,t.visibility=r,e}function Ae(e){var t=e.offsetWidth,n=e.offsetHeight,r=lb&&!t&&!n;return(!ia(t)||r)&&e.getBoundingClientRect?(e=re(e),new Vd(e.right-e.left,e.bottom-e.top)):new Vd(t,n)}function Be(e,t){e.style.display=t?"":"none"}function ve(e){return"rtl"==pe(e,"direction")}function Ce(e,t){if(/^\d+px?$/.test(t))return parseInt(t,10);var n=e.style.left,r=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left,e.style.left=t;var i=e.style.pixelLeft;return e.style.left=n,e.runtimeStyle.left=r,i}function De(e,n){var r=e.currentStyle?e.currentStyle[n]:t;return r?Ce(e,r):0}function Fe(e,n){if("none"==(e.currentStyle?e.currentStyle[n+"Style"]:t))return 0;var r=e.currentStyle?e.currentStyle[n+"Width"]:t;return r in Ee?Ee[r]:Ce(e,r)}function Ge(e,n){jc.call(this),this.H=e;var r=pa(this.H)&&1==this.H.nodeType?this.H:this.H?this.H.body:t;this.aj=!!r&&ve(r),this.Jl=L(this.H,jb?"DOMMouseScroll":"mousewheel",this,n)}function He(e,t){return lb&&(ab||db)&&0!=e%t?e:e/t}function Ie(e,t,n,r){t&&this.Ca(t,p),this.type="mousewheel",this.detail=e,this.yl=n,this.Xc=r}function Je(e){M.call(this),this.f="interactor",this.Oa=e,this.Re=this.og=this.ng=this.pg=this.mg=this.qg=t,this.Yd=q,this.Xb=this.Qb=this.wb=u,this.ua=[0,0],this.Me=new D.m(0,0,0),this.gd=new D.m(0,0,0),this.Vg=0,this.xg=this.Wd=t,this.wg=u,this.R={MOUSEWHEEL_ENABLED:q,MOUSECLICKS_ENABLED:q,KEYBOARD_ENABLED:q,HOVERING_ENABLED:q,CONTEXTMENU_ENABLED:u,TOUCH_ENABLED:q,TOUCH_BOUNCING_ENABLED:u}}function Me(e){clearTimeout(e.xg);if(e.be){var t=new Jd;t.vb=u,t.hb=e instanceof Le,e.dispatchEvent(t)}e.be=u}function Ke(e){e.Wd&&clearTimeout(e.Wd),e.dispatchEvent(new Md)}function Ne(e){Je.call(this,e),this.f="interactor2D"}function Oe(e,t){(!x(e)||!x(t))&&m(Error("A camera needs valid width and height values.")),M.call(this),this.f="camera",this.ic=new D.m(0,100,0),this.Fc=new D.m(0,0,0),this.V=new D.m(0,0,1),this.K=e,this.A=t,this.o=this.ue(this.ic,this.Fc)}function Pe(e,t){Oe.call(this,e,t),this.f="camera3D",this.eg=45,this.Ve=D.g.yf(D.g.Ed(),this.eg,e/t,1,1e4)}function Qe(e,t,n,r){var i=new Float32Array(4),s=new Float32Array(4),o=new Float32Array(16),u=new Float32Array(16);return new Float32Array(16),D.g.multiply(e.Ve,e.o,u),D.g.Y(u,o),i[0]=t,i[1]=n,i[2]=2*r-1,i[3]=1,D.g.ah(o,i,s),s[3]=1/s[3],s[0]*=s[3],s[1]*=s[3],s[2]*=s[3],s}function Re(){M.call(this),this.f="parser",this.J=t,this.C=0,this.Zh=0<(new Int8Array((new Int16Array([1])).buffer))[0],this.Mc=q,this.rl=-Infinity,this.ql=Infinity}function Se(e){for(var t=Infinity,n=-Infinity,r=e.length,i=0,i=0;i<r;i++)if(!isNaN(e[i]))var s=e[i],t=Math.min(t,s),n=Math.max(n,s);return[t,n]}function Te(e,t,n){t===p&&(t=0),n===p&&(n=e.length);for(var r="",i=0,i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function Z(e,n,r){r!=t||(r=1);var i=1,s=Uint8Array;switch(n){case"schar":s=Int8Array;break;case"ushort":s=Uint16Array,i=2;break;case"sshort":s=Int16Array,i=2;break;case"uint":s=Uint32Array,i=4;break;case"sint":s=Int32Array,i=4;break;case"float":s=Float32Array,i=4;break;case"complex":s=Float64Array,i=8;break;case"double":s=Float64Array,i=8}n=new s(e.J.slice(e.C,e.C+=r*i));if(e.Zh!=e.Mc){e=n,n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(s=0;s<e.byteLength;s+=i)for(var o=s+i-1,u=s;o>u;o--,u++){var a=n[u];n[u]=n[o],n[o]=a}n=e}return 1==r?n[0]:n}function Ue(e,t){var n=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE],r=Qc(0,0,0,1),i=Pc();return cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Qc(0,0,t[2]-1,1),cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Qc(0,t[1]-1,0,1),cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Qc(t[0]-1,0,0,1),cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Qc(t[0]-1,t[1]-1,0,1),cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Qc(t[0]-1,0,t[2]-1,1),cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Qc(0,t[1]-1,t[2]-1,1),cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Qc(t[0]-1,t[1]-1,t[2]-1,1),cd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],n}function Ve(e,t){var n=Sc();if(e.length!=t.length||e[0]!=t[0]||e[1]!=t[1]||e[2]!=t[2]){var r=Math.acos(e[2]),i=Mc(),s=e[0],o=e[1],u=e[2],a=t[0],f=t[1],l=t[2];i[0]=o*l-u*f,i[1]=u*a-s*l,i[2]=s*f-o*a,Oc(i,i),s=Math.cos(r/2),o=Math.sin(r/2)*i[0],u=Math.sin(r/2)*i[1],r=Math.sin(r/2)*i[2],T(n,0,s*s+o*o-u*u-r*r,2*(o*u-s*r),2*(o*r+s*u),0),T(n,1,2*(o*u+s*r),s*s+u*u-o*o-r*r,2*(u*r-s*o),0),T(n,2,2*(o*r-s*u),2*(u*r+s*o),s*s+r*r-u*u-o*o,0)}return r=Rc(),ad(n,r),[n,r]}function We(e,n,r,i,s,o,a,f,l){var c=new Xe;Oc(r,r);for(var h=[],p=[],d=0;6>d;d++)for(var v=Math.floor(d/2),m=(v+1)%3,g=(v+2)%3,y=(4+2*v)%6,b=0;2>b;b++){var w=(2+b+2*v)%6,E=-(r[v]*(s[d]-e[v])+r[m]*(s[w]-e[m]))/r[g]+e[g];if(E>=s[y]&&E<=s[y+1]||E<=s[y]&&E>=s[y+1]){var S=[];S[v]=s[d],S[m]=s[w],S[g]=E,h.push(S)}else S=[],S[v]=s[d],S[m]=s[w],S[g]=E,p.push(S)}e=Nc(0,0,1),e=Ve(r,e),s=e[0],e=e[1],v=[];for(p=0;p<h.length;++p)d=Qc(h[p][0],h[p][1],h[p][2],1),m=Pc(),cd(s,d,m),v.push([m[0],m[1],m[2]]);s=Nc(1,0,0),h=Mc(),bd(e,s,h),p=Nc(0,1,0),s=Mc(),bd(e,p,s),d=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];for(p=p=0;p<v.length;++p)v[p][0]<d[0]&&(d[0]=v[p][0]),v[p][0]>d[1]&&(d[1]=v[p][0]),v[p][1]<d[2]&&(d[2]=v[p][1]),v[p][1]>d[3]&&(d[3]=v[p][1]),v[p][2]<d[4]&&(d[4]=v[p][2]),v[p][2]>d[5]&&(d[5]=v[p][2]);p=Qc(d[0]+(d[1]-d[0])/2,d[2]+(d[3]-d[2])/2,d[4]+(d[5]-d[4])/2,0),v=Pc(),$c(e,p,v),m=Math.floor(d[0]),g=Math.ceil(d[1]),m==g&&g++,y=g-m,b=Math.floor(d[2]),w=Math.ceil(d[3]),b==w&&w++,E=w-b,S=n[0],n=n[1];var p=Math.ceil(y/S),x=Math.ceil(E/n),T=new Uint8Array(4*p*x),N=new gd;N.Xe=p,N.We=x;var x=Pc(),C=Qc(0,0,d[4],1),k=Rc();$c(a.Qh,e,k);for(var L=w-1e-7,A=g-1e-7,O=0,M=0,_=0,D=b,D=b;D<=L;D+=n){_++,M=0,C[1]=D;for(p=m;p<=A;p+=S){M++,C[0]=p,cd(k,C,x);var P=4*O,H=Math.floor(x[2]),B=Math.floor(x[1]),j=Math.floor(x[0]);if(0<=j&&j<a.ca[0]&&0<=B&&B<a.ca[1]&&0<=H&&H<a.ca[2]){var F=o[H][B][j],I=j=B=H=0;l?((F=l.get(F))||(F=[0,.61,0,0,1]),H=255*F[1],B=255*F[2],j=255*F[3],I=255*F[4]):(H=B=j=255*((F-a.ra)/(a.ia-a.ra)),I=255),T[P]=H,T[++P]=B,T[++P]=j,T[++P]=I}else T[P]=0,T[++P]=0,T[++P]=0,T[++P]=0;O++}}return N.Wb=T,c.G=N,c.ei=d,c.Sh=e,c.Rh=k,c.Yh=b,c.ol=w,c.di=m,c.tl=g,c.jg=M,c.ig=_,c.Vc=S,c.K=y,c.Gc=n,c.A=E,c.z=[v[0],v[1],v[2]],c.gc=[r[0],r[1],r[2]],c.Oc=[h[0],h[1],h[2]],c.V=[s[0],s[1],s[2]],c.O=u,c.yb=a,c.Bb=a.yb!=t&&!f?u:q,c.ec=i,c.Gb(),c.O=u,c}function Ye(e,t,n,r){var i;i=r.ma;for(var s=[],o=[],u=0;6>u;u++){var a=Math.floor(u/2),f=(a+1)%3,l=(a+2)%3,c=(2+2*a)%6,h=(4+2*a)%6,p=(i[u]-t[a])*(1/n[a]);if(Infinity!=p&&-Infinity!=p){var d=t[f]+n[f]*p,p=t[l]+n[l]*p;d>=i[c]&&d<=i[c+1]&&p>=i[h]&&p<=i[h+1]?(c=[],c[a]=i[u],c[f]=d,c[l]=p,s.push(c)):(c=[],c[a]=i[u],c[f]=d,c[l]=p,o.push(c))}}i=[s,o],t=i[0],r.b[e].k=i,i=Fc(new R(t[0][0],t[0][1],t[0][2]),new R(t[1][0],t[1][1],t[1][2])),r.b[e].nl=i,s=Nc(0,0,1),o=Ve(n,s)[0],u=Qc(r.ad[0],r.ad[1],r.ad[2],0),s=Pc(),cd(o,u,s),o=Pc(),u=s[2],o[0]=n[0]*u,o[1]=n[1]*u,o[2]=n[2]*u,o[3]=n[3]*u,.1>Math.abs(s[0])&&(s[0]=.1),.1>Math.abs(s[1])&&(s[1]=.1),s[0]/=r.ae,s[1]/=r.ae,r.b[e].Ga=[Math.abs(s[0]),Math.abs(s[1])],r.b[e].Sc=s[2],r.b[e].B=o,i=Math.floor(Math.abs(i/s[2])),r.ud[e]=i+1,r.b[e].p=i+1,r.b[e].k[0][0][0]>r.b[e].k[0][1][0]?0<o[0]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][0]<r.b[e].k[0][1][0]?0>o[0]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][1]>r.b[e].k[0][1][1]?0<o[1]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][1]<r.b[e].k[0][1][1]?0>o[1]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][2]>r.b[e].k[0][1][2]?0<o[2]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][2]<r.b[e].k[0][1][2]&&0>o[2]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i),r.b[e].Te=-(n[0]*t[0][0]+n[1]*t[0][1]+n[2]*t[0][2])}function af(e,n){var r;r=n.J;for(var i=n.ca,s=n.ia,o=n.ra,u=Array(i[2]),a=Array(i[2]),f=i[1]*i[0],l=0,c=0,h=0,p=0,d=0,p=0;p<i[2];p++){var v=r.subarray(p*f,(p+1)*f),d=0;a[p]=Array(i[1]),u[p]=Array(i[1]);for(h=0;h<i[1];h++){a[p][h]=new r.constructor(i[0]),u[p][h]=new r.constructor(i[0]);for(c=0;c<i[0];c++)l=v[d],a[p][h][c]=255*((l-o)/(s-o)),u[p][h][c]=l,d++}}return r=[u,a],n.$=r[0],n.bg=r[1],D.Ja(e.f+".reslice"),n.L=n.e!=t,n.xa&&(n.cd=n.xa.Ka),n.Sl=[0,0,0],n.s=[n.Ea[0]+(n.gb[0]-1)/2,n.Ea[1]+(n.gb[1]-1)/2,n.Ea[2]+(n.gb[2]-1)/2],n.ma=[Math.min(n.Ea[0],n.Ea[0]+n.gb[0]-1),Math.max(n.Ea[0],n.Ea[0]+n.gb[0]-1),Math.min(n.Ea[1],n.Ea[1]+n.gb[1]-1),Math.max(n.Ea[1],n.Ea[1]+n.gb[1]-1),Math.min(n.Ea[2],n.Ea[2]+n.gb[2]-1),Math.max(n.Ea[2],n.Ea[2]+n.gb[2]-1)],n.b=[{},{},{}],r=Nc(n.s[0],n.s[1],n.s[2]),n.b[0].vd=r,i=Nc(1,0,0),Oc(i,i),n.b[0].i=i,s=[1,0,0],n.b[0].w=s,Ye(0,r,i,n),n.c[0].c=Array(n.b[0].p),r[0]=n.b[0].k[0][0][0]+n.b[0].B[0]*Math.floor(n.b[0].p/2),r[1]=n.b[0].k[0][0][1]+n.b[0].B[1]*Math.floor(n.b[0].p/2),r[2]=n.b[0].k[0][0][2]+n.b[0].B[2]*Math.floor(n.b[0].p/2),r=We(r,n.b[0].Ga,n.b[0].i,n.b[0].w,n.ma,n.$,n,n.L,n.cd),n.L&&(r.e=n.e.c[0].c[Math.floor(n.b[0].p/2)].G),n.c[0].c[Math.floor(n.b[0].p/2)]=r,n.Cb=Math.floor(n.b[0].p/2),n.Hc=Math.floor(n.b[0].p/2),r=Nc(n.s[0],n.s[1],n.s[2]),n.b[1].vd=r,i=Nc(0,1,0),Oc(i,i),n.b[1].i=i,s=[0,1,0],n.b[1].w=s,Ye(1,r,i,n),n.c[1].c=Array(n.b[1].p),r[0]=n.b[1].k[0][0][0]+n.b[1].B[0]*Math.floor(n.b[1].p/2),r[1]=n.b[1].k[0][0][1]+n.b[1].B[1]*Math.floor(n.b[1].p/2),r[2]=n.b[1].k[0][0][2]+n.b[1].B[2]*Math.floor(n.b[1].p/2),r=We(r,n.b[1].Ga,n.b[1].i,n.b[1].w,n.ma,n.$,n,n.L,n.cd),n.L&&(r.e=n.e.c[1].c[Math.floor(n.b[1].p/2)].G),n.c[1].c[Math.floor(n.b[1].p/2)]=r,n.Db=Math.floor(n.b[1].p/2),n.Ic=Math.floor(n.b[1].p/2),r=Nc(n.s[0],n.s[1],n.s[2]),n.b[2].vd=r,i=Nc(0,0,1),Oc(i,i),n.b[2].i=i,s=[0,.392,.804],n.b[2].w=s,Ye(2,r,i,n),n.c[2].c=Array(n.b[2].p),r[0]=n.b[2].k[0][0][0]+n.b[2].B[0]*Math.floor(n.b[2].p/2),r[1]=n.b[2].k[0][0][1]+n.b[2].B[1]*Math.floor(n.b[2].p/2),r[2]=n.b[2].k[0][0][2]+n.b[2].B[2]*Math.floor(n.b[2].p/2),r=We(r,n.b[2].Ga,n.b[2].i,n.b[2].w,n.ma,n.$,n,n.L,n.cd),n.L&&(r.e=n.e.c[2].c[Math.floor(n.b[2].p/2)].G),n.c[2].c[Math.floor(n.b[2].p/2)]=r,n.Eb=Math.floor(n.b[2].p/2),n.Jc=Math.floor(n.b[2].p/2),D.Da(e.f+".reslice"),n.$}function bf(){Re.call(this),this.f="parserIMAGE"}function cf(e,t){Oe.call(this,e,t),this.f="camera2D"}function df(){M.call(this),this.f="shaders",this.ce="";var e;e="precision mediump float;\n\n",e+="attribute vec3 vertexPosition;\n",e+="attribute vec3 vertexNormal;\n",e+="attribute vec3 vertexColor;\n",e+="attribute vec2 vertexTexturePos;\n",e+="attribute float vertexScalar;\n",e+="\n",e+="uniform mat4 view;\n",e+="uniform mat4 perspective;\n",e+="uniform vec3 center;\n",e+="uniform mat4 objectTransform;\n",e+="uniform bool useObjectColor;\n",e+="uniform bool useScalars;\n",e+="uniform bool scalarsReplaceMode;\n",e+="uniform float scalarsMin;\n",e+="uniform float scalarsMax;\n",e+="uniform vec3 scalarsMinColor;\n",e+="uniform vec3 scalarsMaxColor;\n",e+="uniform float scalarsMinThreshold;\n",e+="uniform float scalarsMaxThreshold;\n",e+="uniform int scalarsInterpolation;\n",e+="uniform vec3 objectColor;\n",e+="uniform float pointSize;\n",e+="\n",e+="varying float fDiscardNow;\n",e+="varying vec4 fVertexPosition;\n",e+="varying vec3 fragmentColor;\n",e+="varying vec2 fragmentTexturePos;\n",e+="varying vec3 fVertexNormal;\n",e+="varying vec3 fTransformedVertexNormal;\n",e+="\n",e+="void main(void) {\n",e+="  fTransformedVertexNormal = mat3(view[0].xyz,view[1].xyz,view[2].xyz) * ",e+="mat3(objectTransform[0].xyz,objectTransform[1].xyz,objectTransform[2].xyz) * ",e+="vertexNormal;\n",e+="  fVertexNormal = vertexNormal;\n",e+="  fDiscardNow = 0.0;\n",e+="  vec3 vertexPosition2 = vertexPosition - center;\n",e+="  fVertexPosition = view * objectTransform * vec4(vertexPosition2, 1.0);\n",e+="  fragmentTexturePos = vertexTexturePos;\n",e+="  if (useScalars) {\n",e+="    float scalarValue = vertexScalar;\n",e+="    if (scalarValue < scalarsMinThreshold || scalarValue > scalarsMaxThreshold) {\n",e+="      if (scalarsReplaceMode) {\n",e+="        fragmentColor = objectColor;\n",e+="      } else {\n",e+="        fDiscardNow = 1.0;\n",e+="      }\n",e+="    } else {\n",e+="      if (scalarsReplaceMode) {\n",e+="        if (scalarsInterpolation == 1) {\n",e+="            vec3 zeroMaxColor;\n",e+="            vec3 zeroMinColor;\n",e+="            zeroMaxColor[0] = scalarsMaxColor[0]*0.33;\n",e+="            zeroMaxColor[1] = scalarsMaxColor[1]*0.33;\n",e+="            zeroMaxColor[2] = scalarsMaxColor[2]*0.33;\n",e+="            zeroMinColor[0] = scalarsMinColor[0]*0.33;\n",e+="            zeroMinColor[1] = scalarsMinColor[1]*0.33;\n",e+="            zeroMinColor[2] = scalarsMinColor[2]*0.33;\n",e+="            if(scalarValue < 0.0) {fragmentColor = scalarValue/(scalarsMin) * scalarsMinColor + (1.0 - scalarValue/(scalarsMin)) * (zeroMinColor);}\n",e+="            else {fragmentColor = scalarValue/(scalarsMax) * scalarsMaxColor + (1.0 - scalarValue/(scalarsMax)) * (zeroMaxColor);}\n",e+="        } else {\n",e+="            fragmentColor = scalarValue * scalarsMaxColor + (1.0 - scalarValue) * scalarsMinColor;\n",e+="          }\n",e+="      } else {\n",e+="        fragmentColor = vertexColor;\n",e+="      }\n",e+="    }\n",e+="  } else if (useObjectColor) {\n",e+="    fragmentColor = objectColor;\n",e+="  } else {\n",e+="    fragmentColor = vertexColor;\n",e+="  }\n",e+="  gl_PointSize = pointSize;\n",e+="  gl_Position = perspective * fVertexPosition;\n",this.ce=e+="}\n",this.Ud="",e="precision mediump float;\n\n",e+="uniform bool usePicking;\n",e+="uniform bool useTexture;\n",e+="uniform bool volumeTexture;\n",e+="uniform bool useLabelMapTexture;\n",e+="uniform sampler2D textureSampler;\n",e+="uniform sampler2D textureSampler2;\n",e+="uniform float objectOpacity;\n",e+="uniform float labelmapOpacity;\n",e+="uniform vec4 labelmapColor;\n",e+="uniform float volumeLowerThreshold;\n",e+="uniform float volumeUpperThreshold;\n",e+="uniform float volumeScalarMin;\n",e+="uniform float volumeScalarMax;\n",e+="uniform vec3 volumeScalarMinColor;\n",e+="uniform vec3 volumeScalarMaxColor;\n",e+="uniform float volumeWindowLow;\n",e+="uniform float volumeWindowHigh;\n",e+="\n",e+="varying float fDiscardNow;\n",e+="varying vec4 fVertexPosition;\n",e+="varying vec3 fragmentColor;\n",e+="varying vec2 fragmentTexturePos;\n",e+="varying vec3 fVertexNormal;\n",e+="varying vec3 fTransformedVertexNormal;\n",e+="\n",e+="void main(void) {\n",e+=" if (fDiscardNow > 0.0) {\n",e+="   discard;\n",e+=" }\n",e+=" if (usePicking) {\n",e+="   gl_FragColor = vec4(fragmentColor, 1.0);\n",e+=" } else if (useTexture) {\n",e+="   vec4 texture1 = texture2D(textureSampler,fragmentTexturePos);\n",e+="   vec4 textureSum = texture1;\n",e+="   if (volumeTexture) {\n",e+="     float _windowLow = ((volumeWindowLow - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n",e+="     float _windowHigh = ((volumeWindowHigh - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n",e+="     vec3 _minrange = vec3(_windowLow,_windowLow,_windowLow);\n",e+="     vec3 _maxrange = vec3(_windowHigh,_windowHigh,_windowHigh);\n",e+="     vec3 fac = _maxrange - _minrange;\n",e+="     textureSum = vec4((textureSum.r - _minrange)/fac,1);\n",e+="     textureSum = textureSum.r * vec4(volumeScalarMaxColor,1) + (1.0 - textureSum.r) * vec4(volumeScalarMinColor,1);\n",e+="   }\n",e+="   if (useLabelMapTexture) {\n",e+="     vec4 texture2 = texture2D(textureSampler2,fragmentTexturePos);\n",e+="     if (texture2.a > 0.0) {\n",e+="         if (labelmapColor.a != -255.0) {\n",e+="           if (all(equal(floor(texture2 * vec4(255)), labelmapColor))) {\n",e+="             if (labelmapOpacity < 1.0) {\n",e+="               textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n",e+="             } else {\n",e+="               textureSum = texture2;\n",e+="             }\n",e+="           }\n",e+="         } else {\n",e+="           if (labelmapOpacity < 1.0) {\n",e+="             textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n",e+="           } else {\n",e+="             textureSum = texture2;\n",e+="           }\n",e+="         }\n",e+="     }\n",e+="   }\n",e+="   if (volumeTexture) {\n",e+="     float _volumeLowerThreshold = (volumeLowerThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n",e+="     float _volumeUpperThreshold = (volumeUpperThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n",e+="     if (texture1.r < _volumeLowerThreshold ||\n",e+="         texture1.r > _volumeUpperThreshold ||\n",e+="         texture1.a == 0.0 ) {\n",e+="       discard;\n",e+="     };\n",e+="   };\n",e+="   gl_FragColor = textureSum;\n",e+="   gl_FragColor.a = objectOpacity;\n",e+=" } else {\n",e+="   vec3 nNormal = normalize(fTransformedVertexNormal);\n",e+="   if (fVertexNormal == vec3(0.0,0.0,0.0)) {\n",e+="     gl_FragColor = vec4(fragmentColor,1.0);\n",e+="     return;\n",e+="   }\n",e+="   vec3 light = vec3(0.0, 0.0, 1.0);\n",e+="   vec3 lightDirection = vec3(0,0,-10);\n",e+="   lightDirection = normalize(lightDirection);\n",e+="   vec3 eyeDirection = normalize(-fVertexPosition.xyz);\n",e+="   vec3 reflectionDirection = reflect(-lightDirection, nNormal);\n",e+="   float specular = pow(max(dot(reflectionDirection, eyeDirection), 0.0), 10.0);\n",e+="   float diffuse = 0.8 * max(dot(nNormal, light), 0.0);\n",e+="   float ambient = 0.3;\n",e+="   gl_FragColor = vec4(fragmentColor * ambient +\n",e+="                       fragmentColor * diffuse +\n",e+="                       vec3(0.2, 0.2, 0.2) * specular,\n",e+="                       objectOpacity);\n",e+=" }\n",this.Ud=e+="}\n"}function Xe(e){Y.call(this),this.f="slice",this.z=[0,0,0],this.gc=[0,0,1],this.V=[0,1,0],this.Oc=[1,0,0],this.A=this.K=10,this.nc=[0,1,0,0,1,1,1,1,1,0,0,0],this.e=this.yb=t,this.Bb=q,this.ec=[1,1,1],e!=t&&this.rc(e)}function P(e){Y.call(this),this.f="volume",this.z=[0,0,0],this.ca=[10,10,10],this.ma=[1,1,1],this.ud=[10,10,10],this.qb=[1,1,1],this.ib=[],this.Jc=this.Eb=this.Ic=this.Db=this.Hc=this.Cb=0,this.kc=new Y,this.lc=new Y,this.mc=new Y,this.ee=this.Ra=u,this.X=-1,this.de=[],this.e=t,this.Bb=q,this.fa=Infinity,this.ea=-Infinity,this.vg=q,this.ae=1,this.ia=0,this.J=t,this.b=[],this.s=[0,0,0],this.gb=[0,0,0],this.ad=[0,0,0],this.$=[],this.bg=[],this.$a=t,Fa(this,new xc),Fa(this,new jd),e!=t&&this.rc(e)}function gf(e,n){if(!e.Sd)if(!e.Ra||!e.j&&n==e.X)e.X=n;else if(-1==e.de.indexOf(n)){e.de.push(n),e.Sd=q;var r=new Pd;r.D=e,e.dispatchEvent(r),e.onComputing(n),setTimeout(function(){var e=t;0<=this.X&&(e=this.c[this.X],e.visible=u);var e=this.c[n],r=e.c.length,i=Math.floor(r/4),s;for(s=0;s<1*i;s++){if(e.c[s]==t){var o=Mc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.L){var a=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.e.$,this.e,this.e.L,this.e.xa.Ka);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.$,this,q,t),o.c[0].O=u,this.L&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].O=q}jf(this,.25),setTimeout(function(){for(;s<2*i;s++){if(e.c[s]==t){var o=Mc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.L){var a=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.e.$,this.e,this.e.L,this.e.xa.Ka);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.$,this,q,t),o.c[0].O=u,this.L&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].O=q}jf(this,.5),setTimeout(function(){for(;s<3*i;s++){if(e.c[s]==t){var o=Mc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.L){var a=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.e.$,this.e,this.e.L,this.e.xa.Ka);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.$,this,q,t),o.c[0].O=u,this.L&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].O=q}jf(this,.75),setTimeout(function(){for(s=3*i;s<r;s++){if(e.c[s]==t){var o=Mc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.L){var a=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.e.$,this.e,this.e.L,this.e.xa.Ka);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.$,this,q,t),o.c[0].O=u,this.L&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].O=q}jf(this,1),setTimeout(function(){this.Sd&&this.c[n].q(q),this.X=n,this.j=u;if(this.Sd){var e=new Rd;e.D=this,this.dispatchEvent(e),this.onComputingEnd(n)}this.Sd=u}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(e),10)}else{r=e.c[e.X],r.visible=u;var r=e.c[n],i=r.c.length,s;for(s=0;s<i;s++)r.c[s].O=q;e.X=n,e.j=u}}function jf(e,t){var n=new Qd;n.Ad=t,e.dispatchEvent(n),e.onComputingProgress(100*t)}function kf(){Re.call(this),this.f="parserOFF"}function lf(){Re.call(this),this.f="parserDCM"}function mf(e,t,n,r){switch(n){case 16975:case 20819:case 20053:case 22351:n=function(e){for(var t="",n=128;1<=n;n/=2)t+=e&n?"1":"0";return t},r=e[t++],e=e[t++],r=parseInt(n((e&65280)>>8)+n(e&255)+(n((r&65280)>>8)+n(r&255)),2),4294967295==r&&(r=0),t+=r/2;break;default:t+=r/2}return t}function nf(){Re.call(this),this.f="parserVTK"}function of(e,t){t=t.replace(/^\s+|\s+$/g,"");var n=t.split(" "),r=n.length,i=n[0];switch(i){case"POINTS":e.Ub=q,e.Nb=u,e.Tb=u,n=parseInt(n[1],10),e.zd=new W(3*n),e.yd=new W(3*n);return;case"VERTICES":e.Nb=q,e.Ub=u,e.Tb=u,n=parseInt(n[1],10),3<=n?e.Pa=id:1==n?e.Pa="POINTS":m(Error("This VTK file is not supported!")),e.hc=[];return;case"TRIANGLE_STRIPS":e.Nb=q,e.Ub=u,e.Tb=u,e.Pa="TRIANGLE_STRIPS",e.hc=[];return;case"LINES":e.Nb=q,e.Ub=u,e.Tb=u,e.Pa="LINES",e.hc=[];return;case"POLYGONS":e.Nb=q,e.Ub=u,e.Tb=u,e.Pa="POLYGONS",e.hc=[];return;case"POINT_DATA":e.Tb=q,e.Ub=u,e.Nb=u;return}if(e.Ub)if(1==r||isNaN(parseFloat(i)))e.Ub=u;else{if(3<=r){var i=parseFloat(n[0]),s=parseFloat(n[1]),o=parseFloat(n[2]);e.zd.add(i,s,o)}6<=r&&(i=parseFloat(n[3]),s=parseFloat(n[4]),o=parseFloat(n[5]),e.zd.add(i,s,o)),9<=r&&(r=parseFloat(n[6]),i=parseFloat(n[7]),n=parseFloat(n[8]),e.zd.add(r,i,n))}else e.Nb?1==r||isNaN(parseFloat(i))?e.Nb=u:(n=n.slice(1),e.hc.push(n)):e.Tb&&("NORMALS"==i?e.Se=q:1==r||isNaN(parseFloat(i))?(e.Tb=u,e.Se=u):e.Se&&(3<=r&&(i=parseFloat(n[0]),s=parseFloat(n[1]),o=parseFloat(n[2]),e.yd.add(i,s,o)),6<=r&&(i=parseFloat(n[3]),s=parseFloat(n[4]),o=parseFloat(n[5]),e.yd.add(i,s,o)),9<=r&&(r=parseFloat(n[6]),i=parseFloat(n[7]),n=parseFloat(n[8]),e.yd.add(r,i,n))))}function pf(){Re.call(this),this.f="parserFSM",this.Mc=u}function rf(e){var t=e.length,n=0,r=Number.POSITIVE_INFINITY,i,s,o,u,a,f,l,c,h;for(c=0;c<t;++c)e[c]>n&&(n=e[c]),e[c]<r&&(r=e[c]);i=1<<n,s=new Uint32Array(i),o=1,u=0;for(a=2;o<=n;){for(c=0;c<t;++c)if(e[c]===o){f=0,l=u;for(h=0;h<o;++h)f=f<<1|l&1,l>>=1;for(h=f;h<i;h+=a)s[h]=o<<16|c;++u}++o,u<<=1,a<<=1}return[s,n,r]}function sf(e,t){this.gf=[],this.hf=32768,this.rb=this.Bd=this.M=this.Vf=0,this.input=new Uint8Array(e),this.Ag=u,this.jf=tf,this.Jb=u;if(t||!(t={}))t.index&&(this.M=t.index),t.bufferSize&&(this.hf=t.bufferSize),t.bufferType&&(this.jf=t.bufferType),t.resize&&(this.Jb=t.resize);switch(this.jf){case uf:this.la=32768,this.Ua=new Uint8Array(32768+this.hf+258);break;case tf:this.la=0,this.Ua=new Uint8Array(this.hf),this.tc=this.xi,this.Dg=this.mi,this.qf=this.ri;break;default:m(Error("invalid inflate mode"))}}function vf(e,t){for(var n=e.Bd,r=e.rb,i=e.input,s=e.M,o;r<t;)o=i[s++],o===p&&m(Error("input buffer is broken")),n|=o<<r,r+=8;return o=n&(1<<t)-1,e.Bd=n>>>t,e.rb=r-t,e.M=s,o}function Kf(e,t){for(var n=e.Bd,r=e.rb,i=e.input,s=e.M,o=t[0],u=t[1],a;r<u;)a=i[s++],a===p&&m(Error("input buffer is broken")),n|=a<<r,r+=8;return i=o[n&(1<<u)-1],o=i>>>16,e.Bd=n>>o,e.rb=r-o,e.M=s,i&65535}function yf(e){function t(e,t,n){var r,i,s;for(s=0;s<e;)switch(r=Kf(this,t),r){case 16:for(r=3+vf(this,2);r--;)n[s++]=i;break;case 17:for(r=3+vf(this,3);r--;)n[s++]=0;i=0;break;case 18:for(r=11+vf(this,7);r--;)n[s++]=0;i=0;break;default:i=n[s++]=r}return n}var n=vf(e,5)+257,r=vf(e,5)+1,i=vf(e,4)+4,s=new Uint8Array(zf.length),o;for(o=0;o<i;++o)s[zf[o]]=vf(e,3);i=rf(s),s=new Uint8Array(n),o=new Uint8Array(r),e.qf(rf(t.call(e,n,i,s)),rf(t.call(e,r,i,o)))}function Qf(){var e=Rf;switch(q){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:m("invalid length: "+e)}}function Uf(){}function Vf(e){this.input=e,this.M=0,this.member=[]}function Wf(){Re.call(this),this.f="parserMGZ",this.Mc=u}function Xf(){Re.call(this),this.f="parserLBL"}function Yf(){Re.call(this),this.f="parserCRV",this.Mc=u}function Zf(e,t){var n,r;this.input=e,this.M=0;if(t||!(t={}))t.index&&(this.M=t.index),t.verify&&(this.tk=t.verify);n=e[this.M++],r=e[this.M++];switch(n&15){case 8:this.method=8;break;default:m(Error("unsupported compression method"))}0!==((n<<8)+r)%31&&m(Error("invalid fcheck flag:"+((n<<8)+r)%31)),r&32&&m(Error("fdict flag is not supported")),this.wh=new sf(e,{index:this.M,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}function $f(){Re.call(this),this.f="parserRAW"}function ag(){Re.call(this),this.f="parserLUT"}function bg(){Re.call(this),this.f="parserMRC"}function cg(){Re.call(this),this.f="parserNRRD"}function dg(){Re.call(this),this.f="parserSTL"}function eg(){Re.call(this),this.f="parserNII"}function fg(e){var t=-1,t="undefined"==typeof DataView?(new Int32Array(e,0,1))[0]:(new DataView(e,0)).getInt32(0,q);return 348==t?q:u}function gg(){Re.call(this),this.f="parserTRK"}function hg(){Re.call(this),this.f="parserOBJ"}function ig(){M.call(this),this.f="loader",this.Kc=new zc,this.td=0}function jg(e,t){e.td+=t/e.Kc.sf()/3,e.td=Math.min(1,e.td);var n=new Od;n.Ad=e.td,e.dispatchEvent(n)}function kg(e){e=e.r.$d;var t=e.split(".").pop().toUpperCase();return t==e.toUpperCase()&&(t=""),t in lg||m(Error("The "+t+" file format is not supported.")),[e,t,lg[t][0],lg[t][1],lg[t][2]]}function mg(e){function t(e,t,r){return t=2*t*Math.PI,t=za(Aa(a,Math.cos(t)),Aa(f,Math.sin(t))),e=za(za(n,Aa(i,e)),Aa(t,s)),r=za(Aa(t,1-Math.abs(r)),Aa(o,r)),new kc(e,r)}this.Z=[],e=e||{};var n=new ya(e.start||[0,-1,0]),r=new ya(e.end||[0,1,0]),i=Ca(r,n),s=e.zb||1;e=e.ta||16;for(var o=Da(i),u=.5<Math.abs(o.y()),a=Da((new ya(u,!u,0)).sc(o)),f=Da(a.sc(o)),u=new kc(n,Ea(o)),r=new kc(r,Da(o)),l=[],c=0;c<e;c++){var h=c/e,p=(c+1)/e;l.push(new mc([u,t(0,h,-1),t(0,p,-1)])),l.push(new mc([t(0,p,0),t(0,h,0),t(1,h,0),t(1,p,0)])),l.push(new mc([r,t(1,p,1),t(1,h,1)]))}return uc(l)}function ng(){Y.call(this),this.f="cylinder",this.af=[-10,-10,-10],this.Ke=[10,10,10],this.jc=10,this.bb=32,Fa(this,new od)}function og(e){function t(e,t){e*=2*Math.PI,t*=Math.PI;var i=new ya(Math.cos(e)*Math.sin(t),Math.cos(t),Math.sin(e)*Math.sin(t));o.push(new kc(za(n,Aa(i,r)),i))}this.Z=[],e=e||{};var n=new ya(e.lf||[0,0,0]),r=e.zb||1,i=e.ta||16;e=e.lk||8;for(var s=[],o=[],u=0;u<i;u++)for(var a=0;a<e;a++)o=[],t(u/i,a/e),0<a&&t((u+1)/i,a/e),a<e-1&&t((u+1)/i,(a+1)/e),t(u/i,(a+1)/e),s.push(new mc(o));return uc(s)}function pg(){Y.call(this),this.f="sphere",this.z=[0,0,0],this.jc=5,this.bb=32,this.$h=16,Fa(this,new od)}function hf(e){P.call(this),this.f="labelmap",this.yb=e,this.$e=new Float32Array([-255,-255,-255,-255])}function qg(e){this.Z=[],e=e||{};var t=new ya(e.lf||[0,0,0]),n=e.zb?e.zb.length?e.zb:[e.zb,e.zb,e.zb]:[1,1,1];return uc([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(e){return new mc(e[0].map(function(r){return r=new ya(t.x()+n[0]*(2*!!(r&1)-1),t.y()+n[1]*(2*!!(r&2)-1),t.d()+n[2]*(2*!!(r&4)-1)),new kc(r,new ya(e[1]))}))}))}function rg(){Y.call(this),this.f="cube",this.z=[0,0,0],this.Pe=this.Oe=this.Ne=20,this.nc=[0,1,1,1,1,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0],Fa(this,new od)}function Le(e){Je.call(this,e),this.f="interactor3D",this.ml=u}function sg(e){M.call(this),this.f="array",this.I=[],this.cg=e}function tg(e,t,n){for(var r=0;4>r;r++)if(e[r+0]!==t[r+n])return u;return q}function ug(e,t,n){var r=n-t;if(!(2>r)){r=t+Math.floor(r/2),ug(e,t,r);for(ug(e,r,n);t<r;++t)if(0<e.cg(e.I[t],e.I[r])){var i=e.I[t];e.I[t]=e.I[r];for(var s=e,o=r,u=n;o+1<u&&0>s.cg(s.I[o+1],i);){var a=s,f=o+1,l=a.I[o];a.I[o]=a.I[f],a.I[f]=l,++o}s.I[o]=i}}}function vg(e){Pb.call(this),this.Hb=e,this.S=[]}function xg(e,t,n,r,i){la(n)||(wg[0]=n,n=wg);for(var s=0;s<n.length;s++){var o=L(t,n[s],r||e,i||u,e.Hb||e);e.S.push(o)}}function yg(){}function zg(e){jc.call(this),this.$b=e||Zd(),this.$j=Ag}function Cg(){jc.call(this)}function Dg(e,n){return e.Uf==t?n:e.Gd+Math.round((n-e.Gd)/e.Uf)*e.Uf}function Eg(e){zg.call(this,e),this.Md=new Cg,L(this.Md,"change",this.Ki,u,this)}function Gg(e){var t=e.qe();e.t().setAttribute("aria-valuenow",t)}function Hg(e,n){e==t&&m(Error("No valid parent element.")),n==t&&m(Error("Invalid initial value.")),Eg.call(this),this.f="progressbar",this.ab=e,this.Ue="",this.Td=this.Fb=t,this.fc=[];var r;r=".progress-bar-horizontal {\n  position: relative;\n  border: 1px solid #949dad;\n",r+="  background: white;\n",r+="  padding: 1px;\n",r+="  overflow: hidden;\n",r+="  margin: 2px;\n",r+="  width: 100px;\n",r+="  height: 5px;\n",r+="}";var i;i=".progress-bar-thumb {\n  position: relative;\n  background: #F62217;\n",i+="  overflow: hidden;\n",i+="  width: 0%;\n",i+="  height: 100%;\n",i+="}";var s;s=".progress-bar-thumb-done {\n  background: #57E964;\n}",this.fc=[r,i,s],this.Od(n),this.uf()}function Ig(e){var t=e.t().style.top,n=e.t().style.left;ge(e.t());var r=new Hg(e.ab,100),i=r.t();i.style.position="absolute",i.style.top=t,i.style.left=n,i.classList.add("xtk-progress-bar"),(i.firstElementChild!=p?i.firstElementChild:he(i.firstChild)).classList.add("progress-bar-thumb-done"),e.Td=r}function Jg(e,t,n){return oa(e)?n&&(e=va(e,n)):e&&"function"==typeof e.handleEvent?e=va(e.handleEvent,e):m(Error("Invalid listener argument")),2147483647<t?-1:fa.setTimeout(e,t||0)}function Kg(){M.call(this),this.f="renderer",this.v=window.document.body,this.K=this.v.clientWidth,this.A=this.v.clientHeight,this.T=this.N=this.na=t,this.pb=new sg(nd),this.Ha=[],this.aa=t,this.Zd=this.hd=this.Xd=u,this.a=this.Vb=this.La=t,this.R={PROGRESSBAR_ENABLED:q,INTERMEDIATE_RENDERING:u,SLICENAVIGATORS:q},this.He=-1,window.console.log("XTK release 10 -- 2015-03-17 16:24:45 -- http://www.goXTK.com -- @goXTK")}function Lg(e,t,n,r,i,s,o,u){var a,f;if(a=n.offsetParent){var l="HTML"==a.tagName||"BODY"==a.tagName;if(!l||"static"!=pe(a,"position"))f=ue(a),l||(l=(l=ve(a))&&jb?-a.scrollLeft:l&&(!K||!Cb("8"))&&"visible"!=pe(a,"overflowX")?a.scrollWidth-a.clientWidth-a.scrollLeft:a.scrollLeft,f=Yd(f,new Xd(l,a.scrollTop)))}a=f||new Xd,f=ue(e),l=ze(e),f=new me(f.x,f.y,l.width,l.height),(l=te(e))&&f.Tg(new me(l.left,l.top,l.right-l.left,l.bottom-l.top));var l=Zd(e),c=Zd(n);if(l.ka!=c.ka){var h=l.ka.body,c=c.ka.parentWindow||c.ka.defaultView,p=new Xd(0,0),d=ae(h)?ae(h).parentWindow||ae(h).defaultView:window,v=h;do{var m=d==c?ue(v):we(v);p.x+=m.x,p.y+=m.y}while(d&&d!=c&&(v=d.frameElement)&&(d=d.parent));h=Yd(p,ue(h)),K&&!je(l)&&(h=Yd(h,ke(l))),f.left+=h.x,f.top+=h.y}e=(t&4&&ve(e)?t^2:t)&-5,t=new Xd(e&2?f.left+f.width:f.left,e&1?f.top+f.height:f.top),t=Yd(t,a),i&&(t.x+=(e&2?-1:1)*i.x,t.y+=(e&1?-1:1)*i.y);var g;return o&&(g=te(n))&&(g.top-=a.y,g.right-=a.x,g.bottom-=a.y,g.left-=a.x),Mg(t,n,r,s,g,o,u)}function Mg(e,t,n,r,i,s,o){e=e.l();var u=0,a=(n&4&&ve(t)?n^2:n)&-5;n=ze(t),o=o?o.l():n.l();if(r||0!=a)a&2?e.x-=o.width+(r?r.right:0):r&&(e.x+=r.left),a&1?e.y-=o.height+(r?r.bottom:0):r&&(e.y+=r.top);if(s){i?(u=e,r=0,65==(s&65)&&(u.x<i.left||u.x>=i.right)&&(s&=-2),132==(s&132)&&(u.y<i.top||u.y>=i.bottom)&&(s&=-5),u.x<i.left&&s&1&&(u.x=i.left,r|=1),u.x<i.left&&u.x+o.width>i.right&&s&16&&(o.width=Math.max(o.width-(u.x+o.width-i.right),0),r|=4),u.x+o.width>i.right&&s&1&&(u.x=Math.max(i.right-o.width,i.left),r|=1),s&2&&(r|=(u.x<i.left?16:0)|(u.x+o.width>i.right?32:0)),u.y<i.top&&s&4&&(u.y=i.top,r|=2),u.y<=i.top&&u.y+o.height<i.bottom&&s&32&&(o.height=Math.max(o.height-(i.top-u.y),0),u.y=0,r|=8),u.y>=i.top&&u.y+o.height>i.bottom&&s&32&&(o.height=Math.max(o.height-(u.y+o.height-i.bottom),0),r|=8),u.y+o.height>i.bottom&&s&4&&(u.y=Math.max(i.bottom-o.height,i.top),r|=2),s&8&&(r|=(u.y<i.top?64:0)|(u.y+o.height>i.bottom?128:0)),u=r):u=256;if(u&496)return u}return s=e,i=jb&&(ab||qb)&&Cb("1.9"),s instanceof Xd?(e=s.x,s=s.y):(e=s,s=p),t.style.left=ye(e,i),t.style.top=ye(s,i),n!=o&&(!n||!o?!0:n.width!=o.width||n.height!=o.height)&&(e=je(Zd(ae(t))),K&&(!e||!Cb("8"))?(n=t.style,e?(K?(e=De(t,"paddingLeft"),i=De(t,"paddingRight"),s=De(t,"paddingTop"),r=De(t,"paddingBottom"),e=new le(s,i,r,e)):(e=oe(t,"paddingLeft"),i=oe(t,"paddingRight"),s=oe(t,"paddingTop"),r=oe(t,"paddingBottom"),e=new le(parseFloat(s),parseFloat(i),parseFloat(r),parseFloat(e))),K?(i=Fe(t,"borderLeft"),s=Fe(t,"borderRight"),r=Fe(t,"borderTop"),t=Fe(t,"borderBottom"),t=new le(r,s,t,i)):(i=oe(t,"borderLeftWidth"),s=oe(t,"borderRightWidth"),r=oe(t,"borderTopWidth"),t=oe(t,"borderBottomWidth"),t=new le(parseFloat(r),parseFloat(s),parseFloat(t),parseFloat(i))),n.pixelWidth=o.width-t.left-e.left-e.right-t.right,n.pixelHeight=o.height-t.top-e.top-e.bottom-t.bottom):(n.pixelWidth=o.width,n.pixelHeight=o.height)):(t=t.style,jb?t.MozBoxSizing="border-box":lb?t.WebkitBoxSizing="border-box":t.boxSizing="border-box",t.width=Math.max(o.width,0)+"px",t.height=Math.max(o.height,0)+"px")),u}function Ng(){}function Og(e,t){this.nf=e instanceof Xd?e:new Xd(e,t)}function Pg(e,t,n){this.element=e,this.Fg=t,this.Tj=n}function Qg(e,n){jc.call(this),this.Hb=new vg(this),this.Pf(e||t),n&&(this.$c=n)}function Rg(e,t){e.Ee&&e.Ee.stop(),e.re&&e.re.stop();if(t){if(!e.Ma&&e.Df()){e.H||m(Error("Caller must call setElement before trying to show the popup")),e.tb();var n=ae(e.H);e.Pi&&xg(e.Hb,n,"keydown",e.rj,q);if(e.gi)if(xg(e.Hb,n,"mousedown",e.hh,q),K){var r;try{r=n.activeElement}catch(i){}for(;r&&"IFRAME"==r.nodeName;){try{var s=r.contentDocument||r.contentWindow.document}catch(o){break}n=s,r=n.activeElement}xg(e.Hb,n,"mousedown",e.hh,q),xg(e.Hb,n,"deactivate",e.gh)}else xg(e.Hb,n,"blur",e.gh);"toggle_display"==e.$c?(e.H.style.visibility="visible",Be(e.H,q)):"move_offscreen"==e.$c&&e.tb(),e.Ma=q,e.Ee?($b(e.Ee,"end",e.kh,u,e),e.Ee.play()):e.kh()}}else Sg(e)}function Sg(e,t){return!e.Ma||!e.dispatchEvent({type:"beforehide",target:t})?u:(e.Hb&&e.Hb.Of(),e.Ma=u,e.Wg=xa(),e.re?($b(e.re,"end",wa(e.Eg,t),u,e),e.re.play()):e.Eg(t),q)}function Tg(e,t){this.Xj=4,this.we=t||p,Qg.call(this,e)}function Ug(e){this.ga=new zc,e&&this.df(e)}function Vg(e){var t=typeof e;return"object"==t&&e||"function"==t?"o"+qa(e):t.substr(0,1)+e}function Wg(e,n,r){this.$b=r||(e?Zd(be(e)):Zd()),Tg.call(this,this.$b.Wc("div",{style:"position:absolute;display:none;"})),this.of=new Xd(1,1),this.je=new Ug,e&&Xg(this,e);if(n!=t)if(e=this.t(),"textContent"in e)e.textContent=n;else if(e.firstChild&&3==e.firstChild.nodeType){for(;e.lastChild!=e.firstChild;)e.removeChild(e.lastChild);e.firstChild.data=n}else{for(;r=e.firstChild;)e.removeChild(r);e.appendChild(ae(e).createTextNode(String(n)))}}function Xg(e,t){t=be(t),e.je.add(t),L(t,"mouseover",e.Ni,u,e),L(t,"mouseout",e.Lg,u,e),L(t,"mousemove",e.Mi,u,e),L(t,"focus",e.Li,u,e),L(t,"blur",e.Lg,u,e)}function ch(e,t){var n=ke(e.$b);e.of.x=t.clientX+n.x,e.of.y=t.clientY+n.y}function dh(e,n){try{for(;n&&!e.je.contains(n);)n=n.parentNode;return n}catch(r){return t}}function bh(e,t){if(0==t){var n=e.of.l();return new fh(n)}return new gh(e.Sa)}function eh(e){if(e.anchor)for(var t,n=0;t=Yg[n];n++)ie(t.t(),e.anchor)&&(t.Bg=e,e.nh=t)}function $g(e){e.Kb&&(fa.clearTimeout(e.Kb),e.Kb=p)}function ah(e){2==(e.Kb?e.Ma?4:1:e.Yc?3:e.Ma?2:0)&&(e.Yc=Jg(va(e.ij,e,e.anchor),e.Oi))}function Zg(e){e.Yc&&(fa.clearTimeout(e.Yc),e.Yc=p)}function fh(e,t){Og.call(this,e,t)}function gh(e){Pg.call(this,e,3)}function hh(e,n,r,i){e==t&&m(Error("No valid parent element.")),(!x(n)||!x(r))&&m(Error("Invalid coordinates.")),(i==t||!(i instanceof Je))&&m(Error("Invalid interactor.")),Wg.call(this),this.f="caption",this.ab=e,this.fe=n,this.ge=r,this.T=i,this.Fb=t,this.fc=[],e=".x-tooltip {\n  background: #C0C0FF;\n  color: #000000;\n",e+="  border: 1px solid infotext;\n",e+="  padding: 1px;\n",e+="  font-family: sans-serif;\n",e+="}",this.fc=[e],$b(i,Cd,this.Fd.bind(this)),this.uf()}function ih(){Kg.call(this),this.f="renderer3D",this.md=this.pd=this.ld=this.od=this.kd=this.nd=this.Ye=this.Ze=t,this.z=[0,0,0],this.bd=[0,0,0],this.rg=t,this.Ie=new zc,this.xd=new zc,this.pc=new zc,this.qd=new zc,this.Ec=new zc,this.Pc=new zc,this.oc=new zc,this.wd=new zc,this.R={PROGRESSBAR_ENABLED:q,PICKING_ENABLED:q,ORDERING_ENABLED:q,STATISTICS_ENABLED:u,INTERMEDIATE_RENDERING:u}}function jh(){Y.call(this),this.f="mesh",Fa(this,new xc)}function kh(){Y.call(this),this.f="fibers",Fa(this,new xc)}function lh(){Kg.call(this),this.f="renderer2D",this.Qa=t,this.Fa=-1,this.Sb=[],this.kg=this.fd=this.fg=this.Vd=t,this.Rc=this.Uc=this.Qc=this.Tc=0,this.ea=this.fa=this.W=this.U=this.Je=-1,this.lg=new Float32Array([-255,-255,-255,-255]),this.sg=q,this.xb=1}function ph(e){var t=Math.min(e.K/(e.Tc*e.Uc),e.A/(e.Qc*e.Rc));e.N.o[14]=t}!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define("dicomParser",[],t):(void 0===dicomParser&&(dicomParser={},"undefined"!=typeof Package&&(e.dicomParser=dicomParser)),dicomParser=t())}(this,function(){function e(e,t){function n(){l.seek(128);var e=l.readFixedString(4);if("DICM"!==e)throw"dicomParser.parseDicom: DICM prefix not found at location 132"}function r(){n();for(var e=[],t={};l.position<l.byteArray.length;){var r=l.position,i=dicomParser.readDicomElementExplicit(l,e);if(i.tag>"x0002ffff"){l.position=r;break}i.parser=dicomParser.littleEndianByteArrayParser,t[i.tag]=i}var s=new dicomParser.DataSet(l.byteArrayParser,l.byteArray,t);return s.warnings=l.warnings,s}function i(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var t=e.elements.x00020010;return dicomParser.readFixedString(l.byteArray,t.dataOffset,t.length)}function s(e){return"1.2.840.10008.1.2"===e?!1:!0}function o(t){return"1.2.840.10008.1.2.2"===t?new dicomParser.ByteStream(dicomParser.bigEndianByteArrayParser,e,l.position):new dicomParser.ByteStream(dicomParser.littleEndianByteArrayParser,e,l.position)}function u(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}function a(e){var n=i(e),r=s(n),u=o(n),a={},f=new dicomParser.DataSet(u.byteArrayParser,u.byteArray,a);f.warnings=u.warnings;try{r?dicomParser.parseDicomDataSetExplicit(f,u,u.byteArray.length,t):dicomParser.parseDicomDataSetImplicit(f,u,u.byteArray.length,t)}catch(l){var c={exception:l,dataSet:f};throw c}return f}function f(){var e=r(),t=a(e);return u(e,t)}if(void 0===e)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";var l=new dicomParser.ByteStream(dicomParser.littleEndianByteArrayParser,e);return f()}return void 0===dicomParser?{parseDicom:e}:(dicomParser.parseDicom=e,dicomParser)});var dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.bigEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3];return n},readInt32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];return n},readFloat:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3];var r=new Float32Array(n.buffer);return r[0]},readDouble:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7];var r=new Float64Array(n.buffer);return r[0]}},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readFixedString=function(e,t,n){if(0>n)throw"readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r="",i=0;n>i;i++){var s=e[t+i];if(0===s)return t+=n,r;r+=String.fromCharCode(s)}return r},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.ByteStream=function(e,t,n){if(void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(t instanceof Uint8Array==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array";if(0>n)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(n>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=e,this.byteArray=t,this.position=n?n:0,this.warnings=[]},e.ByteStream.prototype.seek=function(e){if(this.position+e<0)throw"cannot seek to position < 0";this.position+=e},e.ByteStream.prototype.readByteStream=function(t){if(this.position+t>this.byteArray.length)throw"readByteStream - buffer overread";var n=new Uint8Array(this.byteArray.buffer,this.position,t);return this.position+=t,new e.ByteStream(this.byteArrayParser,n)},e.ByteStream.prototype.readUint16=function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e},e.ByteStream.prototype.readUint32=function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e},e.ByteStream.prototype.readFixedString=function(t){var n=e.readFixedString(this.byteArray,this.position,t);return this.position+=t,n},e}(dicomParser),dicomParser=function(e){"use strict";function t(e,t){return void 0!==e.parser?e.parser:t}return void 0===e&&(e={}),e.DataSet=function(e,t,n){this.byteArrayParser=e,this.byteArray=t,this.elements=n},e.DataSet.prototype.uint16=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readUint16(this.byteArray,r.dataOffset+2*n):void 0},e.DataSet.prototype.int16=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readInt16(this.byteArray,r.dataOffset+2*n):void 0},e.DataSet.prototype.uint32=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readUint32(this.byteArray,r.dataOffset+4*n):void 0},e.DataSet.prototype.int32=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readInt32(this.byteArray,r.dataOffset+4*n):void 0},e.DataSet.prototype.float=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readFloat(this.byteArray,r.dataOffset+4*n):void 0},e.DataSet.prototype.double=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readDouble(this.byteArray,r.dataOffset+8*n):void 0},e.DataSet.prototype.numStringValues=function(t){var n=this.elements[t];if(n&&n.length>0){var r=e.readFixedString(this.byteArray,n.dataOffset,n.length),i=r.match(/\\/g);return null===i?1:i.length+1}return void 0},e.DataSet.prototype.string=function(t,n){var r=this.elements[t];if(r&&r.length>0){var i=e.readFixedString(this.byteArray,r.dataOffset,r.length);if(n>=0){var s=i.split("\\");return s[n].trim()}return i.trim()}return void 0},e.DataSet.prototype.text=function(t,n){var r=this.elements[t];if(r&&r.length>0){var i=e.readFixedString(this.byteArray,r.dataOffset,r.length);if(n>=0){var s=i.split("\\");return s[n].replace(/ +$/,"")}return i.replace(/ +$/,"")}return void 0},e.DataSet.prototype.floatString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return parseFloat(r)}return void 0},e.DataSet.prototype.intString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return parseInt(r)}return void 0},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.findEndOfEncapsulatedElement=function(t,n,r){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";n.encapsulatedPixelData=!0,n.basicOffsetTable=[],n.fragments=[];var i=e.readTag(t);if("xfffee000"!==i)throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var s=t.readUint32(),o=s/4,u=0;o>u;u++){var f=t.readUint32();n.basicOffsetTable.push(f)}for(var l=t.position;t.position<t.byteArray.length;){var c=e.readTag(t),h=t.readUint32();if("xfffee0dd"===c)return t.seek(h),void (n.length=t.position-n.dataOffset);if("xfffee000"!==c)return r&&r.push("unexpected tag "+c+" while searching for end of pixel data element with undefined length"),h>t.byteArray.length-t.position&&(h=t.byteArray.length-t.position),n.fragments.push({offset:t.position-l-8,position:t.position,length:h}),t.seek(h),void (n.length=t.position-n.dataOffset);n.fragments.push({offset:t.position-l-8,position:t.position,length:h}),t.seek(h)}r&&r.push("pixel data element "+n.tag+" missing sequence delimiter tag xfffee0dd")},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.findItemDelimitationItemAndSetElementLength=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=8,r=e.byteArray.length-n;e.position<=r;){var i=e.readUint16();if(65534===i){var s=e.readUint16();if(57357===s){var o=e.readUint32();return 0!==o&&e.warnings("encountered non zero length following item delimiter at position"+e.position-4+" while reading element of undefined length with tag ' + element.tag"),void (t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.littleEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256;return n},readInt32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},readFloat:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3];var r=new Float32Array(n.buffer);return r[0]},readDouble:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7];var r=new Float64Array(n.buffer);return r[0]}},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.parseDicomDataSetExplicit=function(t,n,r,i){if(r=void 0===r?n.byteArray.length:r,i=i||{},void 0===n)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(r<n.position||r>n.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var s=t.elements;n.position<r;){var o=e.readDicomElementExplicit(n,t.warnings,i.untilTag);if(s[o.tag]=o,o.tag===i.untilTag)return}},e.parseDicomDataSetImplicit=function(t,n,r,i){if(r=void 0===r?t.byteArray.length:r,i=i||{},void 0===n)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(r<n.position||r>n.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var s=t.elements;n.position<r;){var o=e.readDicomElementImplicit(n,i.untilTag);if(s[o.tag]=o,o.tag===i.untilTag)return}},e}(dicomParser),dicomParser=function(e){"use strict";function t(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}return void 0===e&&(e={}),e.readDicomElementExplicit=function(n,r,i){if(void 0===n)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var s={tag:e.readTag(n),vr:n.readFixedString(2)},o=t(s.vr);return 2===o?(s.length=n.readUint16(),s.dataOffset=n.position):(n.seek(2),s.length=n.readUint32(),s.dataOffset=n.position),4294967295===s.length&&(s.hadUndefinedLength=!0),s.tag===i?s:"SQ"===s.vr?(e.readSequenceItemsExplicit(n,s,r),s):4294967295===s.length?"x7fe00010"===s.tag?(e.findEndOfEncapsulatedElement(n,s,r),s):(e.findItemDelimitationItemAndSetElementLength(n,s),s):(n.seek(s.length),s)},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readDicomElementImplicit=function(t,n){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var r={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};if(4294967295===r.length&&(r.hadUndefinedLength=!0),r.tag===n)return r;if(t.position+4<=t.byteArray.length){var i=e.readTag(t);if(t.seek(-4),"xfffee000"===i)return e.readSequenceItemsImplicit(t,r),r}return 4294967295===r.length?(e.findItemDelimitationItemAndSetElementLength(t,r),r):(t.seek(r.length),r)},e}(dicomParser),dicomParser=function(e){"use strict";function t(e,t,n){if(1===t.length)return new Uint8Array(e.byteArray.buffer,t[0].dataOffset,t[0].length);for(var r=new Uint8Array(n),i=0,s=0;s<t.length;s++)for(var o=t[s].dataOffset,u=0;u<t[s].length;u++)r[i++]=e.byteArray[o++];return r}function n(n,r){for(var i=[],s=0;n.position<r&&n.position<n.length;){var o=e.readSequenceItem(n);if("xfffee0dd"===o.tag)break;i.push(o),n.seek(o.length),s+=o.length}var u=t(n,i,s);return u}function r(e,t,r){var i=e.basicOffsetTable.length;if(r>i)throw"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table";var s=e.basicOffsetTable[r];t.seek(s);var o=e.basicOffsetTable[r+1];void 0===o&&(o=t.position+e.length);var u=n(t,o);return u}function i(e,t,r){if(0!==r)throw"dicomParser.readEncapsulatedPixelData: non zero frame specified for single frame encapsulated pixel data";var i=t.position+e.length,s=n(t,i);return s}return void 0===e&&(e={}),e.readEncapsulatedPixelData=function(t,n,s){if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===s)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==n.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(n.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(0>s)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";var o=new e.ByteStream(t.byteArrayParser,t.byteArray,n.dataOffset),u=e.readSequenceItem(o);if("xfffee000"!==u.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";return o.seek(u.length),0!==n.basicOffsetTable.length?r(n,o,s):i(n,o,s)},e}(dicomParser),dicomParser=function(e){"use strict";function t(t,n){for(var r={};t.position<t.byteArray.length;){var i=e.readDicomElementExplicit(t,n);if(r[i.tag]=i,"xfffee00d"===i.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,r)}return t.warnings.push("eof encountered before finding sequence delimitation item while reading sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,r)}function n(n,r){var i=e.readSequenceItem(n);return 4294967295===i.length?(i.hadUndefinedLength=!0,i.dataSet=t(n,r),i.length=n.position-i.dataOffset):(i.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetExplicit(i.dataSet,n,n.position+i.length)),i}function r(e,t,r){for(;e.position<e.byteArray.length;){var i=n(e,r);if(t.items.push(i),"xfffee0dd"===i.tag)return void (t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence element of undefined length with tag "+t.tag),t.length=e.byteArray.length-t.dataOffset}function i(e,t,r){for(var i=t.dataOffset+t.length;e.position<i;){var s=n(e,r);t.items.push(s)}}return void 0===e&&(e={}),e.readSequenceItemsExplicit=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?r(e,t):i(e,t,n)},e}(dicomParser),dicomParser=function(e){"use strict";function t(t){for(var n={};t.position<t.byteArray.length;){var r=e.readDicomElementImplicit(t);if(n[r.tag]=r,"xfffee00d"===r.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,n)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,n)}function n(n){var r=e.readSequenceItem(n);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=t(n),r.length=n.position-r.dataOffset):(r.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetImplicit(r.dataSet,n,n.position+r.length)),r}function r(e,t){for(;e.position<e.byteArray.length;){var r=n(e);if(t.items.push(r),"xfffee0dd"===r.tag)return void (t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}function i(e,t){for(var r=t.dataOffset+t.length;e.position<r;){var i=n(e);t.items.push(i)}}return void 0===e&&(e={}),e.readSequenceItemsImplicit=function(e,t){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?r(e,t):i(e,t)},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readSequenceItem=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var n={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};return n},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readTag=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,n=e.readUint16(),r="x"+("00000000"+(t+n).toString(16)).substr(-8);return r},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.explicitDataSetToJS=function(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var r={};for(var i in t.elements){var s=t.elements[i];if(n.omitPrivateAttibutes!==!0||!e.isPrivateTag(i))if(s.items){for(var o=[],u=0;u<s.items.length;u++)o.push(e.explicitDataSetToJS(s.items[u].dataSet,n));r[i]=o}else{var f;f=void 0,s.length<n.maxElementLength&&(f=e.explicitElementToString(t,s)),r[i]=void 0!==f?f:{dataOffset:s.dataOffset,length:s.length}}}return r},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.explicitElementToString=function(t,n){function r(e,n){for(var r="",i=0;e>i;i++)0!==i&&(r+="/"),r+=n.call(t,o).toString();return r}if(void 0===t||void 0===n)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===n.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var i,s=n.vr,o=n.tag;if(e.isStringVr(s)===!0)i=t.string(o);else{if("AT"==s){var u=t.uint32(o);return void 0===u?void 0:(0>u&&(u=4294967295+u+1),"x"+u.toString(16).toUpperCase())}"US"==s?i=r(n.length/2,t.uint16):"SS"===s?i=r(n.length/2,t.int16):"UL"==s?i=r(n.length/4,t.uint32):"SL"===s?i=r(n.length/4,t.int32):"FD"==s?i=r(n.length/8,t.int32):"FL"==s&&(i=r(n.length/4,t.float))}return i},e}(dicomParser),dicomParser=function(e){"use strict";void 0===e&&(e={});var t={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return e.isStringVr=function(e){return t[e]},e.isPrivateTag=function(e){var t=parseInt(e[4]),n=t%2===1;return n},e.parsePN=function(e){if(void 0===e)return void 0;var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}},e.parseDA=function(e){if(e&&8===e.length){var t=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),r=parseInt(e.substring(6,8),10);return{year:t,month:n,day:r}}return void 0},e.parseTM=function(e){if(e.length>=2){var t=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,r=e.length>=6?parseInt(e.substring(4,6),10):void 0,i=e.length>=8?parseInt(e.substring(7,13),10):void 0;return{hours:t,minutes:n,seconds:r,fractionalSeconds:i}}return void 0},e}(dicomParser),p=void 0,q=!0,t=null,u=!1,w,fa=this,ra="closure_uid_"+(1e9*Math.random()>>>0),sa=0,xa=Date.now||function(){return+(new Date)};ya.prototype={l:function(){return new ya(this.Xa,this.Ya,this.Za)},ac:function(e){return this.Xa*e.x()+this.Ya*e.y()+this.Za*e.d()},se:function(e,t){return za(this,Aa(Ca(e,this),t))},length:function(){return Math.sqrt(this.ac(this))},sc:function(e){return new ya(this.Ya*e.d()-this.Za*e.y(),this.Za*e.x()-this.Xa*e.d(),this.Xa*e.y()-this.Ya*e.x())},x:v("Xa"),y:v("Ya"),d:v("Za")};var D=D||{};D.zk=q,D.Ja=function(a){eval("X.DEV === undefined")||window.console.time(a)},D.Da=function(a){eval("X.DEV === undefined")||window.console.timeEnd(a)},window["X.counter"]=new function(){this.Wh=0,this.qk=function(){return this.Wh++}};var Ha=window.Lh;Function.prototype.bind||(Function.prototype.bind=function(e){function t(){return s.apply(this instanceof n?this:e||window,i.concat(r.call(arguments)))}function n(){}"function"!=typeof this&&m(new TypeError("Function.prototype.bind - what is trying to be bound is not callable"));var r=Array.prototype.slice,i=r.call(arguments,1),s=this;return n.prototype=this.prototype,t.prototype=new n,t});for(var Ia=0,Ja=["ms","moz","webkit","o"],Ka=0;Ka<Ja.length&&!window.requestAnimationFrame;++Ka)window.requestAnimationFrame=window[Ja[Ka]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Ja[Ka]+"CancelAnimationFrame"]||window[Ja[Ka]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(0,16-(t-Ia)),r=window.setTimeout(function(){e(t+n)},n);return Ia=t+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),"slice"in ArrayBuffer.prototype||(ArrayBuffer.prototype.slice=function(e,t){e===p&&m(Error("Not enough arguments."));var n=t||this.byteLength;0>e&&(e=this.byteLength+e),0>n&&(n=this.byteLength+n),n<e&&(n=e=0),0>e&&(e=0),0>n&&(n=0),e>this.byteLength&&(e=this.byteLength),n>this.byteLength&&(n=this.byteLength);for(var r=new ArrayBuffer(n-e),i=new Uint8Array(this),s=new Uint8Array(r),o=e,u=0;o<n;++o,++u)s[u]=i[o];return r}),A("$",Ha),A("Function.prototype.bind",Function.prototype.bind),A("window.requestAnimationFrame",window.requestAnimationFrame),A("window.cancelAnimationFrame",window.cancelAnimationFrame);var La=0;w=Ma.prototype,w.key=0,w.xc=u,w.ie=u,w.Ca=function(e,t,n,r,i,s){oa(e)?this.Ug=q:e&&e.handleEvent&&oa(e.handleEvent)?this.Ug=u:m(Error("Invalid listener argument")),this.bc=e,this.oh=t,this.src=n,this.type=r,this.capture=!!i,this.tf=s,this.ie=u,this.key=++La,this.xc=u},w.handleEvent=function(e){return this.Ug?this.bc.call(this.tf||this.src,e):this.bc.handleEvent.call(this.bc,e)};var Pa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Ta=/&/g,Ua=/</g,Va=/>/g,Wa=/\"/g,Sa=/[&<>\"]/,Xa,Ya,Za,$a,ab,bb,db;$a=Za=Ya=Xa=u;var gb;if(gb=eb()){var hb=fb();Xa=0==gb.indexOf("Opera"),Ya=!Xa&&-1!=gb.indexOf("MSIE"),Za=!Xa&&-1!=gb.indexOf("WebKit"),$a=!Xa&&!Za&&"Gecko"==hb.product}var ib=Xa,K=Ya,jb=$a,lb=Za,mb,pb=fb();mb=pb&&pb.platform||"",ab=-1!=mb.indexOf("Mac"),bb=-1!=mb.indexOf("Win"),db=-1!=mb.indexOf("Linux");var qb=!!fb()&&-1!=(fb().appVersion||"").indexOf("X11"),sb;e:{var wb="",xb;if(ib&&fa.opera)var yb=fa.opera.version,wb="function"==typeof yb?yb():yb;else if(jb?xb=/rv\:([^\);]+)(\)|;)/:K?xb=/MSIE\s+([^\);]+)(\)|;)/:lb&&(xb=/WebKit\/(\S+)/),xb)var zb=xb.exec(eb()),wb=zb?zb[1]:"";if(K){var Ab=rb();if(Ab>parseFloat(wb)){sb=String(Ab);break e}}sb=wb}var Bb={},Db=fa.document,Eb=!Db||!K?p:rb()||("CSS1Compat"==Db.compatMode?parseInt(sb,10):5),Fb=!K||K&&9<=Eb,Gb=K&&!Cb("9");!lb||Cb("528"),jb&&Cb("1.9b")||K&&Cb("8")||ib&&Cb("9.5")||lb&&Cb("528"),jb&&!Cb("8")||K&&Cb("9");var Hb=Array.prototype,Ib=Hb.indexOf?function(e,t,n){return Hb.indexOf.call(e,t,n)}:function(e,n,r){r=r==t?0:0>r?Math.max(0,e.length+r):r;if(na(e))return!na(n)||1!=n.length?-1:e.indexOf(n,r);for(;r<e.length;r++)if(r in e&&e[r]===n)return r;return-1},Jb=Hb.forEach?function(e,t,n){Hb.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=na(e)?e.split(""):e,s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)},Lb=Hb.map?function(e,t,n){return Hb.map.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=Array(r),s=na(e)?e.split(""):e,o=0;o<r;o++)o in s&&(i[o]=t.call(n,s[o],o,e));return i},Mb=Hb.some?function(e,t,n){return Hb.some.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=na(e)?e.split(""):e,s=0;s<r;s++)if(s in i&&t.call(n,i[s],s,e))return q;return u},Qb=0;w=Rb.prototype,w.wc=u,w.defaultPrevented=u,w.xe=q,w.stopPropagation=function(){this.wc=q},w.preventDefault=function(){this.defaultPrevented=q,this.xe=u},Sb[" "]=ga,C(Tb,Rb),w=Tb.prototype,w.target=t,w.relatedTarget=t,w.offsetX=0,w.offsetY=0,w.clientX=0,w.clientY=0,w.screenX=0,w.screenY=0,w.button=0,w.keyCode=0,w.charCode=0,w.ctrlKey=u,w.altKey=u,w.shiftKey=u,w.metaKey=u,w.Wj=u,w.sb=t,w.Ca=function(e,n){var r=this.type=e.type;Rb.call(this,r),this.target=e.target||e.srcElement,this.currentTarget=n;var i=e.relatedTarget;if(i){if(jb){var s;e:{try{Sb(i.nodeName),s=q;break e}catch(o){}s=u}s||(i=t)}}else"mouseover"==r?i=e.fromElement:"mouseout"==r&&(i=e.toElement);this.relatedTarget=i,this.offsetX=lb||e.offsetX!==p?e.offsetX:e.layerX,this.offsetY=lb||e.offsetY!==p?e.offsetY:e.layerY,this.clientX=e.clientX!==p?e.clientX:e.pageX,this.clientY=e.clientY!==p?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0,this.button=e.button,this.keyCode=e.keyCode||0,this.charCode=e.charCode||("keypress"==r?e.keyCode:0),this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.Wj=ab?e.metaKey:e.ctrlKey,this.state=e.state,this.sb=e,e.defaultPrevented&&this.preventDefault(),delete this.wc},w.stopPropagation=function(){Tb.u.stopPropagation.call(this),this.sb.stopPropagation?this.sb.stopPropagation():this.sb.cancelBubble=q},w.preventDefault=function(){Tb.u.preventDefault.call(this);var e=this.sb;if(e.preventDefault)e.preventDefault();else if(e.returnValue=u,Gb)try{if(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)e.keyCode=-1}catch(t){}},w.Gi=v("sb");var Ub={},Vb={},Wb={},Xb={},hc=0;C(jc,Pb),jc.prototype.customEvent_=q,w=jc.prototype,w.Lf=t,w.Qf=ca("Lf"),w.addEventListener=function(e,t,n,r){L(this,e,t,n,r)},w.removeEventListener=function(e,t,n,r){ac(this,e,t,n,r)},w.dispatchEvent=function(e){var t=e.type||e,n=Vb;if(t in n){if(na(e))e=new Rb(e,this);else if(e instanceof Rb)e.target=e.target||this;else{var r=e;e=new Rb(t,this),Qa(e,r)}var r=1,i,n=n[t],t=q in n,s;if(t){i=[];for(s=this;s;s=s.Lf)i.push(s);s=n[q],s.Na=s.oa;for(var o=i.length-1;!e.wc&&0<=o&&s.Na;o--)e.currentTarget=i[o],r&=fc(s,i[o],e.type,q,e)&&e.xe!=u}if(u in n)if(s=n[u],s.Na=s.oa,t)for(o=0;!e.wc&&o<i.length&&s.Na;o++)e.currentTarget=i[o],r&=fc(s,i[o],e.type,u,e)&&e.xe!=u;else for(i=this;!e.wc&&i&&s.Na;i=i.Lf)e.currentTarget=i,r&=fc(s,i,e.type,u,e)&&e.xe!=u;e=Boolean(r)}else e=q;return e},C(M,jc),M.prototype.__defineGetter__("classname",v("f")),M.prototype.__defineGetter__("id",v("qa")),A("X.base",M),kc.prototype={l:function(){return new kc(this.Wa.l(),this.va.l())},uc:function(){this.va=Ea(this.va)}},lc.prototype={l:function(){return new lc(this.va.l(),this.Pd)},uc:function(){this.va=Ea(this.va),this.Pd=-this.Pd}},mc.prototype={l:function(){var e=this.Lb.map(function(e){return e.l()});return new mc(e,this.De)},uc:function(){this.Lb.reverse().map(function(e){e.uc()}),this.Va.uc()}},oc.prototype={l:function(){var e=new oc,t=this.Va&&this.Va.l();return e.Va=t,t=this.Ba&&this.Ba.l(),e.Ba=t,t=this.Aa&&this.Aa.l(),e.Aa=t,e.Ce(this.Z.map(function(e){return e.l()})),e},Y:function(){for(var e=0;e<this.Z.length;e++)this.Z[e].uc();this.Va.uc(),this.Ba&&this.Ba.Y(),this.Aa&&this.Aa.Y(),e=this.Ba,this.Ba=this.Aa,this.Aa=e},Ce:ca("Z")},tc.prototype={l:function(){var e=new tc;return e.Ce(this.Z.map(function(e){return e.l()})),e},Xf:function(e){var t=new oc(this.l().Z);return e=new oc(e.l().Z),rc(t,e),rc(e,t),e.Y(),rc(e,t),e.Y(),pc(t,qc(e)),uc(qc(t))},wa:function(e){var t=new oc(this.l().Z);return e=new oc(e.l().Z),t.Y(),rc(t,e),rc(e,t),e.Y(),rc(e,t),e.Y(),pc(t,qc(e)),t.Y(),uc(qc(t))},vf:function(e){var t=new oc(this.l().Z);return e=new oc(e.l().Z),t.Y(),rc(e,t),e.Y(),rc(t,e),rc(e,t),pc(t,qc(e)),t.Y(),uc(qc(t))},inverse:function(){var e=this.l();return e.Z.map(function(e){e.uc()}),e},Ce:ca("Z")},C(vc,M),vc.prototype.add=function(e){e==t&&m(Error("Invalid object."));var n=window.JSON.stringify(e);return n in this.Ka||(this.Ka[n]=this.bf.length,this.bf.push(e)),this.Ka[n]},vc.prototype.unique=v("bf"),C(wc,M),xc.prototype.__defineSetter__("file",function(e){if(e==t||la(e)&&0==e.length)this.r=t;else{if(la(e)){if(1==e.length){this.r=new wc(e[0]);return}this.r=Lb(e,function(e){var t=new P;return t.r=new wc(e),t})}else this.r=new wc(e);this.$a=t}}),xc.prototype.__defineGetter__("file",function(){return this.r?la(this.r)?this.r.map(function(e){return e.r.$d}):this.r.$d:""}),xc.prototype.__defineGetter__("filedata",function(){return la(this.r)?this.r.map(function(e){return e.$a}):this.$a}),xc.prototype.__defineSetter__("filedata",function(e){if(e==t||la(e)&&0==e.length)this.$a=t;if(la(e))if(1==e.length)this.$a=e[0];else{var n=this.r.length,r;for(r=0;r<n;r++)this.r[r].$a=e[r]}else this.$a=e}),w=zc.prototype,w.oa=0,w.Zf=0,w.sf=v("oa"),w.Dd=function(){Ac(this);for(var e=[],t=0;t<this.S.length;t++)e.push(this.ga[this.S[t]]);return e},w.clear=function(){this.ga={},this.Zf=this.oa=this.S.length=0},w.remove=function(e){return Cc(this.ga,e)?(delete this.ga[e],this.oa--,this.Zf++,this.S.length>2*this.oa&&Ac(this),q):u},w.get=function(e,t){return Cc(this.ga,e)?this.ga[e]:t},w.set=function(e,t){Cc(this.ga,e)||(this.oa++,this.S.push(e),this.Zf++),this.ga[e]=t},w.df=function(e){var t;if(e instanceof zc)Ac(e),t=e.S.concat(),e=e.Dd();else{t=[];var n=0,r;for(r in e)t[n++]=r;e=Oa(e)}for(n=0;n<t.length;n++)this.set(t[n],e[n])},w.l=function(){return new zc(this)},w.Wf=function(){for(var e=new zc,t=0;t<this.S.length;t++){var n=this.S[t];e.set(this.ga[n],n)}return e},C(Dc,M),Dc.prototype.add=function(e,t,n,r,i,s){(!x(e)||!x(n)||!x(r)||!x(i)||!x(s))&&m(Error("Invalid color table entry.")),this.Ka.set(e,[t,n,r,i,s]),this.j=q},Dc.prototype.get=function(e){return this.Ka.get(e)},A("X.colortable.prototype.get",Dc.prototype.get),Ec.prototype.l=function(){return new Ec(this.x,this.y,this.d)},C(R,Ec),w=R.prototype,w.l=function(){return new R(this.x,this.y,this.d)},w.Ib=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.d*this.d)},w.scale=function(e){return this.x*=e,this.y*=e,this.d*=e,this},w.Y=function(){return this.x=-this.x,this.y=-this.y,this.d=-this.d,this},w.normalize=function(){return this.scale(1/this.Ib())},w.add=function(e){return this.x+=e.x,this.y+=e.y,this.d+=e.d,this},w.wa=function(e){return this.x-=e.x,this.y-=e.y,this.d-=e.d,this},D.m=R,w=D.m.prototype,w.l=R.prototype.l,w.Ib=R.prototype.Ib,w.scale=R.prototype.scale,w.Y=R.prototype.Y,w.add=R.prototype.add,w.wa=R.prototype.wa,w.normalize=function(){var e=this.Ib();return 0==e?this.scale(0):this.scale(1/e)},D.m.ac=function(e,t){return e.x*t.x+e.y*t.y+e.d*t.d},D.m.sc=Ic,D.m.rf=Fc,D.m.se=function(e,t,n){return new R(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y),e.d+n*(t.d-e.d))},D.m.prototype.__defineGetter__("xx",v("x")),D.m.prototype.__defineGetter__("yy",v("y")),D.m.prototype.__defineGetter__("zz",v("d")),A("X.vector",D.m),A("X.vector.prototype.clone",D.m.prototype.l),A("X.vector.prototype.magnitude",D.m.prototype.Ib),A("X.vector.prototype.scale",D.m.prototype.scale),A("X.vector.prototype.invert",D.m.prototype.Y),A("X.vector.prototype.normalize",D.m.prototype.normalize),A("X.vector.prototype.add",D.m.prototype.add),A("X.vector.prototype.subtract",D.m.prototype.wa),A("X.vector.dot",D.m.ac),A("X.vector.cross",D.m.sc),A("X.vector.distance",D.m.rf),A("X.vector.lerp",D.m.se),Jc.prototype.BYTES_PER_ELEMENT=8,Jc.prototype.set=function(e,t){t=t||0;for(var n=0;n<e.length&&t+n<this.length;n++)this[t+n]=e[n]},Jc.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{Jc.BYTES_PER_ELEMENT=8}catch(Kc){}Jc.prototype.BYTES_PER_ELEMENT=Jc.prototype.BYTES_PER_ELEMENT,Jc.prototype.set=Jc.prototype.set,Jc.prototype.toString=Jc.prototype.toString,A("Float64Array",Jc)}Lc.prototype.BYTES_PER_ELEMENT=4,Lc.prototype.set=function(e,t){t=t||0;for(var n=0;n<e.length&&t+n<this.length;n++)this[t+n]=e[n]},Lc.prototype.toString=Array.prototype.join,"undefined"==typeof Float32Array&&(Lc.BYTES_PER_ELEMENT=4,Lc.prototype.BYTES_PER_ELEMENT=Lc.prototype.BYTES_PER_ELEMENT,Lc.prototype.set=Lc.prototype.set,Lc.prototype.toString=Lc.prototype.toString,A("Float32Array",Lc)),new Float64Array(3),new Float64Array(3),new Float64Array(4),new Float64Array(4),new Float64Array(4),new Float64Array(16),D.g={},D.g.Xg=function(e,t,n,r){n=n.wa(t),n.normalize(),r=D.m.sc(n,r),r.normalize();var i=D.m.sc(r,n);return i.normalize(),n.Y(),T(e,0,r.x,r.y,r.d,0),T(e,1,i.x,i.y,i.d,0),T(e,2,n.x,n.y,n.d,0),dd(e,-t.x,-t.y,-t.d),e},D.g.ba=function(e,t,n,r){var i=1/(t*e[3]+n*e[7]+r*e[11]+e[15]);return new D.m((t*e[0]+n*e[4]+r*e[8]+e[12])*i,(t*e[1]+n*e[5]+r*e[9]+e[13])*i,(t*e[2]+n*e[6]+r*e[10]+e[14])*i)},D.g.nk=function(e,t,n){var r=new Float32Array(4),i=new Float32Array(4);return Yc(e,t,r),Yc(e,n,i),Xc(e,t,i),Xc(e,n,r),e},D.g.mk=function(e,t,n){var r=new Float32Array(4),i=new Float32Array(4);return Wc(e,t,r),Wc(e,n,i),Vc(e,t,i),Vc(e,n,r),e},D.g.Ed=Sc,D.g.l=function(e){var t=Rc();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},D.g.Wf=function(e,t){if(t==e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},D.g.ti=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14];return e=e[15],(t*o-n*s)*(c*e-h*v)-(t*u-r*s)*(l*e-h*d)+(t*a-i*s)*(l*v-c*d)+(n*u-r*o)*(f*e-h*p)-(n*a-i*o)*(f*v-c*p)+(r*a-i*u)*(f*d-l*p)},D.g.Y=ad,D.g.yf=function(e,t,n,r,i){var s=t/2;t=i-r;var o=Math.sin(s);return 0==t||0==o||0==n?e:(s=Math.cos(s)/o,Tc(e,s/n,0,0,0,0,s,0,0,0,0,-(i+r)/t,-1,0,0,-(2*r*i)/t,0))},D.g.dj=function(e,t,n,r,i,s,o){return Tc(e,2*s/(n-t),0,0,0,0,2*s/(i-r),0,0,(n+t)/(n-t),(i+r)/(i-r),-(o+s)/(o-s),-1,0,0,-(2*o*s)/(o-s),0)},D.g.ej=function(e,t,n,r,i,s,o){return Tc(e,2/(n-t),0,0,0,0,2/(i-r),0,0,0,0,-2/(o-s),0,-(n+t)/(n-t),-(i+r)/(i-r),-(o+s)/(o-s),1)},D.g.multiply=$c,D.g.ah=cd,D.g.translate=dd,D.g.scale=function(e,t,n,r){return Tc(e,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*n,e[5]*n,e[6]*n,e[7]*n,e[8]*r,e[9]*r,e[10]*r,e[11]*r,e[12],e[13],e[14],e[15])},D.g.rotate=function(e,t,n,r,i){var s=e[0],o=e[1],u=e[2],a=e[3],f=e[4],l=e[5],c=e[6],h=e[7],p=e[8],d=e[9],v=e[10],m=e[11],g=Math.cos(t),y=Math.sin(t),b=1-g;t=n*n*b+g;var w=n*r*b+i*y,E=n*i*b-r*y,S=n*r*b-i*y,x=r*r*b+g,T=r*i*b+n*y,N=n*i*b+r*y;return n=r*i*b-n*y,i=i*i*b+g,Tc(e,s*t+f*w+p*E,o*t+l*w+d*E,u*t+c*w+v*E,a*t+h*w+m*E,s*S+f*x+p*T,o*S+l*x+d*T,u*S+c*x+v*T,a*S+h*x+m*T,s*N+f*n+p*i,o*N+l*n+d*i,u*N+c*n+v*i,a*N+h*n+m*i,e[12],e[13],e[14],e[15])},D.g.ye=function(e,t){var n=e[4],r=e[5],i=e[6],s=e[7],o=e[8],u=e[9],a=e[10],f=e[11],l=Math.cos(t),c=Math.sin(t);return e[4]=n*l+o*c,e[5]=r*l+u*c,e[6]=i*l+a*c,e[7]=s*l+f*c,e[8]=n*-c+o*l,e[9]=r*-c+u*l,e[10]=i*-c+a*l,e[11]=s*-c+f*l,e},D.g.ze=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[8],u=e[9],a=e[10],f=e[11],l=Math.cos(t),c=Math.sin(t);return e[0]=n*l+o*-c,e[1]=r*l+u*-c,e[2]=i*l+a*-c,e[3]=s*l+f*-c,e[8]=n*c+o*l,e[9]=r*c+u*l,e[10]=i*c+a*l,e[11]=s*c+f*l,e},D.g.Ae=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=Math.cos(t),c=Math.sin(t);return e[0]=n*l+o*c,e[1]=r*l+u*c,e[2]=i*l+a*c,e[3]=s*l+f*c,e[4]=n*-c+o*l,e[5]=r*-c+u*l,e[6]=i*-c+a*l,e[7]=s*-c+f*l,e},A("X.matrix.identity",D.g.Ed),A("X.matrix.clone",D.g.l),A("X.matrix.transpose",D.g.Wf),A("X.matrix.determinant",D.g.ti),A("X.matrix.invert",D.g.Y),A("X.matrix.multiply",D.g.multiply),A("X.matrix.multiplyByVector",D.g.ba),A("X.matrix.multiplyByVec4",D.g.ah),A("X.matrix.makePerspective",D.g.yf),A("X.matrix.makeFrustum",D.g.dj),A("X.matrix.makeOrtho",D.g.ej),A("X.matrix.makeLookAt",D.g.Xg),A("X.matrix.translate",D.g.translate),A("X.matrix.scale",D.g.scale),A("X.matrix.rotate",D.g.rotate),A("X.matrix.rotateX",D.g.ye),A("X.matrix.rotateY",D.g.ze),A("X.matrix.rotateZ",D.g.Ae),A("X.matrix.swapRows",D.g.nk),A("X.matrix.swapCols",D.g.mk),C(ed,M),ed.prototype.__defineGetter__("matrix",v("Q")),ed.prototype.__defineSetter__("matrix",function(e){(e==t||!(e instanceof Float32Array))&&m(Error("Invalid matrix.")),this.Q=e,this.q()}),w=ed.prototype,w.ye=function(e){(!x(e)||-360>e||360<e)&&m(Error("Invalid angle.")),D.g.ye(this.Q,e*Math.PI/180),this.q()},w.ze=function(e){(!x(e)||-360>e||360<e)&&m(Error("Invalid angle.")),D.g.ze(this.Q,e*Math.PI/180),this.q()},w.Ae=function(e){(!x(e)||-360>e||360<e)&&m(Error("Invalid angle.")),D.g.Ae(this.Q,e*Math.PI/180),this.q()},w.Dh=function(e){x(e)||m(Error("Invalid distance.")),D.g.translate(this.Q,e,0,0),this.q()},w.Eh=function(e){x(e)||m(Error("Invalid distance.")),D.g.translate(this.Q,0,e,0),this.q()},w.Fh=function(e){x(e)||m(Error("Invalid distance.")),D.g.translate(this.Q,0,0,e),this.q()},w.Bi=function(){fd(this,0,0)},w.Ci=function(){fd(this,1,1)},w.Di=function(){fd(this,2,2)},w.q=function(){this.j=q},A("X.transform",ed),A("X.transform.prototype.rotateX",ed.prototype.ye),A("X.transform.prototype.rotateY",ed.prototype.ze),A("X.transform.prototype.rotateZ",ed.prototype.Ae),A("X.transform.prototype.translateX",ed.prototype.Dh),A("X.transform.prototype.translateY",ed.prototype.Eh),A("X.transform.prototype.translateZ",ed.prototype.Fh),A("X.transform.prototype.flipX",ed.prototype.Bi),A("X.transform.prototype.flipY",ed.prototype.Ci),A("X.transform.prototype.flipZ",ed.prototype.Di),A("X.transform.prototype.modified",ed.prototype.q),C(gd,M),gd.prototype.__defineSetter__("rawData",function(e){this.Wb=e,this.j=q}),gd.prototype.__defineSetter__("rawDataHeight",function(e){this.We=e,this.j=q}),gd.prototype.__defineSetter__("rawDataWidth",function(e){this.Xe=e,this.j=q}),gd.prototype.__defineSetter__("grayscale",function(e){this.hg=e,this.j=q}),A("X.texture",gd),C(W,M),w=W.prototype,w.add=function(e,t,n){return this.mb=Math.min(this.mb,e),this.jb=Math.max(this.jb,e),this.nb=Math.min(this.nb,t),this.kb=Math.max(this.kb,t),this.ob=Math.min(this.ob,n),this.lb=Math.max(this.lb,n),this.Rd=[(this.mb+this.jb)/2,(this.nb+this.kb)/2,(this.ob+this.lb)/2],this.gg=u,this.j=q,this.da[this.C++]=e,this.da[this.C++]=t,this.da[this.C++]=n,this.C/3},w.Jb=function(){if(this.C!=this.da.length){var e=new Float32Array(this.C);e.set(this.da.subarray(0,this.C)),this.da=e}},w.get=function(e){return e*=3,[this.da[e],this.da[e+1],this.da[e+2]]},w.remove=function(){m(Error("Not implemented."))},w.clear=function(){this.da=new Float32Array(this.da.length),this.j=q},W.prototype.__defineGetter__("count",function(){return this.Jb(),this.da.length/3}),W.prototype.__defineGetter__("length",function(){return this.Jb(),this.da.length}),A("X.triplets",W),A("X.triplets.prototype.add",W.prototype.add),A("X.triplets.prototype.resize",W.prototype.Jb),A("X.triplets.prototype.get",W.prototype.get),A("X.triplets.prototype.remove",W.prototype.remove),A("X.triplets.prototype.clear",W.prototype.clear);var id="TRIANGLES";hd.prototype.__defineSetter__("type",function(e){return this.Ia=e}),hd.prototype.__defineGetter__("type",v("Ia")),hd.prototype.__defineGetter__("texture",function(){return this.G||(this.G=new gd),this.G}),hd.prototype.__defineGetter__("transform",v("ja")),hd.prototype.__defineGetter__("points",v("h")),hd.prototype.__defineSetter__("points",ca("h")),hd.prototype.__defineGetter__("normals",v("n")),hd.prototype.__defineSetter__("normals",ca("n")),hd.prototype.__defineGetter__("colors",v("pa")),hd.prototype.__defineSetter__("colors",ca("pa")),hd.prototype.__defineGetter__("color",v("w")),hd.prototype.__defineSetter__("color",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid color."));for(var n=this.c,r=n.length,i=0,i=0;i<r;i++)n[i].color=e;this.w=e,this.j=q}),hd.prototype.__defineGetter__("opacity",v("za")),hd.prototype.__defineSetter__("opacity",function(e){(!x(e)||1<e||0>e)&&m(Error("Invalid opacity."));for(var n=this.c,r=n.length,i=0,i=0;i<r;i++)n[i]!=t&&(n[i].opacity=e);this.za=e,this.j=q}),hd.prototype.__defineGetter__("caption",v("Dc")),hd.prototype.__defineSetter__("caption",function(e){this.Dc=e,this.j=q}),hd.prototype.__defineGetter__("visible",v("O")),hd.prototype.__defineSetter__("visible",function(e){for(var n=this.c,r=n.length,i=0,i=0;i<r;i++)n[i]!=t&&(n[i].visible=e);this.O=e,this.j=q}),hd.prototype.__defineGetter__("pointsize",v("sd")),hd.prototype.__defineSetter__("pointsize",function(e){x(e)||m(Error("Invalid point size.")),this.sd=e,this.j=q}),hd.prototype.__defineGetter__("magicmode",v("jd")),hd.prototype.__defineSetter__("magicmode",function(e){"boolean"!=typeof e&&m(Error("Invalid magic mode setting.")),this.jd=e,this.j=q}),hd.prototype.__defineGetter__("linewidth",v("Lc")),hd.prototype.__defineSetter__("linewidth",function(e){x(e)||m(Error("Invalid line width.")),this.Lc=e,this.j=q}),hd.prototype.__defineGetter__("pickable",v("rd")),hd.prototype.__defineSetter__("pickable",function(e){"boolean"!=typeof e&&m(Error("Invalid pickable setting.")),this.rd=e,this.j=q}),hd.prototype.__defineGetter__("textureCoordinateMap",v("nc")),hd.prototype.__defineSetter__("textureCoordinateMap",ca("sl")),jd.prototype.__defineGetter__("lowerThreshold",v("U")),jd.prototype.__defineSetter__("lowerThreshold",ca("U")),jd.prototype.__defineGetter__("upperThreshold",v("W")),jd.prototype.__defineSetter__("upperThreshold",ca("W")),jd.prototype.__defineGetter__("min",v("ra")),jd.prototype.__defineGetter__("max",v("ia")),jd.prototype.__defineGetter__("minColor",v("Rb")),jd.prototype.__defineSetter__("minColor",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid min. color.")),this.Rb=e}),jd.prototype.__defineGetter__("maxColor",v("Pb")),jd.prototype.__defineSetter__("maxColor",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid max. color.")),this.Pb=e}),C(kd,M),kd.prototype.__defineGetter__("array",v("I")),kd.prototype.__defineSetter__("array",function(e){this.dd=this.I=e,this.j=q}),kd.prototype.__defineGetter__("interpolation",v("Le")),kd.prototype.__defineSetter__("interpolation",ca("Le")),A("X.scalars",kd),C(Y,M),Y.prototype.rc=function(e){this.Ia=e.Ia,this.ja=new ed,this.ja.Q=new Float32Array(e.ja.Q),this.w=e.w.slice(),e.h&&(this.h=new W(e.h.length,e.h)),e.n&&(this.n=new W(e.n.length,e.n)),e.pa&&(this.pa=new W(e.pa.length,e.pa)),this.G=e.G,this.nc=e.nc,e.r&&(this.r=new wc((new String(e.r.$d)).toString())),this.za=e.za,this.c.length=0;var t=e.c;if(t)for(var n=t.length,r=0,r=0;r<n;r++)this.c.push(new D[t[r].f](t[r]));this.O=e.O,this.sd=e.sd,this.Lc=e.Lc,e.Dc&&(this.Dc=(new String(e.Dc)).toString()),this.jd=e.jd,this.rd=e.rd,this.Nc=e.Nc.slice(),this.j=q},Y.prototype.__defineGetter__("colortable",function(){return this.xa||(this.xa=new Dc),this.xa}),Y.prototype.__defineGetter__("scalars",function(){return this.F||(this.F=new kd),this.F}),Y.prototype.__defineGetter__("children",v("c")),Y.prototype.q=function(){var e=new ld;e.D=this,this.dispatchEvent(e)},Y.prototype.remove=function(){var e=new md;e.D=this,this.dispatchEvent(e)},Y.prototype.Ta=function(){dc(this);if(0<this.c.length)for(var e=this.c,n=e.length,r=0,r=0;r<n;r++)"undefined"!=typeof e[r]&&this.c[r].Ta();this.c.length=0,this.F=this.xa=t},A("X.object",Y),A("X.object.prototype.modified",Y.prototype.q),A("X.object.prototype.remove",Y.prototype.remove),A("X.object.prototype.destroy",Y.prototype.Ta),od.prototype.Xf=function(e){(e==t||!(e instanceof tc)&&!(e instanceof Y))&&m(Error("Invalid object."));var n=e;return e instanceof Y&&(n=pd(n)),e=new Y,Fa(e,new od),qd(e,pd(this).Xf(n)),e},od.prototype.wa=function(e){(e==t||!(e instanceof tc)&&!(e instanceof Y))&&m(Error("Invalid object."));var n=e;return e instanceof Y&&(n=pd(n)),e=new Y,Fa(e,new od),qd(e,pd(this).wa(n)),e},od.prototype.vf=function(e){(e==t||!(e instanceof tc)&&!(e instanceof Y))&&m(Error("Invalid object."));var n=e;return e instanceof Y&&(n=pd(n)),e=new Y,Fa(e,new od),qd(e,pd(this).vf(n)),e},od.prototype.inverse=function(){var e=new Y;return Fa(e,new od),qd(e,pd(this).inverse()),e},A("X.constructable",od),A("X.constructable.prototype.intersect",od.prototype.vf),A("X.constructable.prototype.inverse",od.prototype.inverse),A("X.constructable.prototype.subtract",od.prototype.wa),A("X.constructable.prototype.union",od.prototype.Xf),C(rd,Rb);var sd=ic("pan"),td=ic("rotate"),ud=ic("zoom"),vd=ic("scroll");ic("render");var wd=ic("resetview"),xd=ic("windowlevel"),yd=ic("modified"),zd=ic("remove"),Ad=ic("progress"),Bd=ic("hover"),Cd=ic("hover_end"),Dd=ic("computing"),Ed=ic("computing_end"),Fd=ic("computing_progress");C(Gd,rd),C(Hd,rd),C(Id,rd),C(Jd,rd),C(Kd,rd),C(Ld,rd),C(Md,rd),C(Nd,rd),C(ld,rd),C(md,rd),C(Od,rd),C(Pd,rd),C(Qd,rd),C(Rd,rd),A("X.event.events.PAN",sd),A("X.event.events.ROTATE",td),A("X.event.events.ZOOM",ud),A("X.event.events.SCROLL",vd),C(Sd,M);var Td;w=Vd.prototype,w.l=function(){return new Vd(this.width,this.height)},w.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},w.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},w.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},w.scale=function(e,t){var n=x(t)?t:e;return this.width*=e,this.height*=n,this};var Wd=!K||K&&9<=Eb;!jb&&!K||K&&K&&9<=Eb||jb&&Cb("1.9.1"),K&&Cb("9"),w=Xd.prototype,w.l=function(){return new Xd(this.x,this.y)},w.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},w.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},w.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},w.translate=function(e,t){return e instanceof Xd?(this.x+=e.x,this.y+=e.y):(this.x+=e,x(t)&&(this.y+=t)),this},w.scale=function(e,t){var n=x(t)?t:e;return this.x*=e,this.y*=n,this};var ce={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};w=$d.prototype,w.ne=Zd,w.t=function(e){return na(e)?this.ka.getElementById(e):e},w.Lh=$d.prototype.t,w.Wc=function(e,t,n){return ee(this.ka,arguments)},w.createElement=function(e){return this.ka.createElement(e)},w.createTextNode=function(e){return this.ka.createTextNode(String(e))},w.appendChild=function(e,t){e.appendChild(t)},w.contains=ie,w=le.prototype,w.l=function(){return new le(this.top,this.right,this.bottom,this.left)},w.contains=function(e){return!this||!e?u:e instanceof le?e.left>=this.left&&e.right<=this.right&&e.top>=this.top&&e.bottom<=this.bottom:e.x>=this.left&&e.x<=this.right&&e.y>=this.top&&e.y<=this.bottom},w.ceil=function(){return this.top=Math.ceil(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this.left=Math.ceil(this.left),this},w.floor=function(){return this.top=Math.floor(this.top),this.right=Math.floor(this.right),this.bottom=Math.floor(this.bottom),this.left=Math.floor(this.left),this},w.round=function(){return this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this.left=Math.round(this.left),this},w.translate=function(e,t){return e instanceof Xd?(this.left+=e.x,this.right+=e.x,this.top+=e.y,this.bottom+=e.y):(this.left+=e,this.right+=e,x(t)&&(this.top+=t,this.bottom+=t)),this},w.scale=function(e,t){var n=x(t)?t:e;return this.left*=e,this.right*=e,this.top*=n,this.bottom*=n,this},w=me.prototype,w.l=function(){return new me(this.left,this.top,this.width,this.height)},w.Tg=function(e){var t=Math.max(this.left,e.left),n=Math.min(this.left+this.width,e.left+e.width);if(t<=n){var r=Math.max(this.top,e.top);e=Math.min(this.top+this.height,e.top+e.height);if(r<=e)return this.left=t,this.top=r,this.width=n-t,this.height=e-r,q}return u},w.contains=function(e){return e instanceof me?this.left<=e.left&&this.left+this.width>=e.left+e.width&&this.top<=e.top&&this.top+this.height>=e.top+e.height:e.x>=this.left&&e.x<=this.left+this.width&&e.y>=this.top&&e.y<=this.top+this.height},w.rf=function(e){return Math.sqrt(ne(this,e))},w.ceil=function(){return this.left=Math.ceil(this.left),this.top=Math.ceil(this.top),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},w.floor=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},w.round=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.width=Math.round(this.width),this.height=Math.round(this.height),this},w.translate=function(e,t){return e instanceof Xd?(this.left+=e.x,this.top+=e.y):(this.left+=e,x(t)&&(this.top+=t)),this},w.scale=function(e,t){var n=x(t)?t:e;return this.left*=e,this.width*=e,this.top*=n,this.height*=n,this};var Ee={thin:2,medium:4,thick:6},xe=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;C(Ge,jc),Ge.prototype.handleEvent=function(e){var t=0,n=0,r=0;e=e.sb;if("mousewheel"==e.type){n=1;if(K||lb&&(bb||Cb("532.0")))n=40;r=He(-e.wheelDelta,n),ia(e.wheelDeltaX)?(t=He(-e.wheelDeltaX,n),n=He(-e.wheelDeltaY,n)):n=r}else r=e.detail,100<r?r=3:-100>r&&(r=-3),ia(e.axis)&&e.axis===e.HORIZONTAL_AXIS?t=r:n=r;x(this.Yg)&&(t=Math.min(Math.max(t,-this.Yg),this.Yg)),x(this.Zg)&&(n=Math.min(Math.max(n,-this.Zg),this.Zg)),this.aj&&(t=-t),t=new Ie(r,e,t,n),this.dispatchEvent(t)},C(Ie,Tb),K||lb&&Cb("525"),C(Je,M),Je.prototype.__defineGetter__("config",v("R")),Je.prototype.__defineGetter__("leftButtonDown",v("wb")),Je.prototype.__defineGetter__("middleButtonDown",v("Qb")),Je.prototype.__defineGetter__("rightButtonDown",v("Xb")),Je.prototype.Ca=function(){this.R.MOUSEWHEEL_ENABLED?(this.Re=new Ge(this.Oa),this.qg=L(this.Re,"mousewheel",this.Kd.bind(this))):(bc(this.qg),this.Re=t),this.R.MOUSECLICKS_ENABLED?(this.mg=L(this.Oa,"mousedown",this.vj.bind(this)),this.pg=L(this.Oa,"mouseup",this.Aj.bind(this))):(bc(this.mg),bc(this.pg)),this.Oa.oncontextmenu=this.R.CONTEXTMENU_ENABLED?t:function(){return u},window.onkeydown=this.R.KEYBOARD_ENABLED?this.ih.bind(this):t,this.R.TOUCH_ENABLED?(this.R.TOUCH_BOUNCING_ENABLED||document.body.addEventListener("touchmove",function(e){e.preventDefault()},u),this.ci=L(this.Oa,"touchstart",this.Pj.bind(this)),this.bi=L(this.Oa,"touchmove",this.Nj.bind(this)),this.ai=L(this.Oa,"touchend",this.Jj.bind(this))):(bc(this.ci),bc(this.bi),bc(this.ai)),bc(this.ng),bc(this.og),this.ng=L(this.Oa,"mousemove",this.xj.bind(this)),this.og=L(this.Oa,"mouseout",this.yj.bind(this))},Je.prototype.vj=function(a){0==a.button?this.wb=q:1==a.button?this.Qb=q:2==a.button&&(this.Xb=q),eval("this.onMouseDown("+this.wb+","+this.Qb+","+this.Xb+")"),Ke(this),a.preventDefault()},Je.prototype.uj=aa(),Je.prototype.Aj=function(a){0==a.button?this.wb=u:1==a.button?this.Qb=u:2==a.button&&(this.Xb=u),eval("this.onMouseUp("+this.wb+","+this.Qb+","+this.Xb+")"),Ke(this),a.preventDefault()},Je.prototype.__defineGetter__("mousePosition",v("ua")),w=Je.prototype,w.zj=aa(),w.yj=function(e){this.Yd=u,this.R.KEYBOARD_ENABLED&&(window.onkeydown=t),this.Xb=this.Qb=this.wb=u,Ke(this),this.Me=new D.m(0,0,0),e.preventDefault()},w.wj=aa(),w.Pj=function(a){a.preventDefault(),a.Ca(a.sb.targetTouches[0],a.currentTarget),eval("this.onTouchStart("+a.clientX+","+a.clientY+")"),this.gd=new D.m(a.clientX,a.clientY,0),this.xg=setTimeout(this.Lj.bind(this,a),500)},w.Oj=aa(),w.Lj=function(a){eval("this.onTouchHover("+a.clientX+","+a.clientY+")"),a=new Jd,a.vb=q,a.hb=this instanceof Le,this.dispatchEvent(a),this.be=q},w.Kj=aa(),w.Jj=function(a){a.preventDefault(),eval("this.onTouchEnd()"),Me(this)},w.Ij=aa(),w.Nj=function(a){a.preventDefault(),this.be||Me(this),this.touchmoveEvent=a=a.sb,eval("this.onTouchMove(this['touchmoveEvent'])");var b=a.targetTouches;if(1==b.length){a=b[0];var c=[a.clientX,a.clientY];a=new D.m(c[0],c[1],0);var b=c[0]>3*this.Oa.clientWidth/4,e=c[0]<this.Oa.clientWidth/4,d=c[1]<this.Oa.clientHeight/4,c=c[1]>3*this.Oa.clientHeight/4,c=!b&&!e&&!d&&!c,d=this.gd.wa(a);this.gd=a.l();if(this.be)a=new Hd,5<d.x?d.x=1:-5>d.x&&(d.x=-1),5<d.y?d.y=1:-5>d.y&&(d.y=-1),a.ya=d,this.dispatchEvent(a);else if(this instanceof Ne&&(b||e))a=new Kd,a.V=0>d.y,this.dispatchEvent(a);else if(this instanceof Le||c)d.scale(3),a=new Id,a.ya=d,this.dispatchEvent(a)}else 2==b.length&&(a=b[0],b=b[1],a=[a.clientX,a.clientY],b=[b.clientX,b.clientY],a=new D.m(a[0],a[1],0),b=new D.m(b[0],b[1],0),d=Gc(a,b),b=d-this.Vg,this.Vg=d,this.gd.wa(a),this.gd=a.l(),10<Math.abs(b)&&(a=new Jd,a.vb=0<b,a.hb=this instanceof Le,this.dispatchEvent(a)))},w.Mj=aa(),w.xj=function(a){this.mousemoveEvent=a,eval("this.onMouseMove(this['mousemoveEvent'])"),this.Yd=q,this.R.KEYBOARD_ENABLED&&window.onkeydown==t&&(window.onkeydown=this.ih.bind(this)),a.preventDefault();var b=a.shiftKey;this.wg=b,this.ua=[a.offsetX,a.offsetY];var c=new D.m(this.ua[0],this.ua[1],0);a=this.Me.wa(c),this.Me=c.l(),this.R.HOVERING_ENABLED&&((0<Math.abs(a.x)||0<Math.abs(a.y)||this.Qb||this.wb||this.Xb)&&Ke(this),this.Wd=setTimeout(function(){Ke(this);var e=new Ld;e.fe=c.x,e.ge=c.y,this.dispatchEvent(e),this.Wd=t}.bind(this),300)),0!=a.Ib()&&(this.wb&&!b?(b=new Id,a.scale(3),b.ya=a,this.dispatchEvent(b)):this.Qb||this.wb&&b?(b=new Hd,b.ya=a,this.dispatchEvent(b)):this.Xb&&(b=new Jd,b.vb=0<a.y,b.hb=u,this.dispatchEvent(b)))},w.Bj=aa(),w.Kd=function(a){this.mouseWheelEvent=a,eval("this.onMouseWheel(this['mouseWheelEvent'])"),Ke(this),a.preventDefault()},w.sj=aa(),w.ih=function(a){if(this.Yd){this.keyEvent=a,eval("this.onKey(this['keyEvent'])"),Ke(this);var b=a.altKey,c=a.ctrlKey,e=a.metaKey,d=a.shiftKey,f=a.keyCode;82==f&&!b&&!c&&!e&&!d?(a.preventDefault(),a=new Nd,this.dispatchEvent(a)):37<=f&&40>=f&&(a.preventDefault(),d?a=new Hd:b?a=new Jd:(a=new Id,this instanceof Ne&&(a=new Kd)),a&&(c=new D.m(0,0,0),37==f?(c.x=5,a.V=u,b&&(a.V=q,a.vb=q,a.hb=u)):39==f?(c.x=-5,a.V=q,b&&(a.vb=u,a.hb=u)):38==f?(c.y=5,a.V=q,b&&(a.vb=q,a.hb=q)):40==f&&(c.y=-5,a.V=u,b&&(a.vb=u,a.hb=q)),a.ya=c,this.dispatchEvent(a)))}},A("X.interactor",Je),A("X.interactor.prototype.init",Je.prototype.Ca),A("X.interactor.prototype.onMouseDown",Je.prototype.uj),A("X.interactor.prototype.onMouseUp",Je.prototype.zj),A("X.interactor.prototype.onMouseMove",Je.prototype.wj),A("X.interactor.prototype.onMouseWheel",Je.prototype.Bj),A("X.interactor.prototype.onKey",Je.prototype.sj),A("X.interactor.prototype.onTouchStart",Je.prototype.Oj),A("X.interactor.prototype.onTouchMove",Je.prototype.Mj),A("X.interactor.prototype.onTouchEnd",Je.prototype.Ij),A("X.interactor.prototype.onTouchHover",Je.prototype.Kj),C(Ne,Je),Ne.prototype.Kd=function(e){Ne.u.Kd.call(this,e);var n=new Kd;e.Xc==t&&(e.Xc=0),n.V=0>e.Xc,this.dispatchEvent(n)},C(Oe,M),Oe.prototype.observe=function(e){(e==t||!(e instanceof Je))&&m(Error("Could not observe the interactor.")),L(e,td,this.Fj.bind(this)),L(e,sd,this.Cj.bind(this)),L(e,ud,this.Sj.bind(this))},Oe.prototype.Fj=function(e){e instanceof Id||m(Error("Received no valid rotate event.")),this.rotate(e.ya)},Oe.prototype.Sj=function(e){e instanceof Jd||m(Error("Received no valid zoom event.")),e.vb?this.$f(e.hb):this.ag(e.hb)},Oe.prototype.Cj=function(e){e instanceof Hd||m(Error("Received no valid pan event.")),this.Kf(e.ya)},Oe.prototype.__defineGetter__("view",v("o")),Oe.prototype.__defineSetter__("view",function(e){(e==t||!(e instanceof Float32Array))&&m(Error("Invalid view matrix.")),this.o=e}),Oe.prototype.__defineGetter__("position",function(){return[this.ic.x,this.ic.y,this.ic.d]}),Oe.prototype.__defineSetter__("position",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid position.")),this.ic=new D.m(e[0],e[1],e[2]),this.reset()}),Oe.prototype.__defineGetter__("focus",function(){return[this.Fc.x,this.Fc.y,this.Fc.d]}),Oe.prototype.__defineSetter__("focus",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid focus")),this.Fc=new D.m(e[0],e[1],e[2]),this.reset()}),Oe.prototype.__defineGetter__("up",function(){return[this.V.x,this.V.y,this.V.d]}),Oe.prototype.__defineSetter__("up",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid up vector.")),this.V=new D.m(e[0],e[1],e[2]),this.reset()}),w=Oe.prototype,w.reset=function(){this.o=this.ue(this.ic,this.Fc)},w.rotate=function(e){return la(e)&&2==e.length?e=new D.m(e[0],e[1],0):e instanceof D.m||m(Error("Invalid distance vector for rotate operation.")),e},w.Kf=function(e){la(e)&&2==e.length?e=new D.m(e[0],e[1],0):e instanceof D.m||m(Error("Invalid distance vector for pan operation.")),this.o[12]-=e.x,this.o[13]+=e.y},w.$f=function(e){var n=20;e!=t&&!e&&(n=1),this.o[14]+=n},w.ag=function(e){var n=20;e!=t&&!e&&(n=1),this.o[14]-=n},w.ue=function(e,t){return(!(e instanceof D.m)||!(t instanceof D.m))&&m(Error("3D vectors required for calculating the view.")),D.g.Ed()},A("X.camera",Oe),A("X.camera.prototype.pan",Oe.prototype.Kf),A("X.camera.prototype.rotate",Oe.prototype.rotate),A("X.camera.prototype.zoomIn",Oe.prototype.$f),A("X.camera.prototype.zoomOut",Oe.prototype.ag),C(Pe,Oe),Pe.prototype.rotate=function(e){e=Pe.u.rotate.call(this,e);var t=-e.x/5*Math.PI/180;e=-e.y/5*Math.PI/180;var n=new D.m(this.o[1],this.o[5],this.o[9]),r=new D.m(this.o[0],this.o[4],this.o[8]);n.normalize(),r.normalize(),D.g.rotate(this.o,t,n.x,n.y,n.d),D.g.rotate(this.o,e,r.x,r.y,r.d)},Pe.prototype.ue=function(e,t){var n=Pe.u.ue.call(this,e,t);return D.g.Xg(n,e,t,this.V),n},A("X.camera3D",Pe),C(Re,M),Re.prototype.parse=function(){m(Error("The function parse() should be overloaded."))},C(bf,Re),bf.prototype.parse=function(e,t,n,r){n instanceof ArrayBuffer||m(Error());for(var i=new Uint8Array(n),s=i.length,o=Array(s);s--;)o[s]=String.fromCharCode(i[s]);i=window.btoa(o.join("")),s=new Image,$b(s,"load",this.Uj.bind(this,s,e,t,n,r)),s.src="data:image/"+r+";base64,"+i},bf.prototype.Uj=function(e,n,r){n.ib=e,n.Wb=t,e=new ld,e.D=r,e.v=n,this.dispatchEvent(e)},A("X.parserIMAGE",bf),A("X.parserIMAGE.prototype.parse",bf.prototype.parse),C(cf,Oe),cf.prototype.rotate=function(e){e=cf.u.rotate.call(this,e);var t=new Gd;0<e.x?t.cf--:0>e.x&&t.cf++,0<e.y?t.Qe++:0>e.y&&t.Qe--,this.dispatchEvent(t)},cf.prototype.$f=function(e){var n=20;e!=t&&!e&&(n=.02),this.o[14]+=n},cf.prototype.ag=function(e){var n=20;e!=t&&!e&&(n=.02),this.o[14]-=n},cf.prototype.Kf=function(e){la(e)&&2==e.length?e=new D.m(e[0],e[1],0):e instanceof D.m||m(Error("Invalid distance vector for pan operation.")),this.o[12]-=e.x/this.o[14],this.o[13]+=e.y/this.o[14]},C(df,M);var ef={$k:"vertexPosition",Zk:"vertexNormal",Yk:"vertexColor",bl:"vertexTexturePos",al:"vertexScalar"},ff={cl:"view",Hk:"perspective",yk:"center",Gk:"objectTransform",Uk:"useObjectColor",Ek:"objectColor",Wk:"useScalars",Qk:"scalarsReplaceMode",Nk:"scalarsMin",Kk:"scalarsMax",Ok:"scalarsMinColor",Lk:"scalarsMaxColor",Pk:"scalarsMinThreshold",Mk:"scalarsMaxThreshold",Jk:"scalarsInterpolation",Ik:"pointSize",Fk:"objectOpacity",Dk:"normal",Vk:"usePicking",Xk:"useTexture",Tk:"useLabelMapTexture",Bk:"labelmapOpacity",Ak:"labelmapColor",Rk:"textureSampler",Sk:"textureSampler2",dl:"volumeLowerThreshold",jl:"volumeUpperThreshold",gl:"volumeScalarMin",el:"volumeScalarMax",hl:"volumeScalarMinColor",fl:"volumeScalarMaxColor",ll:"volumeWindowLow",kl:"volumeWindowHigh",il:"volumeTexture"};C(Xe,Y),Xe.prototype.rc=function(e){this.z=e.z.slice(),this.gc=e.gc.slice(),this.V=e.V.slice(),this.K=e.K,this.A=e.A,this.yb=e.yb,this.e=e.e,this.Bb=e.Bb,this.ec=e.ec,this.Xh=e.Xh,Xe.u.rc.call(this,e)},Xe.prototype.__defineSetter__("height",ca("A")),Xe.prototype.__defineSetter__("width",ca("K")),Xe.prototype.__defineGetter__("up",v("V")),Xe.prototype.__defineGetter__("right",v("Oc")),Xe.prototype.create=function(){this.Gb()},Xe.prototype.Ta=function(){Xe.u.Ta.call(this),this.z.length=0,this.gc.length=0,this.V.length=0,this.Oc.length=0,this.nc.length=0,this.e=this.yb=t,this.ec.length=0},Xe.prototype.Gb=function(){var e=(new R(this.gc[0],this.gc[1],this.gc[2])).normalize(),t=new R(this.V[0],this.V[1],this.V[2]),n=new R(this.Oc[0],this.Oc[1],this.Oc[2]),r=new R(this.z[0],this.z[1],this.z[2]),i=Hc(n.l().Y().scale(this.K/2),t.l().Y().scale(this.A/2)),s=new R(i.x+r.x,i.y+r.y,i.d+r.d),i=Hc(n.l().Y().scale(this.K/2),t.l().scale(this.A/2)),o=new R(i.x+r.x,i.y+r.y,i.d+r.d),i=Hc(n.l().scale(this.K/2),t.l().Y().scale(this.A/2)),u=new R(i.x+r.x,i.y+r.y,i.d+r.d),i=Hc(n.l().scale(this.K/2),t.l().scale(this.A/2)),t=new R(i.x+r.x,i.y+r.y,i.d+r.d);this.h=new W(18),this.n=new W(18),this.h.add(s.x,s.y,s.d),this.h.add(o.x,o.y,o.d),this.h.add(u.x,u.y,u.d),this.h.add(u.x,u.y,u.d),this.h.add(t.x,t.y,t.d),this.h.add(o.x,o.y,o.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.Bb&&(e=new Y,e.h=new W(24),e.n=new W(24),e.h.add(s.x,s.y,s.d),e.h.add(o.x,o.y,o.d),e.h.add(o.x,o.y,o.d),e.h.add(t.x,t.y,t.d),e.h.add(t.x,t.y,t.d),e.h.add(u.x,u.y,u.d),e.h.add(u.x,u.y,u.d),e.h.add(s.x,s.y,s.d),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.w=[this.ec[0],this.ec[1],this.ec[2]],e.Ia="LINES",e.Lc=2,this.c.push(e))},A("X.slice",Xe),A("X.slice.prototype.create",Xe.prototype.create),A("X.slice.prototype.destroy",Xe.prototype.Ta),C(P,Y),P.prototype.rc=function(e){this.z=e.z.slice(),this.ca=e.ca.slice(),this.qb=e.qb.slice(),this.Cb=e.Cb,this.Hc=e.Hc,this.Db=e.Db,this.Ic=e.Ic,this.Eb=e.Eb,this.Jc=e.Jc,this.dg=e.dg.slice(),this.kc=new Y(e.kc),this.lc=new Y(e.lc),this.mc=new Y(e.mc),this.ia=e.ia,this.J=e.J,this.Ra=e.Ra,this.ee=e.ee,this.X=e.X,this.e=e.e,this.Bb=e.Bb,P.u.rc.call(this,e)},P.prototype.Gb=function(e){this.c.length=0,this.kc.c.length=0,this.lc.c.length=0,this.mc.c.length=0,this.c.push(this.kc),this.c.push(this.lc),this.c.push(this.mc),this.Ea=e.Ac,this.ad=e.Bc,this.gb=e.zc,this.Cc=e.cb,this.Qh=e.fb,this.ia=e.max,this.J=e.data,this.j=q},P.prototype.Ta=function(){P.u.Ta.call(this),this.ib.length=0,this.c.length=0,this.kc.c.length=0,this.kc.length=0,this.lc.c.length=0,this.lc.length=0,this.mc.c.length=0,this.mc.length=0,this.J=t,this.ma.length=0,this.b.length=0,this.s.length=0,this.gb.length=0,this.ad.length=0,this.$.length=0,this.bg.length=0,this.$a=t},P.prototype.q=function(e){e="undefined"!=typeof e?e:q;if(0<this.c.length){this.Ra!=this.ee&&(!this.Ra&&-1!=this.X&&(this.c[this.X].visible=u),this.j=q,this.ee=this.Ra);if(!this.O)return;for(var n=0,n=0;3>n;n++){var r=this.c[n],i=0,s=0;0==n?(i=this.Cb,s=this.Hc,this.Hc=this.Cb):1==n?(i=this.Db,s=this.Ic,this.Ic=this.Db):2==n&&(i=this.Eb,s=this.Jc,this.Jc=this.Eb);if(this.c[n].c[parseInt(i,10)]==t){var o=Mc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*parseInt(i,10),o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*parseInt(i,10),o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*parseInt(i,10);if(this.L){var a=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.e.$,this.e,this.e.L,this.e.xa.Ka);this.e.c[n].c[parseInt(i,10)]=a,this.e.c[n].q(q)}o=We(o,this.b[n].Ga,this.b[n].i,this.b[n].w,this.ma,this.$,this,q,t),this.L&&(o.e=o.G,o.e=this.e.c[n].c[parseInt(i,10)].G),r.c[parseInt(i,10)]=o,this.c[n].q(q)}s=r.c[parseInt(s,10)],this.Ra||(s.visible=u),r=r.c[parseInt(i,10)],r.visible=q,r.za=1,this.Ra&&(r.c[0].O=u,n!=this.X&&(r.visible=u,r.za=0))}this.Ra&&-1!=this.X&&gf(this,this.X)}e&&P.u.q.call(this)},P.prototype.__defineGetter__("dimensions",v("ca")),P.prototype.__defineSetter__("dimensions",ca("ca")),P.prototype.__defineGetter__("spacing",v("qb")),P.prototype.__defineSetter__("spacing",ca("qb")),P.prototype.__defineGetter__("bbox",v("ma")),P.prototype.__defineGetter__("range",v("ud")),P.prototype.__defineGetter__("dimensionsRAS",v("dg")),P.prototype.__defineGetter__("volumeRendering",v("Ra")),P.prototype.__defineSetter__("volumeRendering",function(e){this.Ra=e,this.q(u)}),P.prototype.__defineGetter__("visible",v("O")),P.prototype.__defineSetter__("visible",function(e){if(e)this.O=e,this.q(u);else{for(var t=this.c,n=t.length,r=0,r=0;r<n;r++)t[r].visible=e;this.O=e,this.j=q}}),P.prototype.__defineGetter__("center",v("z")),P.prototype.__defineSetter__("center",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid center.")),this.z=e}),P.prototype.__defineGetter__("volumeRenderingCache",v("de")),P.prototype.__defineSetter__("volumeRenderingCache",function(e){(e==t||!la(e)||!(3>=e.length))&&m(Error("Invalid volumeRederingCache.")),this.de=e}),P.prototype.__defineGetter__("image",v("ib")),P.prototype.__defineGetter__("labelmap",function(){return this.e||(this.e=new hf(this)),this.e}),P.prototype.__defineGetter__("indexX",v("Cb")),P.prototype.__defineSetter__("indexX",function(e){x(e)&&0<=e&&e<this.kc.c.length&&(this.Cb=e,this.q(u))}),P.prototype.__defineGetter__("indexY",v("Db")),P.prototype.__defineSetter__("indexY",function(e){x(e)&&0<=e&&e<this.lc.c.length&&(this.Db=e,this.q(u))}),P.prototype.__defineGetter__("indexZ",v("Eb")),P.prototype.__defineSetter__("indexZ",function(e){x(e)&&0<=e&&e<this.mc.c.length&&(this.Eb=e,this.q(u))}),P.prototype.__defineGetter__("windowLow",v("fa")),P.prototype.__defineSetter__("windowLow",ca("fa")),P.prototype.__defineGetter__("windowHigh",v("ea")),P.prototype.__defineSetter__("windowHigh",ca("ea")),P.prototype.__defineGetter__("borders",v("Bb")),P.prototype.__defineSetter__("borders",ca("Bb")),P.prototype.__defineGetter__("reslicing",v("vg")),P.prototype.__defineSetter__("reslicing",ca("vg")),P.prototype.__defineGetter__("resolutionFactor",v("ae")),P.prototype.__defineSetter__("resolutionFactor",ca("ae")),P.prototype.__defineSetter__("xNormX",function(e){this.b[0].i[0]=e}),P.prototype.__defineGetter__("xNormX",function(){return this.b[0].i[0]}),P.prototype.__defineSetter__("xNormY",function(e){this.b[0].i[1]=e}),P.prototype.__defineGetter__("xNormY",function(){return this.b[0].i[1]}),P.prototype.__defineSetter__("xNormZ",function(e){this.b[0].i[2]=e}),P.prototype.__defineGetter__("xNormZ",function(){return this.b[0].i[2]}),P.prototype.__defineSetter__("xColor",function(e){this.b[0].w=e}),P.prototype.__defineGetter__("xColor",function(){return this.b[0].w}),P.prototype.__defineSetter__("yNormX",function(e){this.b[1].i[0]=e}),P.prototype.__defineGetter__("yNormX",function(){return this.b[1].i[0]}),P.prototype.__defineSetter__("yNormY",function(e){this.b[1].i[1]=e}),P.prototype.__defineGetter__("yNormY",function(){return this.b[1].i[1]}),P.prototype.__defineSetter__("yNormZ",function(e){this.b[1].i[2]=e}),P.prototype.__defineGetter__("yNormZ",function(){return this.b[1].i[2]}),P.prototype.__defineSetter__("yColor",function(e){this.b[1].w=e}),P.prototype.__defineGetter__("yColor",function(){return this.b[1].w}),P.prototype.__defineSetter__("zNormX",function(e){this.b[2].i[0]=e}),P.prototype.__defineGetter__("zNormX",function(){return this.b[2].i[0]}),P.prototype.__defineSetter__("zNormY",function(e){this.b[2].i[1]=e}),P.prototype.__defineGetter__("zNormY",function(){return this.b[2].i[1]}),P.prototype.__defineSetter__("zNormZ",function(e){this.b[2].i[2]=e}),P.prototype.__defineGetter__("zNormZ",function(){return this.b[2].i[2]}),P.prototype.__defineSetter__("zColor",function(e){this.b[2].w=e}),P.prototype.__defineGetter__("zColor",function(){return this.b[2].w}),P.prototype.gk=function(e){this.c[e].visible=u;for(var n=0;n<this.c[e].c.length;n++)"undefined"!=typeof this.c[e].c[n]&&(this.L&&(this.e.c[e].c[n].remove(),this.e.c[e].c[n]=t),this.c[e].c[n].remove(),this.c[e].c[n]=t);Oc(this.b[e].i,this.b[e].i),Ye(e,this.b[e].vd,this.b[e].i,this),this.c[e].c=[],this.c[e].c=Array(this.b[e].p),this.L&&(n=We(this.b[e].vd,this.b[e].Ga,this.b[e].i,this.b[e].w,this.ma,this.e.$,this.e,this.e.L,this.e.xa.Ka),this.e.c[e].c=[],this.e.c[e].c=Array(this.b[e].p),this.e.c[e].c[Math.floor(this.b[e].p/2)]=n,this.e.c[e].q()),n=We(this.b[e].vd,this.b[e].Ga,this.b[e].i,this.b[e].w,this.ma,this.$,this,q,t),window.console.log("modified!"),this.L&&(n.e=n.G,n.e=this.e.c[e].c[Math.floor(this.b[e].p/2)].G),this.c[e].c[Math.floor(this.b[e].p/2)]=n,0==e?(this.Cb=Math.floor(this.b[e].p/2),this.Hc=Math.floor(this.b[e].p/2)):1==e?(this.Db=Math.floor(this.b[e].p/2),this.Ic=Math.floor(this.b[e].p/2)):(this.Eb=Math.floor(this.b[e].p/2),this.Jc=Math.floor(this.b[e].p/2)),this.c[e].q(),this.c[e].c[Math.floor(this.b[e].p/2)].O=q},P.prototype.Ef=aa(),P.prototype.Gf=aa(),P.prototype.Ff=aa(),A("X.volume",P),A("X.volume.prototype.modified",P.prototype.q),A("X.volume.prototype.destroy",P.prototype.Ta),A("X.volume.prototype.sliceInfoChanged",P.prototype.gk),A("X.volume.prototype.onComputing",P.prototype.Ef),A("X.volume.prototype.onComputingProgress",P.prototype.Gf),A("X.volume.prototype.onComputingEnd",P.prototype.Ff),C(kf,Re),kf.prototype.parse=function(e,t,n){function r(){a===i&&m(Error("End of file reached unexpectedly."));for(var e=a;e<i;++e)if(10===s[e]){var t=Te(s,a,e);return a=e+1,t}return a=i,Te(s,a,i-1)}D.Ja(this.f+".parse"),this.J=n;var i=n.byteLength,s=Z(this,"uchar",i);n=[],t.h=new W(i),t.n=new W(i);for(var o=t.h,u=t.n,a=0,f=r(),f=("OFF"===f?r():f).split(" "),l=f[0],f=f[1];l--;){var c=r(),c=c.split(" ");n.push([parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])])}for(;f--;){var c=r(),c=c.split(" "),h=n[parseInt(c[1],10)],l=n[parseInt(c[2],10)],c=n[parseInt(c[3],10)];o.add(h[0],h[1],h[2]),o.add(l[0],l[1],l[2]),o.add(c[0],c[1],c[2]),h=new R(h[0],h[1],h[2]),c=new R(c[0],c[1],c[2]),l=Ic((new R(l[0],l[1],l[2])).wa(h),c.wa(h)),l.normalize(),u.add(l.x,l.y,l.d),u.add(l.x,l.y,l.d),u.add(l.x,l.y,l.d)}D.Da(this.f+".parse"),n=new ld,n.D=t,n.v=e,this.dispatchEvent(n)},A("X.parserOFF",kf),A("X.parserOFF.prototype.parse",kf.prototype.parse),C(lf,Re),lf.prototype.parse=function(e,n,r){n.yc={},n.yc.xf=0,this.vc(r,n);if(n.r.length==t||n.ta.length==n.r.length){n.yc.xf=n.r.length;var i={};r={};for(var s=0;s<n.ta.length;s++)i.hasOwnProperty(n.ta[s].series_instance_uid)||(i[n.ta[s].series_instance_uid]=[],r[n.ta[s].series_instance_uid]={}),r[n.ta[s].series_instance_uid].hasOwnProperty(n.ta[s].sop_instance_uid)||(r[n.ta[s].series_instance_uid][n.ta[s].sop_instance_uid]=q,i[n.ta[s].series_instance_uid].push(n.ta[s]));var o=Object.keys(i)[0],s=i[o],a=s.length;r={};var f="image_position_patient";1==a?(f="image_position_patient",i[o][0].dist=0):s[0].image_position_patient[0]!=s[1].image_position_patient[0]||s[0].image_position_patient[1]!=s[1].image_position_patient[1]||s[0].image_position_patient[2]!=s[1].image_position_patient[2]?(f="image_position_patient",i=new R(s[0].image_orientation_patient[0],s[0].image_orientation_patient[1],s[0].image_orientation_patient[2]),o=new R(s[0].image_orientation_patient[3],s[0].image_orientation_patient[4],s[0].image_orientation_patient[5]),i=Ic(i,o),s.map(function(e,t){return t.dist=t.image_position_patient[0]*e.x+t.image_position_patient[1]*e.y+t.image_position_patient[2]*e.d,t}.bind(t,i)),s.sort(function(e,t){return e.dist-t.dist})):s[0].instance_number!=s[1].instance_number?(f="instance_number",s.sort(function(e,t){return e.instance_number-t.instance_number})):window.console.log("Could not resolve the ordering mode"),isNaN(s[0].pixel_spacing[0])&&(s[0].pixel_spacing[0]=1),isNaN(s[0].pixel_spacing[1])&&(s[0].pixel_spacing[1]=1);if(1<a)switch(f){case"image_position_patient":var l=s[0].image_position_patient,i=s[1].image_position_patient,o=i[0]-l[0],c=i[1]-l[1],h=i[2]-l[2];s[0].pixel_spacing[2]=Math.sqrt(o*o+c*c+h*h);break;case"instance_number":s[0].pixel_spacing[2]=1;break;default:window.console.log("Unkown ordering mode - returning: "+f)}else s[0].pixel_spacing[2]=1;i=1;switch(f){case"image_position_patient":var l=s[0].image_position_patient,p=s[a-1].image_position_patient,o=p[0]-l[0],c=p[1]-l[1],h=p[2]-l[2],o=Math.sqrt(o*o+c*c+h*h),i=i+Math.round(o/s[0].pixel_spacing[2]);break;case"instance_number":i+=Math.abs(s[a-1].instance_number-s[0].instance_number);break;default:window.console.log("Unkown ordering mode - returning: "+f)}l=s[0].columns*s[0].rows,o=l*i,p=t;switch(s[0].ff){case 8:p=new Uint8Array(o);break;case 16:p=new Uint16Array(o);break;case 32:p=new Uint32Array(o);default:window.console.log("Unknown number of bits allocated - using default: 32 bits")}n.qb=s[0].pixel_spacing;for(var d=0;d<a;d++){var v=s[d].data,o=0;switch(f){case"image_position_patient":o=s[d].image_position_patient[0]-s[0].image_position_patient[0],c=s[d].image_position_patient[1]-s[0].image_position_patient[1],h=s[d].image_position_patient[2]-s[0].image_position_patient[2],o=Math.round(Math.sqrt(o*o+c*c+h*h)/s[0].pixel_spacing[2]);break;case"instance_number":o=s[d].instance_number-s[0].instance_number;break;default:window.console.log("Unkown ordering mode - returning: "+f)}p.set(v,o*l)}r.data=p,n.J=p,n.ca=[s[0].columns,s[0].rows,i],r.zl=n.ca,i=Se(p),a=i[0],i=i[1],r.min=n.ra=n.fa=a,r.max=n.ia=n.ea=i,-Infinity==n.U&&(n.U=a),Infinity==n.W&&(n.W=i),c=s[0].image_position_patient,a=Rc();if("false"==n.reslicing||n.reslicing==u)T(a,0,-s[0].pixel_spacing[0],0,0,0),T(a,1,0,-s[0].pixel_spacing[1],0,0),T(a,2,0,0,s[0].pixel_spacing[2],0),T(a,3,0,0,0,1);else switch(f){case"image_position_patient":i=new R(s[0].image_orientation_patient[0],s[0].image_orientation_patient[1],s[0].image_orientation_patient[2]),o=new R(s[0].image_orientation_patient[3],s[0].image_orientation_patient[4],s[0].image_orientation_patient[5]),i=Ic(i,o),T(a,0,-s[0].image_orientation_patient[0]*s[0].pixel_spacing[0],-s[0].image_orientation_patient[3]*s[0].pixel_spacing[1],-i.x*s[0].pixel_spacing[2],-c[0]),T(a,1,-s[0].image_orientation_patient[1]*s[0].pixel_spacing[0],-s[0].image_orientation_patient[4]*s[0].pixel_spacing[1],-i.y*s[0].pixel_spacing[2],-c[1]),T(a,2,s[0].image_orientation_patient[2]*s[0].pixel_spacing[0],s[0].image_orientation_patient[5]*s[0].pixel_spacing[1],i.d*s[0].pixel_spacing[2],c[2]),T(a,3,0,0,0,1);break;case"instance_number":T(a,0,-1,0,0,-c[0]),T(a,1,0,-1,0,-c[1]),T(a,2,0,0,1,c[2]),T(a,3,0,0,0,1);break;default:window.console.log("Unkown ordering mode - returning: "+f)}r.cb=a,r.fb=Rc(),ad(r.cb,r.fb),f=Qc(0,0,0,1),s=Pc(),cd(a,f,s),f=Qc(1,1,1,1),i=Pc(),cd(a,f,i),r.Bc=[i[0]-s[0],i[1]-s[1],i[2]-s[2]],s=Ue(a,[n.ca[0],n.ca[1],n.ca[2]]),r.zc=[s[1]-s[0]+1,s[3]-s[2]+1,s[5]-s[4]+1],r.Ac=[s[0],s[2],s[4]],n.Gb(r),n.ib=af(this,n)}r=new ld,r.D=n,r.v=e,this.dispatchEvent(r)},lf.prototype.vc=function(e,n){this.J=e;if("undefined"==typeof n.ta||n.ta==t)n.ta=[];for(var r={pixel_spacing:[.1,.1,Infinity],image_orientation_patient:[1,0,0,0,1,0],image_position_patient:[0,0,0],transfer_syntax_uid:"no_transfer_syntax_uid"},i=Z(this,"ushort",this.J.byteLength),s=66,o=t,u=t,a=t,f=t;s<i.length;)switch(o=i[s++],u=i[s++],a=i[s++],f=i[s++],"1.2.840.10008.1.2"==r.transfer_syntax_uid&&0==f&&(f=a),o){case 2:switch(u){case 16:for(var l="",o=o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);r.transfer_syntax_uid=l.replace(/\0/g,"");break;default:s=mf(i,s,a,f)}break;case 40:switch(u){case 16:r.rows=i[s],s+=f/2;break;case 17:r.columns=i[s],s+=f/2;break;case 256:r.ff=i[s],s+=f/2;break;case 257:r.bits_stored=i[s],s+=f/2;break;case 2:r.number_of_images=i[s],s+=f/2;break;case 48:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);l=l.split("\\"),r.pixel_spacing=[parseFloat(l[0]),parseFloat(l[1]),Infinity];break;default:s=mf(i,s,a,f)}break;case 32:switch(u){case 14:r.series_instance_uid="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,r.series_instance_uid+=String.fromCharCode(u),r.series_instance_uid+=String.fromCharCode(a);break;case 19:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);r.instance_number=parseInt(l,10);break;case 50:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);l=l.split("\\"),r.image_position_patient=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])];break;case 55:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);l=l.split("\\"),r.image_orientation_patient=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]),parseFloat(l[4]),parseFloat(l[5])];break;default:s=mf(i,s,a,f)}break;case 65534:switch(u){default:f=0,s+=f/2}break;case 8:switch(u){case 24:r.sop_instance_uid="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,r.sop_instance_uid+=String.fromCharCode(u),r.sop_instance_uid+=String.fromCharCode(a);break;default:s=mf(i,s,a,f)}break;case 16:switch(u){case 8720:for(o=0;o<f/2;o++)s++;break;default:s=mf(i,s,a,f)}break;default:s=mf(i,s,a,f)}switch(r.ff){case 8:r.data=new Uint8Array(r.columns*r.rows);break;case 16:r.data=new Uint16Array(r.columns*r.rows);break;case 32:r.data=new Uint32Array(r.columns*r.rows)}this.C=this.J.byteLength-2*r.columns*r.rows,i=t;switch(r.ff){case 8:i=Z(this,"uchar",r.columns*r.rows);break;case 16:i=Z(this,"ushort",r.columns*r.rows);break;case 32:i=Z(this,"uint",r.columns*r.rows)}return r.data=i,n.ta.push(r),n},A("X.parserDCM",lf),A("X.parserDCM.prototype.parse",lf.prototype.parse),C(nf,Re),nf.prototype.parse=function(e,n,r){D.Ja(this.f+".parse");var i=n.h,s=n.n,o=new Uint8Array(r),a="";n.h=i=new W(r.byteLength),n.n=s=new W(r.byteLength),r=0;for(var f=o.length;r<f;r+=32768)a+=Te(o,r,Math.min(r+32768,f));o=a.split("\n"),a=o.length,this.yd=this.zd=t,this.hc=[],this.Pa=id,this.Se=this.Tb=this.Nb=this.Ub=u,r=0;for(f=a%8;f--;)of(this,o[r]),r++;for(f=.125*a^0;f--;)of(this,o[r]),r++,of(this,o[r]),r++,of(this,o[r]),r++,of(this,o[r]),r++,of(this,o[r]),r++,of(this,o[r]),r++,of(this,o[r]),r++,of(this,o[r]),r++;r=this.zd;var o=this.yd,a=o.length,l=f=this.hc.length;do{var c=this.hc[f-l],h=c.length,p;for(p=0;p<h&&!("LINES"==this.Pa&&p+1>=h);p++){var d=parseInt(c[p],10),v=r.get(d);i.add(v[0],v[1],v[2]);var m=d,g=v;"LINES"==this.Pa?(m=parseInt(c[p+1],10),g=r.get(m),i.add(g[0],g[1],g[2])):"TRIANGLE_STRIPS"==this.Pa&&(0==p||p==h-1)&&i.add(v[0],v[1],v[2]),d<a?(g=o.get(d),s.add(g[0],g[1],g[2]),"LINES"==this.Pa?(m=o.get(m),s.add(m[0],m[1],m[2])):"TRIANGLE_STRIPS"==this.Pa&&(0==p||p==h-1)&&s.add(g[0],g[1],g[2])):(m=new R(v[0],v[1],v[2]),m.normalize(),s.add(m.x,m.y,m.d),"LINES"==this.Pa?(m=new R(g[0],g[1],g[2]),m.normalize(),s.add(m.x,m.y,m.d)):"TRIANGLE_STRIPS"==this.Pa&&(0==p||p==h-1)&&s.add(m.x,m.y,m.d))}l--}while(0<l);n.Ia=this.Pa,D.Da(this.f+".parse"),i=new ld,i.D=n,i.v=e,this.dispatchEvent(i)},A("X.parserVTK",nf),A("X.parserVTK.prototype.parse",nf.prototype.parse),C(pf,Re),pf.prototype.parse=function(e,n,r){D.Ja(this.f+".parse"),this.J=r;var i=n.h,s=n.n;n.Nc=[];var o=n.Nc;r=0;var u;do u=Z(this,"uchar"),r++;while(200>r&&10!=u);Z(this,"uchar"),s=Z(this,"uint"),r=Z(this,"uint");var a=Z(this,"float",3*s);u=Z(this,"uint",3*r);var f=new Uint32Array(s),l=new Float32Array(9*r);n.h=i=new W(9*r),n.n=s=new W(9*r);var c;for(c=0;c<r;c++){var h=3*c,p=u[h],d=u[h+1],v=u[h+2];o.push(p),o.push(d),o.push(v),f[p]+=1,f[d]+=1,f[v]+=1;var h=3*p,m=3*d,g=3*v,y=a[h],b=a[h+1],w=a[h+2],d=a[m],v=a[m+1],p=a[m+2],E=a[g],S=a[g+1],x=a[g+2];i.add(y,b,w),i.add(d,v,p),i.add(E,S,x),y=new R(y,b,w),E=new R(E,S,x),d=(new R(d,v,p)).l().wa(y),v=E.l().wa(y),d=Ic(d,v).normalize(),l[h]+=d.x,l[h+1]+=d.y,l[h+2]+=d.d,l[m]+=d.x,l[m+1]+=d.y,l[m+2]+=d.d,l[g]+=d.x,l[g+1]+=d.y,l[g+2]+=d.d}for(c=0;c<r;c++)h=3*c,p=u[h],d=u[h+1],v=u[h+2],h=3*p,m=3*d,g=3*v,o=new R(l[m],l[m+1],l[m+2]),a=new R(l[g],l[g+1],l[g+2]),h=(new R(l[h],l[h+1],l[h+2])).scale(1/f[p]).normalize(),o=o.scale(1/f[d]).normalize(),a=a.scale(1/f[v]).normalize(),s.add(h.x,h.y,h.d),s.add(o.x,o.y,o.d),s.add(a.x,a.y,a.d);r=Z(this,"uchar",this.J.byteLength-this.C),u=t;for(h=0;h<r.length;h++)if(99==r[h]&&114==r[h+1]&&97==r[h+2]&&115==r[h+3]){for(s=u=h+9;10!=r[h]&&h<r.length;)s++,h++;u=Te(r.subarray(u,s)).split(" ");break}u&&(n.ja.Dh(parseFloat(u[0])),n.ja.Eh(parseFloat(u[1])),n.ja.Fh(parseFloat(u[2]))),n.Ia=id,D.Da(this.f+".parse"),r=new ld,r.D=n,r.v=e,this.dispatchEvent(r)},A("X.parserFSM",pf),A("X.parserFSM.prototype.parse",pf.prototype.parse);var qf={kf:function(e,t,n){return qf.update(e,0,t,n)},update:function(e,t,n,r){var i=qf.Mh,s="number"==typeof n?n:n=0;r="number"==typeof r?r:e.length,t^=4294967295;for(s=r&7;s--;++n)t=t>>>8^i[(t^e[n])&255];for(s=r>>3;s--;n+=8)t=t>>>8^i[(t^e[n])&255],t=t>>>8^i[(t^e[n+1])&255],t=t>>>8^i[(t^e[n+2])&255],t=t>>>8^i[(t^e[n+3])&255],t=t>>>8^i[(t^e[n+4])&255],t=t>>>8^i[(t^e[n+5])&255],t=t>>>8^i[(t^e[n+6])&255],t=t>>>8^i[(t^e[n+7])&255];return(t^4294967295)>>>0}};qf.Mh=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);var uf=0,tf=1;sf.prototype.Yb=function(){for(;!this.Ag;){var e=vf(this,3);e&1&&(this.Ag=q),e>>>=1;switch(e){case 0:var e=this.input,t=this.M,n=this.Ua,r=this.la,i=p,s=p,o=p,u=n.length,i=p;this.rb=this.Bd=0,i=e[t++],i===p&&m(Error("invalid uncompressed block header: LEN (first byte)")),s=i,i=e[t++],i===p&&m(Error("invalid uncompressed block header: LEN (second byte)")),s|=i<<8,i=e[t++],i===p&&m(Error("invalid uncompressed block header: NLEN (first byte)")),o=i,i=e[t++],i===p&&m(Error("invalid uncompressed block header: NLEN (second byte)")),o|=i<<8,s===~o&&m(Error("invalid uncompressed block header: length verify")),t+s>e.length&&m(Error("input buffer is broken"));switch(this.jf){case uf:for(;r+s>n.length;)i=u-r,s-=i,n.set(e.subarray(t,t+i),r),r+=i,t+=i,this.la=r,n=this.tc(),r=this.la;break;case tf:for(;r+s>n.length;)n=this.tc({Jg:2});break;default:m(Error("invalid inflate mode"))}n.set(e.subarray(t,t+s),r),r+=s,this.M=t+=s,this.la=r,this.Ua=n;break;case 1:this.qf(wf,xf);break;case 2:yf(this);break;default:m(Error("unknown BTYPE: "+e))}}return this.Dg()};var zf=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Af=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Bf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Cf=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Df=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ef=new Uint8Array(288),Ff,Gf;Ff=0;for(Gf=Ef.length;Ff<Gf;++Ff)Ef[Ff]=143>=Ff?8:255>=Ff?9:279>=Ff?7:8;var wf=rf(Ef),Hf=new Uint8Array(30),If,Jf;If=0;for(Jf=Hf.length;If<Jf;++If)Hf[If]=5;var xf=rf(Hf);w=sf.prototype,w.qf=function(e,t){var n=this.Ua,r=this.la;this.Gg=e;for(var i=n.length-258,s,o,u;256!==(s=Kf(this,e));)if(256>s)r>=i&&(this.la=r,n=this.tc(),r=this.la),n[r++]=s;else{s-=257,u=Af[s],0<Bf[s]&&(u+=vf(this,Bf[s])),s=Kf(this,t),o=Cf[s],0<Df[s]&&(o+=vf(this,Df[s])),r>=i&&(this.la=r,n=this.tc(),r=this.la);for(;u--;)n[r]=n[r++ -o]}for(;8<=this.rb;)this.rb-=8,this.M--;this.la=r},w.ri=function(e,t){var n=this.Ua,r=this.la;this.Gg=e;for(var i=n.length,s,o,u;256!==(s=Kf(this,e));)if(256>s)r>=i&&(n=this.tc(),i=n.length),n[r++]=s;else{s-=257,u=Af[s],0<Bf[s]&&(u+=vf(this,Bf[s])),s=Kf(this,t),o=Cf[s],0<Df[s]&&(o+=vf(this,Df[s])),r+u>i&&(n=this.tc(),i=n.length);for(;u--;)n[r]=n[r++ -o]}for(;8<=this.rb;)this.rb-=8,this.M--;this.la=r},w.tc=function(){var e=new Uint8Array(this.la-32768),t=this.la-32768,n=this.Ua;return e.set(n.subarray(32768,e.length)),this.gf.push(e),this.Vf+=e.length,n.set(n.subarray(t,t+32768)),this.la=32768,n},w.xi=function(e){var t=this.input.length/this.M+1|0,n=this.input,r=this.Ua;return e&&("number"==typeof e.Jg&&(t=e.Jg),"number"==typeof e.fi&&(t+=e.fi)),2>t?(e=(n.length-this.M)/this.Gg[2],e=258*(e/2)|0,e=e<r.length?r.length+e:r.length<<1):e=r.length*t,e=new Uint8Array(e),e.set(r),this.Ua=e},w.Dg=function(){var e=0,t=this.Ua,n=this.gf,r,i=new Uint8Array(this.Vf+(this.la-32768)),s,o,u,a;if(0===n.length)return this.Ua.subarray(32768,this.la);s=0;for(o=n.length;s<o;++s){r=n[s],u=0;for(a=r.length;u<a;++u)i[e++]=r[u]}s=32768;for(o=this.la;s<o;++s)i[e++]=t[s];return this.gf=[],this.buffer=i},w.mi=function(){var e,t=this.la;return this.Jb?(e=new Uint8Array(t),e.set(this.Ua.subarray(0,t))):e=this.Ua.subarray(0,t),this.buffer=e},new Uint8Array(256);var Lf;for(Lf=0;256>Lf;++Lf)for(var Mf=Lf,Nf=7,Mf=Mf>>>1;Mf;Mf>>>=1)--Nf;var Of=[],Pf;for(Pf=0;288>Pf;Pf++)switch(q){case 143>=Pf:Of.push([Pf+48,8]);break;case 255>=Pf:Of.push([Pf-144+400,9]);break;case 279>=Pf:Of.push([Pf-256+0,7]);break;case 287>=Pf:Of.push([Pf-280+192,8]);break;default:m("invalid literal: "+Pf)}var Sf=[],Rf,Tf;for(Rf=3;258>=Rf;Rf++)Tf=Qf(),Sf[Rf]=Tf[2]<<24|Tf[1]<<16|Tf[0];new Uint32Array(Sf),Vf.prototype.Yb=function(){for(var e=this.input.length;this.M<e;){var t=new Uf,n=p,r=p,i=p,s=n=i=p,o=p,n=n=p,u=this.input,r=this.M;t.Pg=u[r++],t.Qg=u[r++],(31!==t.Pg||139!==t.Qg)&&m(Error("invalid file signature:",t.Pg,t.Qg)),t.Cg=u[r++];switch(t.Cg){case 8:break;default:m(Error("unknown compression method: "+t.Cg))}t.me=u[r++],n=u[r++]|u[r++]<<8|u[r++]<<16|u[r++]<<24,t.Ml=new Date(1e3*n),t.Xl=u[r++],t.Rl=u[r++],0<(t.me&4)&&(t.Ge=u[r++]|u[r++]<<8,r+=t.Ge);if(0<(t.me&8)){o=[];for(s=0;0<(n=u[r++]);)o[s++]=String.fromCharCode(n);t.name=o.join("")}if(0<(t.me&16)){o=[];for(s=0;0<(n=u[r++]);)o[s++]=String.fromCharCode(n);t.comment=o.join("")}0<(t.me&2)&&(t.ni=qf.kf(u,0,r)&65535,t.ni!==(u[r++]|u[r++]<<8)&&m(Error("invalid header crc16"))),n=u[u.length-4]|u[u.length-3]<<8|u[u.length-2]<<16|u[u.length-1]<<24,u.length-r-4-4<512*n&&(i=n),r=new sf(u,{index:r,bufferSize:i}),t.data=i=r.Yb(),r=r.M,t.wl=n=(u[r++]|u[r++]<<8|u[r++]<<16|u[r++]<<24)>>>0,qf.kf(i)!==n&&m(Error("invalid CRC-32 checksum: 0x"+qf.kf(i).toString(16)+" / 0x"+n.toString(16))),t.Fl=n=(u[r++]|u[r++]<<8|u[r++]<<16|u[r++]<<24)>>>0,(i.length&4294967295)!==n&&m(Error("invalid input size: "+(i.length&4294967295)+" / "+n)),this.member.push(t),this.M=r}e=this.member,t=i=r=0;for(u=e.length;t<u;++t)i+=e[t].data.length;i=new Uint8Array(i);for(t=0;t<u;++t)i.set(e[t].data,r),r+=e[t].data.length;return i},C(Wf,Re),Wf.prototype.parse=function(e,t,n,r){D.Ja(this.f+".parse"),window.console.log(t),r&&(n=(new Vf(new Uint8Array(n))).Yb(),n=n.buffer),r=this.vc(n);var i=[r.Af,r.Bf,r.Cf];t.ca=i;var s=r.Gh;t.qb=s,n=r.min;var o=r.max;t.ra=t.fa=n,t.ia=t.ea=o,-Infinity==t.U&&(t.U=n),Infinity==t.W&&(t.W=o),n=Rc();if("false"==t.reslicing||t.reslicing==u)T(n,0,t.qb[0],0,0,0),T(n,1,0,t.qb[1],0,0),T(n,2,0,0,t.qb[2],0),T(n,3,0,0,0,1),Uc(n,0,0,0,1);else{T(n,0,r.eb[0][0],r.eb[1][0],r.eb[2][0],0),T(n,1,r.eb[0][1],r.eb[1][1],r.eb[2][1],0),T(n,2,r.eb[0][2],r.eb[1][2],r.eb[2][2],0),T(n,3,0,0,0,1);for(var o=i[0]/2,a=i[1]/2,i=i[2]/2,f=[0,0,0],l=0;3>l;++l)f[l]=r.eb[3][l]-(n[l+0]*s[0]*o+n[l+4]*s[1]*a+n[l+8]*s[2]*i);Uc(n,f[0],f[1],f[2],1)}r.cb=n,r.fb=Rc(),ad(r.cb,r.fb),o=Qc(0,0,0,1),s=Pc(),cd(n,o,s),a=Qc(1,1,1,1),o=Pc(),cd(n,a,o),n=Ue(n,t.ca),r.Bc=[o[0]-s[0],o[1]-s[1],o[2]-s[2]],r.zc=[n[1]-n[0]+1,n[3]-n[2]+1,n[5]-n[4]+1],r.Ac=[n[0],n[2],n[4]],t.Gb(r),D.Da(this.f+".parse"),t.ib=af(this,t),r=new ld,r.D=t,r.v=e,this.dispatchEvent(r)},Wf.prototype.vc=function(e){this.J=e,e={version:0,Ph:0,Nh:0,Ei:0,Oh:0,Af:0,Bf:0,Cf:0,nj:0,type:0,vi:0,vh:0,Ck:t,eb:t,Gh:t,data:t,min:Infinity,max:-Infinity},e.version=Z(this,"uint"),e.Af=Z(this,"uint"),e.Bf=Z(this,"uint"),e.Cf=Z(this,"uint"),e.nj=Z(this,"uint"),e.type=Z(this,"uint"),e.vi=Z(this,"uint"),e.vh=Z(this,"ushort");if(0<e.vh){e.Gh=Z(this,"float",3);var n=[];n.push(Z(this,"float",3)),n.push(Z(this,"float",3)),n.push(Z(this,"float",3)),n.push(Z(this,"float",3)),e.eb=n}this.C=284,n=e.Af*e.Bf*e.Cf;switch(e.type){case 0:e.data=Z(this,"uchar",n);break;case 1:e.data=Z(this,"uint",n);break;case 3:e.data=Z(this,"float",n);break;case 4:e.data=Z(this,"ushort",n);break;default:m(Error("Unsupported MGH/MGZ data type: "+e.type))}return n=Se(e.data),e.min=n[0],e.max=n[1],this.C+16<this.J.byteLength&&(e.Ph=Z(this,"float"),e.Ei=Z(this,"float"),e.Nh=Z(this,"float"),e.Oh=Z(this,"float")),e},A("X.parserMGZ",Wf),A("X.parserMGZ.prototype.parse",Wf.prototype.parse),C(Xf,Re),Xf.prototype.parse=function(e,t,n){D.Ja(this.f+".parse");var r=t.Nc,i=r.length;0==i&&m(Error("No _pointIndices defined on the X.object.")),this.J=n;var s=[],o=Z(this,"uchar",n.byteLength),a=o.length,f=u,l=0;for(n=1;n<a;n++)10==o[n-1]?(l=n,f=q):f&&32==o[n]&&(s.push(parseInt(Te(o,l,n),10)),f=u);o=t.F.I?t.F.I:new Float32Array(i),a=s.length;for(n=0;n<a;n++)o[s[n]]=1;s=new Float32Array(3*i);for(n=a=0;n<i;n++)f=r[n],f>i&&m(Error("Could not find scalar for vertex.")),f=o[f],s[a++]=f,s[a++]=f,s[a++]=f;t.F.I=o,t.F.dd=s,t.F.j=q,D.Da(this.f+".parse"),r=new ld,r.D=t,r.v=e,this.dispatchEvent(r)},A("X.parserLBL",Xf),A("X.parserLBL.prototype.parse",Xf.prototype.parse),C(Yf,Re),Yf.prototype.parse=function(e,t,n){D.Ja(this.f+".parse");var r=t.Nc;0==r.length&&m(Error("No _pointIndices defined on the X.object.")),this.J=n,this.C=3;var i=Z(this,"uint");Z(this,"uint"),Z(this,"uint");var s=0,o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=0;n=Array(2);var g=Array(2),y=Z(this,"float",i),b;for(b=0;b<i;b++){var w=y[b];0==b&&(n[0]=g[0]=w),0<=w?(s++,a+=w):(o++,u+=w),p+=w,v++,g[0]=Math.max(w,g[0]),n[0]=Math.min(w,n[0]),y[b]=w}0!=s&&(f=a/s),0!=o&&(l=u/o),0!=v&&(d=p/v);for(v=p=u=a=0;v<i;v++)w=y[v],b=0,0<=w?(b=Math.pow(w-f,2),a+=b):(b=Math.pow(w-l,2),u+=b),b=Math.pow(w-d,2),p+=b;1<s&&(c=Math.sqrt(a/(s-1))),1<o&&(h=Math.sqrt(u/(o-1))),n[1]=l-2.5*h,g[1]=f+2.5*c,i=r.length,s=new Float32Array(3*i);for(v=0;v<i;v++)o=y[r[v]],u=3*v,s[u]=o,s[u+1]=o,s[u+2]=o;t.F.ra=n[1],t.F.ia=g[1],-Infinity==t.F.U&&(t.F.U=n[1]),Infinity==t.F.W&&(t.F.W=g[1]),t.F.I=y,t.F.dd=s,t.F.j=q,D.Da(this.f+".parse"),r=new ld,r.D=t,r.v=e,this.dispatchEvent(r)},A("X.parserCRV",Yf),A("X.parserCRV.prototype.parse",Yf.prototype.parse),Zf.prototype.Yb=function(){var e=this.input,t;t=this.wh.Yb(),this.M=this.wh.M;if(this.tk){var e=(e[this.M++]<<24|e[this.M++]<<16|e[this.M++]<<8|e[this.M++])>>>0,n=t;if("string"==typeof n){var n=n.split(""),r,i;r=0;for(i=n.length;r<i;r++)n[r]=(n[r].charCodeAt(0)&255)>>>0}r=1,i=0;for(var s=n.length,o,u=0;0<s;){o=1024<s?1024:s,s-=o;do r+=n[u++],i+=r;while(--o);r%=65521,i%=65521}e!==(i<<16|r)>>>0&&m(Error("invalid adler-32 checksum"))}return t},C($f,Re),$f.prototype.parse=function(e,t,n,r){D.Ja(this.f+".parse"),r&&(n=(new Zf(new Uint8Array(n))).Yb(),n=n.buffer),r={},r.data=new Uint8Array(n);var i=Se(r.data);n=i[0],i=i[1],r.min=t.ra=t.fa=n,r.max=t.ia=t.ea=i,-Infinity==t.U&&(t.U=n),Infinity==t.W&&(t.W=i),i=Sc(),r.cb=i,r.fb=Sc();var s=Qc(0,0,0,1);n=Pc(),cd(i,s,n);var o=Qc(1,1,1,1),s=Pc();cd(i,o,s),i=Ue(i,t.ca),r.Bc=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],r.zc=[i[1]-i[0]+1,i[3]-i[2]+1,i[5]-i[4]+1],r.Ac=[i[0],i[2],i[4]],t.Gb(r),D.Da(this.f+".parse"),t.ib=af(this,t),r=new ld,r.D=t,r.v=e,this.dispatchEvent(r)},A("X.parserRAW",$f),A("X.parserRAW.prototype.parse",$f.prototype.parse),C(ag,Re),ag.prototype.parse=function(e,t,n){D.Ja(this.f+".parse"),this.J=n,n=Z(this,"uchar",n.byteLength);var r=n.length,i=0,s;for(s=0;s<r;s++)if(10==n[s]){var o=Te(n,i,s),i=s+1,o=o.replace(/^\s+|\s+$/g,"");"#"!=o[0]&&(o=o.split(" "),o=o.filter(function(e){return""!=e}),6==o.length&&(o[2]=parseInt(o[2],10)/255,o[3]=parseInt(o[3],10)/255,o[4]=parseInt(o[4],10)/255,o[5]=parseInt(o[5],10)/255,e.add(parseInt(o[0],10),o[1],o[2],o[3],o[4],o[5],10)))}D.Da(this.f+".parse"),n=new ld,n.D=t,n.v=e,this.dispatchEvent(n)},A("X.parserLUT",ag),A("X.parserLUT.prototype.parse",ag.prototype.parse),C(bg,Re),bg.prototype.parse=function(e,t,n){D.Ja(this.f+".parse"),n=this.vc(n);var r=n.min,i=n.max;t.ca=[n.Hd,n.Id,n.Jd],t.qb=[n.Ge/n.bh,n.Jh/n.dh,n.Kh/n.eh],t.ra=t.fa=r,t.ia=t.ea=i,-Infinity==t.U&&(t.U=r),Infinity==t.W&&(t.W=i),i=Rc(),T(i,3,0,0,0,1),T(i,0,-1,0,0,n.Hd),T(i,1,0,0,-1,n.Id),T(i,2,0,-1,0,n.Jd),n.cb=i,n.fb=Rc(),ad(n.cb,n.fb);var s=Qc(0,0,0,1),r=Pc();cd(i,s,r);var o=Qc(1,1,1,1),s=Pc();cd(i,o,s),o=[n.Hd,n.Id,n.Jd],i=Ue(i,o),n.Bc=[s[0]-r[0],s[1]-r[1],s[2]-r[2]],n.zc=[i[1]+i[0]+1,i[3]-i[2]+1,i[5]-i[4]+1],n.Ac=[i[0],i[2],i[4]],t.ca=o,t.Gb(n),t.ib=af(this,t),D.Da(this.f+".parse"),n=new ld,n.D=t,n.v=e,this.dispatchEvent(n)},bg.prototype.vc=function(e){this.J=e,e={Hd:0,Id:0,Jd:0,mode:0,Ol:0,Pl:0,Ql:0,bh:0,dh:0,eh:0,Ge:0,Jh:0,Kh:0,alpha:0,ii:0,Fi:0,fj:0,gj:0,hj:0,ef:0,he:0,qc:0,Hl:0,next:0,oi:0,zi:t,oj:0,qj:0,zi:t,Ti:0,El:0,Ri:0,bj:0,kj:0,lj:0,rk:0,sk:0,ok:t,uk:0,wk:0,xk:0,vl:0,Wl:0,ak:0,pj:0,data:t,min:Infinity,max:-Infinity,Ll:0,zh:t,Vl:t,Tl:t,orientation:t,Nl:t},this.C=0,e.Hd=Z(this,"sint"),e.Id=Z(this,"sint"),e.Jd=Z(this,"sint"),e.mode=Z(this,"sint");var n=e.Hd*e.Id*e.Jd;this.C=1024;switch(e.mode){case 0:e.data=Z(this,"schar",n);break;case 1:e.data=Z(this,"sshort",n);break;case 2:e.data=Z(this,"float",n);break;case 3:e.data=Z(this,"uint",n);break;case 4:e.data=Z(this,"double",n);break;case 6:e.data=Z(this,"ushort",n);break;case 16:e.data=Z(this,"uchar",n);break;default:m(Error("Unsupported MRC data type: "+e.mode))}this.C=28,e.bh=Z(this,"sint"),e.dh=Z(this,"sint"),e.eh=Z(this,"sint"),e.Ge=Z(this,"float"),e.Jh=Z(this,"float"),e.Kh=Z(this,"float"),e.alpha=Z(this,"float"),e.ii=Z(this,"float"),e.Fi=Z(this,"float"),e.fj=Z(this,"sint"),e.gj=Z(this,"sint"),e.hj=Z(this,"sint"),e.ef=Z(this,"float"),e.he=Z(this,"float"),e.qc=Z(this,"float"),e.Gl=Z(this,"sint"),e.next=Z(this,"sint"),e.oi=Z(this,"short"),e.oj=Z(this,"short"),e.qj=Z(this,"short"),e.Ti=Z(this,"sint"),e.Dl=Z(this,"sint"),e.Ri=Z(this,"short"),e.bj=Z(this,"short"),e.kj=Z(this,"short"),e.lj=Z(this,"short"),e.rk=Z(this,"short"),e.sk=Z(this,"short"),e.ok=Z(this,"float",6),this.C=196,e.uk=Z(this,"float"),e.wk=Z(this,"float"),e.xk=Z(this,"float"),this.C=216,e.ak=Z(this,"float"),e.pj=Z(this,"sint"),e.Il=Z(this,"schar",10);if(0!=e.next)switch(this.C=parseInt(e.next+1024,10),e.mode){case 0:e.data=Z(this,"schar",n);break;case 1:e.data=Z(this,"sshort",n);break;case 2:e.data=Z(this,"float",n);break;case 3:e.data=Z(this,"uint",n);break;case 4:e.data=Z(this,"double",n);break;case 6:e.data=Z(this,"ushort",n);break;case 16:e.data=Z(this,"uchar",n);break;default:m(Error("Unsupported MRC data type: "+e.mode))}return 0>e.qc-(e.he-e.qc)?(e.min=e.ef,e.max=e.qc+(e.qc-e.ef)):(e.min=e.qc-(e.he-e.qc),e.max=e.he),e},A("X.parserMRC",bg),A("X.parserMRC.prototype.parse",bg.prototype.parse),C(cg,Re),cg.prototype.parse=function(e,n,r){D.Ja(this.f+".parse"),this.J=r,r=Z(this,"uchar",r.byteLength);var i=r.length,s=t,o=0,a;for(a=1;a<i;a++)if(10==r[a-1]&&10==r[a]){s=Te(r,0,a-2),o=a+1;break}var f,l,c,h,i=s.split(/\r?\n/),s=0;for(a=i.length;s<a;s++)(f=i[s],f.match(/NRRD\d+/))?this.$i=q:!f.match(/^#/)&&(h=f.match(/(.*):(.*)/))&&(l=h[1].trim(),f=h[2].trim(),(c=this.Ai[l])?c.call(this,f):this[l]=f);this.$i||m(Error("Not an NRRD file")),"raw"!==this.encoding&&"gzip"!==this.encoding&&"gz"!==this.encoding&&m(Error("Only raw or gz/gzip encoding is allowed"));if(!this.ha&&(this.ha=[new R(1,0,0),new R(0,1,0),new R(0,0,1)],this.Tf)){i=[];for(h=0;2>=h;h++)i.push(isNaN(this.Tf[h])?p:this.ha[h].scale(this.Tf[h]))}o=r.subarray(o);if("gzip"==this.encoding||"gz"==this.encoding)o=(new Vf(new Uint8Array(o))).Yb();o=o.buffer,r={data:t,min:Infinity,max:-Infinity},r.data=new this.Mb(o),h=Se(r.data),o=r.min=h[0],h=r.max=h[1],n.ra=n.fa=o,n.ia=n.ea=h,n.ca=[this.Rf[0],this.Rf[1],this.Rf[2]],i=(new R(this.ha[0][0],this.ha[0][1],this.ha[0][2])).Ib(),s=(new R(this.ha[1][0],this.ha[1][1],this.ha[1][2])).Ib(),a=(new R(this.ha[2][0],this.ha[2][1],this.ha[2][2])).Ib(),n.qb=[i,s,a],-Infinity==n.U&&(n.U=o),Infinity==n.W&&(n.W=h),i=h=1,"left-posterior-superior"==this.zh&&(i=h=-1),o=Sc(),"false"==n.reslicing||n.reslicing==u?(T(o,0,h,0,0,0),T(o,1,0,i,0,0),T(o,2,0,0,1,0)):(T(o,0,h*this.ha[0][0],h*this.ha[1][0],h*this.ha[2][0],h*this.Sf[0]),T(o,1,i*this.ha[0][1],i*this.ha[1][1],i*this.ha[2][1],i*this.Sf[1]),T(o,2,1*this.ha[0][2],1*this.ha[1][2],1*this.ha[2][2],1*this.Sf[2])),T(o,3,0,0,0,1),r.cb=o,r.fb=Rc(),ad(r.cb,r.fb),i=Qc(0,0,0,1),h=Pc(),cd(o,i,h),s=Qc(1,1,1,1),i=Pc(),cd(o,s,i),o=Ue(o,n.ca),r.Bc=[i[0]-h[0],i[1]-h[1],i[2]-h[2]],r.zc=[o[1]-o[0]+1,o[3]-o[2]+1,o[5]-o[4]+1],r.Ac=[o[0],o[2],o[4]],n.Gb(r),D.Da(this.f+".parse"),n.ib=af(this,n),r=new ld,r.D=n,r.v=e,this.dispatchEvent(r)},cg.prototype.Ai={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.Mb=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.Mb=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.Mb=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.Mb=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.Mb=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.Mb=Uint32Array;break;case"float":this.Mb=Float32Array;break;case"double":this.Mb=Float64Array;break;default:m(Error("Unsupported NRRD data type: "+e))}return this.type=e},endian:function(e){return this.Al=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.Zb=parseInt(e,10)},sizes:function(e){var t,n,r,i;r=e.split(/\s+/),i=[],t=0;for(n=r.length;t<n;t++)e=r[t],i.push(parseInt(e,10));return this.Rf=i},space:function(e){return this.zh=e},"space origin":function(e){return this.Sf=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,n;e=e.match(/\(.*?\)/g);var r,i,s;s=[],r=0;for(i=e.length;r<i;r++)n=e[r],s.push(function(){var e,r,i,s;i=n.slice(1,-1).split(/,/),s=[],e=0;for(r=i.length;e<r;e++)t=i[e],s.push(parseFloat(t));return s}());return this.ha=s},spacings:function(e){var t;t=e.split(/\s+/);var n,r,i;i=[],n=0;for(r=t.length;n<r;n++)e=t[n],i.push(parseFloat(e));return this.Tf=i}},A("X.parserNRRD",cg),A("X.parserNRRD.prototype.parse",cg.prototype.parse),C(dg,Re),dg.prototype.parse=function(e,t,n){D.Ja(this.f+".parse"),this.J=n;var r=t.h,i=t.n;if("solid"==Te(Z(this,"uchar",5))){t.h=r=new W(n.byteLength),t.n=i=new W(n.byteLength);var s=r,r=i,i=Z(this,"uchar",n.byteLength-5);n=i.length;var o=u,a=u,f=0,l;for(l=0;l<n;l++)if(10==i[l]){if(o||a){var c=Te(i,f,l).split(" "),a=parseFloat(c[0]),h=parseFloat(c[1]),c=parseFloat(c[2]);o?(r.add(a,h,c),r.add(a,h,c),r.add(a,h,c)):s.add(a,h,c),a=o=u}}else 32==i[l-1]&&(102==i[l]?(f=l+=13,o=q):118==i[l]&&(f=l+=7,a=q))}else{this.C=80,s=Z(this,"uint"),t.h=r=new W(9*s),t.n=i=new W(9*s);for(n=n=0;n<s;n++)o=Z(this,"float",12),f=o[0],l=o[1],a=o[2],i.add(f,l,a),i.add(f,l,a),i.add(f,l,a),r.add(o[3],o[4],o[5]),r.add(o[6],o[7],o[8]),r.add(o[9],o[10],o[11]),this.C+=2}D.Da(this.f+".parse"),s=new ld,s.D=t,s.v=e,this.dispatchEvent(s)},A("X.parserSTL",dg),A("X.parserSTL.prototype.parse",dg.prototype.parse),C(eg,Re),eg.prototype.parse=function(e,t,n){if(!fg(n))try{n=(new Vf(new Uint8Array(n))).Yb().buffer,fg(n)||(this.Mc=u)}catch(r){this.Mc=u}n=this.vc(n);var i=n.min,s=n.max;t.ra=t.fa=i,t.ia=t.ea=s,-Infinity==t.U&&(t.U=i),Infinity==t.W&&(t.W=s),i=Rc(),T(i,3,0,0,0,1);if("false"==t.reslicing||t.reslicing==u){var o=s=1,a=1;0<n.sa[1]&&(s=n.sa[1]),0<n.sa[2]&&(o=n.sa[2]),0<n.sa[2]&&(a=n.sa[3]),0>n.sa[0]&&(a=-a),T(i,0,-s,0,0,0),T(i,1,0,o,0,0),T(i,2,0,0,a,0)}else if(0<n.Nf){var f=0,l=n.sh,c=n.th,h=n.uh,a=o=s=1,p=n.ph,d=n.qh,v=n.rh,f=1-(l*l+c*c+h*h);1e-7>f?(f=1/Math.sqrt(l*l+c*c+h*h),l*=f,c*=f,h*=f,f=0):f=Math.sqrt(f),0<n.sa[1]&&(s=n.sa[1]),0<n.sa[2]&&(o=n.sa[2]),0<n.sa[2]&&(a=n.sa[3]),0>n.sa[0]&&(a=-a),T(i,0,(f*f+l*l-c*c-h*h)*s,2*(l*c-f*h)*o,2*(l*h+f*c)*a,p),T(i,1,2*(l*c+f*h)*s,(f*f+c*c-l*l-h*h)*o,2*(c*h-f*l)*a,d),T(i,2,2*(l*h-f*c)*s,2*(c*h+f*l)*o,(f*f+h*h-c*c-l*l)*a,v)}else 0<n.xh?(s=n.Ah,o=n.Bh,a=n.Ch,T(i,0,s[0],s[1],s[2],s[3]),T(i,1,o[0],o[1],o[2],o[3]),T(i,2,a[0],a[1],a[2],a[3])):0==n.Nf?(T(i,0,n.sa[1],0,0,0),T(i,1,0,n.sa[2],0,0),T(i,2,0,0,n.sa[3],0)):window.console.log("UNKNOWN METHOD IN PARSER NII");n.cb=i,n.fb=Rc(),ad(n.cb,n.fb),o=Qc(0,0,0,1),s=Pc(),cd(i,o,s),a=Qc(1,1,1,1),o=Pc(),cd(i,a,o),a=[n.Zb[1],n.Zb[2],n.Zb[3]],i=Ue(i,a),n.Bc=[o[0]-s[0],o[1]-s[1],o[2]-s[2]],n.zc=[i[1]-i[0]+1,i[3]-i[2]+1,i[5]-i[4]+1],n.Ac=[i[0],i[2],i[4]],t.ca=a,t.Gb(n),t.ib=af(this,t),n=new ld,n.D=t,n.v=e,this.dispatchEvent(n)},eg.prototype.vc=function(e){this.J=e,e={fk:0,pi:t,qi:t,yi:0,dk:0,Yj:0,ui:t,Zb:t,Wi:0,Xi:0,Yi:0,Ui:0,pf:0,ji:0,kk:0,sa:t,Hh:0,ck:0,bk:0,jk:0,hk:t,vk:t,ki:0,li:0,ik:0,pk:0,Hi:0,Ii:0,si:t,hi:t,Nf:0,xh:0,sh:0,th:0,uh:0,ph:0,qh:0,rh:0,Ah:t,Bh:t,Ch:t,Vi:t,cj:t,data:t,min:Infinity,max:-Infinity},e.fk=Z(this,"uint"),e.pi=Z(this,"uchar",10),e.qi=Z(this,"uchar",18),e.yi=Z(this,"uint"),e.dk=Z(this,"ushort"),e.Yj=Z(this,"uchar"),e.ui=Z(this,"uchar"),e.Zb=Z(this,"ushort",8),e.Wi=Z(this,"float"),e.Xi=Z(this,"float"),e.Yi=Z(this,"float"),e.Ui=Z(this,"ushort"),e.pf=Z(this,"ushort"),e.ji=Z(this,"ushort"),e.kk=Z(this,"ushort"),e.sa=Z(this,"float",8),e.Hh=Z(this,"float"),e.ck=Z(this,"float"),e.bk=Z(this,"float"),e.jk=Z(this,"ushort"),e.hk=Z(this,"uchar"),e.vk=Z(this,"uchar"),e.ki=Z(this,"float"),e.li=Z(this,"float"),e.ik=Z(this,"float"),e.pk=Z(this,"float"),e.Hi=Z(this,"uint",1),e.Ii=Z(this,"uint",1),e.si=Z(this,"uchar",80),e.hi=Z(this,"uchar",24),e.Nf=Z(this,"ushort"),e.xh=Z(this,"ushort"),e.sh=Z(this,"float"),e.th=Z(this,"float"),e.uh=Z(this,"float"),e.ph=Z(this,"float"),e.qh=Z(this,"float"),e.rh=Z(this,"float"),e.Ah=Z(this,"float",4),e.Bh=Z(this,"float",4),e.Ch=Z(this,"float",4),e.Vi=Z(this,"uchar",16),e.cj=Z(this,"uchar",4),this.C=parseInt(e.Hh,10);var n=e.Zb[1]*e.Zb[2]*e.Zb[3];switch(e.pf){case 2:e.data=Z(this,"uchar",n);break;case 4:e.data=Z(this,"sshort",n);break;case 8:e.data=Z(this,"sint",n);break;case 16:e.data=Z(this,"float",n);break;case 32:e.data=Z(this,"complex",n);break;case 64:e.data=Z(this,"double",n);break;case 256:e.data=Z(this,"schar",n);break;case 512:e.data=Z(this,"ushort",n);break;case 768:e.data=Z(this,"uint",n);break;default:m(Error("Unsupported NII data type: "+e.pf))}return n=Se(e.data),e.min=n[0],e.max=n[1],e},A("X.parserNII",eg),A("X.parserNII.prototype.parse",eg.prototype.parse),C(gg,Re),gg.prototype.parse=function(e,n,r){D.Ja(this.f+".parse");var i=n.h,s=n.n,o=n.pa;this.J=r,Z(this,"uchar",6),Z(this,"ushort",3);var a=Z(this,"float",3);Z(this,"float",3);var f=Z(this,"ushort");Z(this,"uchar",200),Z(this,"ushort"),Z(this,"uchar",200),r=Z(this,"float",16),Z(this,"uchar",444),Z(this,"uchar",4),Z(this,"uchar",4),Z(this,"float",6),Z(this,"uchar",2),Z(this,"uchar"),Z(this,"uchar"),Z(this,"uchar"),Z(this,"uchar"),Z(this,"uchar"),Z(this,"uchar");var l=Z(this,"uint");Z(this,"uint");var c=Z(this,"uint"),h=0===l?Infinity:l,p=[],d=[],l=Infinity,v=-Infinity,m=t,g=t,y=t,b=t,s=i=t,w=Z(this,"uint",(this.J.byteLength-1e3)/4);this.C=c;for(var E=Z(this,"float",(this.J.byteLength-1e3)/4),S=0,c=o=0;c<h;c++){if("undefined"==typeof w[S]){h=c;break}for(var x=w[S],T=new W(3*x),N=0,C=0;C<x;C++){var k=E[S+3*C+C*f+1],L=E[S+3*C+C*f+2],A=E[S+3*C+C*f+3],k=k/a[0],L=L/a[1],A=A/a[2];T.add(k,L,A);if(0<C)var O=T.get(C-1),N=N+Math.sqrt(Math.pow(k-O[0],2)+Math.pow(L-O[1],2)+Math.pow(A-O[2],2));C<x-1&&(o+=6)}S+=3*x+x*f+1,C=T.mb,x=T.jb,k=T.nb,L=T.kb,A=T.ob,O=T.lb;if(!m||C<m)m=C;if(!g||x>g)g=x;if(!y||k<y)y=k;if(!b||L>b)b=L;if(!i||A<i)i=A;if(!s||O>s)s=O;p.push(T),d.push(N)}a=(m+g)/2,f=(y+b)/2,b=(i+s)/2,y=new Float32Array(o),n.h=i=new W(o),n.n=s=new W(o),n.pa=o=new W(o);for(c=m=0;c<h;c++){g=p[c],w=g.count,N=d[c],l=Math.min(l,N),v=Math.max(v,N);for(C=0;C<w-1;C++){S=g.get(C),E=g.get(C+1),i.add(S[0],S[1],S[2]),i.add(E[0],E[1],E[2]);var T=S[0]-a,x=S[1]-f,k=S[2]-b,L=Math.sqrt(T*T+x*x+k*k),A=E[0]-a,O=E[1]-f,M=E[2]-b,_=Math.sqrt(A*A+O*O+M*M);s.add(T/L,x/L,k/L),s.add(A/_,O/_,M/_),E=[Math.abs(E[0]-S[0]),Math.abs(E[1]-S[1]),Math.abs(E[2]-S[2])],S=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),E[0]/=S,E[1]/=S,E[2]/=S,o.add(E[0],E[1],E[2]),o.add(E[0],E[1],E[2]),y[m++]=N,y[m++]=N,y[m++]=N,y[m++]=N,y[m++]=N,y[m++]=N}}n.Ia="LINES",h=new kd,h.ra=l,h.ia=v,h.U=l,h.W=v,h.dd=y,h.ug=u,h.j=q,n.F=h,l=u;for(c=0;16>c;c++)if(0!=r[c]){l=q;break}l==u&&(r[0]=r[5]=r[10]=r[15]=1),D.Da(this.f+".parse"),D.g.Wf(r,n.ja.Q),r=new ld,r.D=n,r.v=e,this.dispatchEvent(r)},A("X.parserTRK",gg),A("X.parserTRK.prototype.parse",gg.prototype.parse),C(hg,Re),hg.prototype.parse=function(e,t,n){D.Ja(this.f+".parse"),this.J=n,n=n.byteLength;var r=Z(this,"uchar",n),i=[];t.h=new W(n),t.n=new W(n);var s=t.h,o=t.n,u=0,a;for(a=0;a<n;++a)if(10==r[a]){var f=Te(r,u,a).replace(/\s{2,}/g," ").split(" ");if("v"==f[0])i.push([parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])]);else if("f"==f[0]){var l=i[parseInt(f[1],10)-1],u=i[parseInt(f[2],10)-1],f=i[parseInt(f[3],10)-1];s.add(l[0],l[1],l[2]),s.add(u[0],u[1],u[2]),s.add(f[0],f[1],f[2]),l=new R(l[0],l[1],l[2]),f=new R(f[0],f[1],f[2]),u=Ic((new R(u[0],u[1],u[2])).wa(l),f.wa(l)),u.normalize(),o.add(u.x,u.y,u.d),o.add(u.x,u.y,u.d),o.add(u.x,u.y,u.d)}u=a+1}D.Da(this.f+".parse"),n=new ld,n.D=t,n.v=e,this.dispatchEvent(n)},A("X.parserOBJ",hg),A("X.parserOBJ.prototype.parse",hg.prototype.parse),C(ig,M),ig.prototype.load=function(e,n){(!e||!n)&&m(Error("No container or object to load."));if(!Cc(this.Kc.ga,e.qa)||this.Kc.get(e.qa)){this.Kc.set(e.qa,u);var r=kg(e)[0];if(e.$a!=t)this.parse(t,e,n);else{var i=new XMLHttpRequest;L(i,"abort",this.Ig.bind(this,i,e,n)),L(i,"error",this.Ig.bind(this,i,e,n)),L(i,"load",this.parse.bind(this,i,e,n)),i.open("GET",r,q),i.responseType="arraybuffer",i.send(t)}}},ig.prototype.parse=function(e,n,r){jg(this,1),setTimeout(function(){var i=kg(n),s=i[3],i=new i[2];$b(i,yd,this.complete.bind(this));var o=n.$a;o==t&&(o=e.response,n.$a=o),i.parse(n,r,o,s)}.bind(this),100)},ig.prototype.complete=function(e){jg(this,1),setTimeout(function(){var t=e.v,n=e.D;t.r.j=u,t.j=q,n.q(),this.Kc.set(t.qa,q)}.bind(this),100)},ig.prototype.Ig=function(e,t,n){m(Error("Loading failed: ",t,n))};var lg={OBJ:[hg,t],OFF:[kf,t],STL:[dg,t],VTK:[nf,t],TRK:[gg,t],MRC:[bg,t],ST:[bg,t],FSM:[pf,t],INFLATED:[pf,t],SMOOTHWM:[pf,t],SPHERE:[pf,t],PIAL:[pf,t],ORIG:[pf,t],NRRD:[cg,t],NII:[eg,t],GZ:[eg,t],DCM:[lf,t],DICOM:[lf,t],"":[lf,t],CRV:[Yf,t],LABEL:[Xf,t],MGH:[Wf,u],MGZ:[Wf,q],RAW:[$f,u],RZ:[$f,q],TXT:[ag,t],LUT:[ag,t],PNG:[bf,"png"],JPG:[bf,"jpeg"],JPEG:[bf,"jpeg"],GIF:[bf,"gif"]};C(mg,tc),C(ng,Y),ng.prototype.__defineGetter__("start",v("af")),ng.prototype.__defineSetter__("start",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid start")),this.af=e}),ng.prototype.__defineGetter__("end",v("Ke")),ng.prototype.__defineSetter__("end",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid end")),this.Ke=e}),ng.prototype.__defineGetter__("radius",v("jc")),ng.prototype.__defineSetter__("radius",function(e){x(e)||m(Error("Invalid radius.")),this.jc=e}),ng.prototype.q=function(){qd(this,new mg({start:this.af,end:this.Ke,zb:this.jc,ta:this.bb})),ng.u.q.call(this)},A("X.cylinder",ng),A("X.cylinder.prototype.modified",ng.prototype.q),C(og,tc),C(pg,Y),pg.prototype.__defineGetter__("center",v("z")),pg.prototype.__defineSetter__("center",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid center")),this.z=e}),pg.prototype.__defineGetter__("radius",v("jc")),pg.prototype.__defineSetter__("radius",function(e){x(e)||m(Error("Invalid radius.")),this.jc=e}),pg.prototype.q=function(){qd(this,new og({lf:this.z,zb:this.jc,ta:this.bb,lk:this.$h})),pg.u.q.call(this)},A("X.sphere",pg),A("X.sphere.prototype.modified",pg.prototype.q),C(hf,P),hf.prototype.q=function(){var e=new ld;e.D=this,this.dispatchEvent(e),this.yb.q()},hf.prototype.__defineSetter__("showOnly",function(e){var n=[-1,-1,-1,-1];e!=t&&(la(e)&&4==e.length?n=e:(this.xa||m(Error("No colortable assigned.")),n=this.xa.Ka.get(e).slice(1,5))),this.$e=new Float32Array([Math.floor(255*n[0]),Math.floor(255*n[1]),Math.floor(255*n[2]),Math.floor(255*n[3])])}),A("X.labelmap",hf),C(qg,tc),C(rg,Y),rg.prototype.__defineGetter__("center",v("z")),rg.prototype.__defineSetter__("center",function(e){(e==t||!la(e)||3!=e.length)&&m(Error("Invalid center")),this.z=e}),rg.prototype.__defineGetter__("lengthX",v("Ne")),rg.prototype.__defineSetter__("lengthX",function(e){x(e)||m(Error("Invalid lengthX.")),this.Ne=e}),rg.prototype.__defineGetter__("lengthY",v("Oe")),rg.prototype.__defineSetter__("lengthY",function(e){x(e)||m(Error("Invalid lengthY.")),this.Oe=e}),rg.prototype.__defineGetter__("lengthZ",v("Pe")),rg.prototype.__defineSetter__("lengthZ",function(e){x(e)||m(Error("Invalid lengthZ.")),this.Pe=e}),rg.prototype.q=function(){qd(this,new qg({lf:this.z,zb:[this.Ne/2,this.Oe/2,this.Pe/2]})),rg.u.q.call(this)},A("X.cube",rg),A("X.cube.prototype.modified",rg.prototype.q),C(Le,Je),Le.prototype.Kd=function(e){Le.u.Kd.call(this,e);var n=new Jd;e.Xc==t&&(e.Xc=0),n.vb=0>e.Xc,n.hb=q,this.dispatchEvent(n)},C(sg,M),sg.prototype.add=function(e){return this.I.push(e),q},sg.prototype.remove=function(e){return e=this.I.indexOf(e),-1<e&&this.I.splice(e,1),q},sg.prototype.clear=function(){this.I.length=0},sg.prototype.sort=function(){ug(this,0,this.I.length)},C(vg,Pb);var wg=[];vg.prototype.Of=function(){Jb(this.S,bc),this.S.length=0},vg.prototype.handleEvent=function(){m(Error("EventHandler.handleEvent not implemented"))},yg.Kg=function(){return yg.Sg?yg.Sg:yg.Sg=new yg},yg.prototype.mj=0,yg.Kg(),C(zg,jc),zg.prototype.Qi=yg.Kg();var Ag=t;w=zg.prototype,w.Rg=t,w.Zc=u,w.H=t,w.$j=t,w.Ld=t,w.Cd=t,w.mf=t,w.t=v("H"),w.Qf=function(e){this.Ld&&this.Ld!=e&&m(Error("Method not supported")),zg.u.Qf.call(this,e)},w.ne=v("$b"),w.Wc=function(){this.H=this.$b.createElement("div")},w.cc=function(e){this.dc(e)},w.dc=function(e,n){this.Zc&&m(Error("Component already rendered")),this.H||this.Wc(),e?e.insertBefore(this.H,n||t):this.$b.ka.body.appendChild(this.H),(!this.Ld||this.Ld.Zc)&&this.ke()},w.ke=function(){function e(e){!e.Zc&&e.t()&&e.ke()}this.Zc=q,this.Cd&&Jb(this.Cd,e,p)},w.le=function(){function e(e){e.Zc&&e.le()}this.Cd&&Jb(this.Cd,e,p),this.Ji&&this.Ji.Of(),this.Zc=u},w.removeChild=function(e,n){if(e){var r=na(e)?e:e.Rg||(e.Rg=":"+(e.Qi.mj++).toString(36)),i;this.mf&&r?(i=this.mf,i=(r in i?i[r]:p)||t):i=t,e=i,r&&e&&(i=this.mf,r in i&&delete i[r],Nb(this.Cd,e),n&&(e.le(),e.H&&ge(e.H)),r=e,r==t&&m(Error("Unable to set parent component")),r.Ld=t,zg.u.Qf.call(r,t))}return e||m(Error("Child is not in parent component")),e},C(Cg,jc),w=Cg.prototype,w.Yf=0,w.Gd=0,w.zf=100,w.Hg=0,w.Uf=1,w.Zi=u,w.jj=u,w.Od=function(e){e=Dg(this,e),this.Yf!=e&&(this.Yf=e+this.Hg>this.zf?this.zf-this.Hg:e<this.Gd?this.Gd:e,!this.Zi&&!this.jj&&this.dispatchEvent("change"))},w.qe=function(){return Dg(this,this.Yf)},w.pe=function(){return Dg(this,this.Gd)},w.oe=function(){return Dg(this,this.zf)},C(Eg,zg);var Fg={vertical:"progress-bar-vertical",horizontal:"progress-bar-horizontal"};w=Eg.prototype,w.Wc=function(){this.Ab=this.ne().Wc("div","progress-bar-thumb");var e=Fg[this.mh];this.H=this.ne().Wc("div",e,this.Ab),Gg(this),e=this.pe(),this.t().setAttribute("aria-valuemin",e),e=this.oe(),this.t().setAttribute("aria-valuemax",e)},w.ke=function(){Eg.u.ke.call(this),K&&7>sb&&L(this.t(),"resize",this.Fe,u,this),this.Fe();var e=this.t();e.setAttribute("role","progressbar"),e.setAttribute("aria-live","polite")},w.le=function(){Eg.u.le.call(this),K&&7>sb&&ac(this.t(),"resize",this.Fe,u,this)},w.qe=function(){return this.Md.qe()},w.Od=function(e){this.Md.Od(e),this.t()&&Gg(this)},w.pe=function(){return this.Md.pe()},w.oe=function(){return this.Md.oe()},w.mh="horizontal",w.Ki=function(){this.Fe(),this.dispatchEvent("change")},w.Fe=function(){if(this.Ab){var e=this.pe(),t=this.oe(),e=(this.qe()-e)/(t-e),t=Math.round(100*e);"vertical"==this.mh?K&&7>sb?(this.Ab.style.top=0,this.Ab.style.height="100%",t=this.Ab.offsetHeight,e=Math.round(e*t),this.Ab.style.top=t-e+"px",this.Ab.style.height=e+"px"):(this.Ab.style.top=100-t+"%",this.Ab.style.height=t+"%"):this.Ab.style.width=t+"%"}},C(Hg,Eg),Hg.prototype.uf=function(){var e=oe(this.ab,"position");if("static"==e||""==e)this.Ue=this.ab.style.position,this.ab.style.position="relative";var e=document.getElementsByTagName("head")[0],t=de("style");t.type="text/css",t.media="screen";var n=document.createTextNode(String(this.fc[0])),r=document.createTextNode(String(this.fc[1])),i=document.createTextNode(String(this.fc[2]));e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(i),this.Fb=t,this.cc(this.ab),e=this.t(),e.style.position="absolute",e.style.top=(this.ab.clientHeight-5)/2+"px",e.style.left=(this.ab.clientWidth-100)/2+"px",e.classList.add("xtk-progress-bar")},Hg.prototype.Fd=function(){this.Fb&&ge(this.Fb),this.t()&&ge(this.t()),this.Td&&ge(this.Td.t()),this.Td=this.Fb=t,this.Ue&&(this.ab.style.position=this.Ue)},C(Kg,M),w=Kg.prototype,w.Ef=function(){window.cancelAnimationFrame(this.He),this.R.PROGRESSBAR_ENABLED&&(this.Vb=new Hg(this.v,3))},w.Ff=function(){this.R.PROGRESSBAR_ENABLED&&this.Vb&&(Ig(this.Vb),this.Qd=Jg(function(){this.Qd=t,this.Vb&&(this.Vb.Fd(),this.Vb=t),this.hd=this.Zd=q,this.cc()}.bind(this),700))},w.Gf=function(e){this.Vb&&this.Vb.Od(100*e.Ad)},w.Dj=function(e){this.La&&this.La.Od(100*e.Ad)},w.tj=function(e){e!=t&&e instanceof ld&&e.D&&this.ub(e.D)},w.Ej=function(e){e!=t&&e instanceof md&&e.D&&this.remove(e.D)},w.If=function(e){(e==t||!(e instanceof Ld))&&m(Error("Invalid hover event."))},w.ve=function(){var e=be(this.v);this.K=e.clientWidth,this.A=e.clientHeight,e=be(this.na),e.width=this.K,e.height=this.A,"renderer3D"==this.f&&(this.a.viewport(0,0,this.K,this.A),this.N.Ve=D.g.yf(D.g.Ed(),this.N.eg,this.na.width/this.na.height,1,1e4))},w.Jf=function(e){(e==t||!(e instanceof Kd))&&m(Error("Invalid scroll event."))},Kg.prototype.__defineGetter__("config",v("R")),Kg.prototype.__defineGetter__("interactor",v("T")),Kg.prototype.__defineGetter__("camera",v("N")),Kg.prototype.__defineGetter__("loadingCompleted",v("hd")),Kg.prototype.__defineGetter__("container",v("v")),Kg.prototype.__defineSetter__("container",function(e){e==t&&m(Error("An ID to a valid container (<div>..) is required."));var n=e;na(n)&&(n=be(e)),pa(n)&&1==n.nodeType||m(Error("Could not find the given container.")),this.v=n}),w=Kg.prototype,w.Nd=function(){this.N.reset()},w.Ca=function(e){var t=de("canvas");this.v.appendChild(t),this.K=this.v.clientWidth,this.A=this.v.clientHeight,t.width=this.K,t.height=this.A;try{var n=t.getContext(e);n||m(Error())}catch(r){var i="Sorry, "+e+' context is <strong>not supported</strong> on this machine! See <a href="http://crash.goXTK.com" target="_blank">http://crash.goXTK.com</a> for requirements..';this.v.innerHTML='<h3 style="color:red;font-family:sans-serif;">Oooops..</h3><p style="color:red;font-family:sans-serif;">'+i+"</p>",m(Error(i))}this.aa=new ig,L(this.aa,Ad,this.Dj.bind(this)),this.na=t,this.a=n,t=new Le(this.na),"2d"==e&&(t=new Ne(this.na)),t.Ca(),L(t,wd,this.Nd.bind(this)),L(t,Bd,this.If.bind(this)),L(t,vd,this.Jf.bind(this)),this.T=t,t=new Pe(this.K,this.A),"2d"==e&&(t=new cf(this.K,this.A)),t.observe(this.T),this.N=t,L(window,"resize",this.ve,u,this)},w.add=function(e){(e instanceof rg||e instanceof pg||e instanceof ng)&&e.q(),this.Ha.push(e),this.ub(e)},w.remove=function(e){(!this.na||!this.a)&&m(Error("The renderer was not initialized properly."));if(e!=t){dc(e);var n=this.Ha.length,r;for(r=0;r<n;r++)if(this.Ha[r].qa==e.qa)return this.Ha[r]=t,this.Ha.splice(r,1),q}return u},w.ub=function(e){(!this.na||!this.a)&&m(Error("The renderer was not initialized properly.")),e!=t&&(ec(e,yd)||L(e,yd,this.tj.bind(this)),ec(e,zd)||L(e,zd,this.Ej.bind(this)),ec(e,Dd)||L(e,Dd,this.Ef.bind(this)),ec(e,Fd)||L(e,Fd,this.Gf.bind(this)),ec(e,Ed)||L(e,Ed,this.Ff.bind(this)))},w.get=function(e){e==t&&m(Error("Invalid object id."));for(var n=this.pb.I,r=n.length,i=0,i=0;i<r;i++)if(n[i].qa==e)return n[i];return t},w.cc=function(){(!this.na||!this.a)&&m(Error("The renderer was not initialized properly."));if(this.tg==t){if(Bc(this.aa.Kc)){if(this.R.PROGRESSBAR_ENABLED&&!this.La&&(this.La=new Hg(this.v,3)),this.Zd=this.hd=u,this.tg=Jg(function(){this.tg=t,this.cc()}.bind(this),100),!this.R.INTERMEDIATE_RENDERING)return}else if(!this.hd&&!this.Zd&&(this.Zd=q,eval("this.onShowtime()"),this.hd=q),this.La){this.R.PROGRESSBAR_ENABLED&&this.La&&!this.Qd&&(Ig(this.La),this.Qd=Jg(function(){this.Qd=t,this.La&&(this.La.Fd(),this.La=t),this.cc()}.bind(this),700));return}this.He=window.requestAnimationFrame(this.cc.bind(this)),eval("this.onRender()"),this.dc(u,q),eval("this.afterRender()")}},w.lh=aa(),w.jh=aa(),w.yg=aa(),w.dc=aa(),w.Ta=function(){dc(this),ac(window,"resize",this.ve,u,this),window.cancelAnimationFrame(this.He),this.aa&&(delete this.aa,this.aa=t),this.La&&(this.La.Fd(),delete this.La,this.La=t),this.pb.clear(),delete this.pb,this.Ha.length=0,delete this.Ha,delete this.aa,this.aa=t,delete this.N,this.N=t,delete this.T,this.T=t,delete this.a,this.a=t,ge(this.na),delete this.na,this.na=t},Ng.prototype.tb=aa(),C(Og,Ng),Og.prototype.tb=function(e,n,r,i){Lg(qe(e),0,e,n,this.nf,r,t,i)},C(Pg,Ng),Pg.prototype.tb=function(e,t,n){Lg(this.element,this.Fg,e,t,p,n,this.Tj)},C(Qg,jc),w=Qg.prototype,w.H=t,w.gi=q,w.zg=t,w.Ma=u,w.ek=u,w.wf=-1,w.Wg=-1,w.Pi=u,w.wi=q,w.$c="toggle_display",w.t=v("H"),w.Pf=function(e){this.Ma&&m(Error("Can not change this state of the popup while showing.")),this.H=e},w.tb=ga,w.Eg=function(e){"toggle_display"==this.$c?this.ek?Jg(this.Og,0,this):this.Og():"move_offscreen"==this.$c&&(this.H.style.top="-10000px"),this.Hf(e)},w.Og=function(){this.H.style.visibility="hidden",Be(this.H,u)},w.Df=function(){return this.dispatchEvent("beforeshow")},w.kh=function(){this.wf=xa(),this.Wg=-1,this.dispatchEvent("show")},w.Hf=function(e){this.dispatchEvent({type:"hide",target:e})},w.hh=function(e){e=e.target,!ie(this.H,e)&&(!this.zg||ie(this.zg,e))&&!(150>xa()-this.wf)&&Sg(this,e)},w.rj=function(e){27==e.keyCode&&Sg(this,e.target)&&(e.preventDefault(),e.stopPropagation())},w.gh=function(e){if(this.wi){var t=ae(this.H);if(K||ib){if(e=t.activeElement,!e||ie(this.H,e)||"BODY"==e.tagName)return}else if(e.target!=t)return;150>xa()-this.wf||Sg(this)}},C(Tg,Qg),Tg.prototype.tb=function(){if(this.we){var e=!this.Ma&&"move_offscreen"!=this.$c,t=this.t();e&&(t.style.visibility="hidden",Be(t,q)),this.we.tb(t,this.Xj,this.Kl),e&&Be(t,u)}},w=Ug.prototype,w.sf=function(){return this.ga.sf()},w.add=function(e){this.ga.set(Vg(e),e)},w.df=function(e){e=yc(e);for(var t=e.length,n=0;n<t;n++)this.add(e[n])},w.Of=function(e){e=yc(e);for(var t=e.length,n=0;n<t;n++)this.remove(e[n])},w.remove=function(e){return this.ga.remove(Vg(e))},w.clear=function(){this.ga.clear()},w.contains=function(e){return e=Vg(e),Cc(this.ga.ga,e)},w.Tg=function(e){var t=new Ug;e=yc(e);for(var n=0;n<e.length;n++){var r=e[n];this.contains(r)&&t.add(r)}return t},w.Dd=function(){return this.ga.Dd()},w.l=function(){return new Ug(this)},C(Wg,Tg);var Yg=[];w=Wg.prototype,w.Sa=t,w.className="goog-tooltip",w.yh=500,w.Oi=0,w.ne=v("$b"),w.Pf=function(e){var t=this.t();t&&ge(t),Wg.u.Pf.call(this,e),e&&(t=this.$b.ka.body,t.insertBefore(e,t.lastChild))},w.Df=function(){if(!Qg.prototype.Df.call(this))return u;if(this.anchor)for(var e,t=0;e=Yg[t];t++)ie(e.t(),this.anchor)||Rg(e,u);return 0<=Ib(Yg,this)||Yg.push(this),e=this.t(),e.className=this.className,Zg(this),L(e,"mouseover",this.Ng,u,this),L(e,"mouseout",this.Mg,u,this),$g(this),q},w.Hf=function(){Nb(Yg,this);for(var e=this.t(),t,n=0;t=Yg[n];n++)t.anchor&&ie(e,t.anchor)&&Rg(t,u);this.nh&&ah(this.nh),ac(e,"mouseover",this.Ng,u,this),ac(e,"mouseout",this.Mg,u,this),this.anchor=p,0==(this.Kb?this.Ma?4:1:this.Yc?3:this.Ma?2:0)&&(this.Be=u),Qg.prototype.Hf.call(this)},w.$g=function(e,t){this.anchor==e&&this.je.contains(this.anchor)&&(this.Be||!this.Ul?(Rg(this,u),this.Ma||(this.anchor=e,this.we=t||bh(this,0)||p,this.Ma&&this.tb(),Rg(this,q))):this.anchor=p),this.Kb=p},w.ij=function(e){this.Yc=p,e==this.anchor&&(this.Sa==t||this.Sa!=this.t()&&!this.je.contains(this.Sa))&&(!this.Bg||!this.Bg.Sa)&&Rg(this,u)},w.Ni=function(e){var t=dh(this,e.target);this.Sa=t,Zg(this),t!=this.anchor&&(this.anchor=t,this.Kb||(this.Kb=Jg(va(this.$g,this,t,p),this.yh)),eh(this),ch(this,e))},w.Mi=function(e){ch(this,e),this.Be=q},w.Li=function(e){this.Sa=e=dh(this,e.target),this.Be=q;if(this.anchor!=e){this.anchor=e;var t=bh(this,1);Zg(this),this.Kb||(this.Kb=Jg(va(this.$g,this,e,t),this.yh)),eh(this)}},w.Lg=function(e){var n=dh(this,e.target),r=dh(this,e.relatedTarget);n!=r&&(n==this.Sa&&(this.Sa=t),$g(this),this.Be=u,this.Ma&&(!e.relatedTarget||!ie(this.t(),e.relatedTarget))?ah(this):this.anchor=p)},w.Ng=function(){var e=this.t();this.Sa!=e&&(Zg(this),this.Sa=e)},w.Mg=function(e){var n=this.t();this.Sa==n&&(!e.relatedTarget||!ie(n,e.relatedTarget))&&(this.Sa=t,ah(this))},C(fh,Og),fh.prototype.tb=function(e,t,n){t=qe(e),t=te(t),n=n?new le(n.top+10,n.right,n.bottom,n.left+10):new le(10,0,0,10),Mg(this.nf,e,4,n,t,9)&496&&Mg(this.nf,e,4,n,t,5)},C(gh,Pg),gh.prototype.tb=function(e,t,n){var r=new Xd(10,0);Lg(this.element,this.Fg,e,t,r,n,9)&496&&Lg(this.element,2,e,1,r,n,5)},C(hh,Wg),hh.prototype.uf=function(){var e=oe(this.ab,"position");if("static"==e||""==e)this.ab.style.position="relative";var e=document.getElementsByTagName("head")[0],t=de("style");t.type="text/css",t.media="screen";var n=document.createTextNode(String(this.fc[0]));e.appendChild(t),t.appendChild(n),this.Fb=t,this.we=new Og(this.fe,this.ge)||p,this.Ma&&this.tb(),Rg(this,q),Xg(this,this.ab),this.t().classList.add("x-tooltip")},hh.prototype.Fd=function(){Rg(this,u),this.Fb&&ge(this.Fb),this.t()&&ge(this.t()),this.Fb=t},C(ih,Kg),ih.prototype.__defineGetter__("config",v("R")),w=ih.prototype,w.Zj=function(){this.md=this.pd=this.ld=this.od=this.kd=this.nd=t,this.z=[0,0,0]},w.If=function(e){ih.u.If.call(this,e);var t=e.fe;e=e.ge;var n=this.Mf(t,e);if(n=this.get(n))if(n=n.Dc){var r=we(this.v);(new hh(this.v,r.x+t+10,r.y+e+10,this.T)).t().innerHTML=n}},w.Ca=function(){ih.u.Ca.call(this,"experimental-webgl");try{if(this.a.viewport(0,0,this.K,this.A),this.a.clearColor(this.bd[0],this.bd[1],this.bd[2],0),this.a.enable(this.a.BLEND),this.a.blendEquation(this.a.FUNC_ADD),this.a.blendFunc(this.a.SRC_ALPHA,this.a.ONE_MINUS_SRC_ALPHA),this.a.enable(this.a.DEPTH_TEST),this.a.depthFunc(this.a.LEQUAL),this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT),this.R.PICKING_ENABLED){var e=this.a.createFramebuffer(),n=this.a.createRenderbuffer(),r=this.a.createTexture();this.a.bindTexture(this.a.TEXTURE_2D,r),this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGB,this.K,this.A,0,this.a.RGB,this.a.UNSIGNED_BYTE,t),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST),this.a.bindFramebuffer(this.a.FRAMEBUFFER,e),this.a.bindRenderbuffer(this.a.RENDERBUFFER,n),this.a.renderbufferStorage(this.a.RENDERBUFFER,this.a.DEPTH_COMPONENT16,this.K,this.A),this.a.bindRenderbuffer(this.a.RENDERBUFFER,t),this.a.framebufferTexture2D(this.a.FRAMEBUFFER,this.a.COLOR_ATTACHMENT0,this.a.TEXTURE_2D,r,0),this.a.framebufferRenderbuffer(this.a.FRAMEBUFFER,this.a.DEPTH_ATTACHMENT,this.a.RENDERBUFFER,n),this.a.bindFramebuffer(this.a.FRAMEBUFFER,t),this.rg=e}}catch(i){m(Error("Exception while accessing GL Context!\n"+i))}e=new df,(this.na==t||this.a==t||this.N==t)&&m(Error("Renderer was not initialized properly.")),(e==t||!(e instanceof df))&&m(Error("Could not add shaders.")),n=Object.keys(ff),Object.keys(ef).every(function(e){return e=ef[e],-1!=this.ce.search(e)||-1!=this.Ud.search(e)}.bind(e))||m(Error("Could not find all attributes in the shader sources.")),n.every(function(e){return e=ff[e],-1!=this.ce.search(e)||-1!=this.Ud.search(e)}.bind(e))||m(Error("Could not find all uniforms in the shader sources.")),n=this.a.createShader(this.a.FRAGMENT_SHADER),r=this.a.createShader(this.a.VERTEX_SHADER),this.a.shaderSource(n,e.Ud),this.a.shaderSource(r,e.ce),this.a.compileShader(n),this.a.compileShader(r),this.a.getShaderParameter(n,this.a.COMPILE_STATUS)||m(Error("Fragement Shader compilation failed!\n"+this.a.getShaderInfoLog(n))),this.a.getShaderParameter(r,this.a.COMPILE_STATUS)||m(Error("Vertex Shader compilation failed!\n"+this.a.getShaderInfoLog(r)));var s=this.a.createProgram();this.a.attachShader(s,r),this.a.attachShader(s,n),this.a.linkProgram(s),this.a.getProgramParameter(s,this.a.LINK_STATUS)||m(Error("Could not create shader program!\n"+this.a.getShaderInfoLog(n)+"\n"+this.a.getShaderInfoLog(r)+"\n"+this.a.getProgramInfoLog(s))),this.a.useProgram(s),this.Ye=s,Object.keys(ef).forEach(function(e){e=ef[e],this.Ie.set(e,this.a.getAttribLocation(this.Ye,e)),this.a.enableVertexAttribArray(this.Ie.get(e))}.bind(this)),Object.keys(ff).forEach(function(e){e=ff[e],this.xd.set(e,this.a.getUniformLocation(this.Ye,e))}.bind(this)),this.Ze=e},w.ub=function(e){ih.u.ub.call(this,e);var n=u;if(e!=t){this.get(e.qa)&&(n=q);var r=e.qa,i=e.h,s=e.n,o=e.pa,a=e.G,f=e.r,l=e.ja,c=e.xa,h=e.e,p=e.F;if(h!=t&&h.r!=t&&h.r.j)this.ub(h);else if(h!=t&&h.j&&this.ub(h),c!=t&&c.r!=t&&c.r.j)this.aa.load(c,e);else if(a!=t&&a.r!=t&&a.r.j)this.aa.load(a,e);else{if(f!=t&&la(f)){if(e.yc==t){n=0,r=f.length;for(n=0;n<r;n++)this.aa.load(f[n],e);return}if(e.yc.xf!=f.length||!e.j)return}else{if(f!=t&&f.j){this.aa.load(e,e);return}if(p!=t&&p.r!=t&&p.r.j){this.aa.load(p,e);return}}if(0<e.c.length){f=e.c,c=f.length;for(h=h=0;h<c;h++)this.ub(f[h])}if(i){for(f=0;this.Xd;)f++,window.console.log("Possible thread lock avoided: "+f);this.Xd=q,c=e instanceof Xe&&e.yb instanceof hf,n&&a!=t&&a.j&&(f=this.oc.get(r),f!=t&&this.a.isBuffer(f.P)&&this.a.deleteBuffer(f.P)),f=t,a!=t&&(!n||a.j?(f=e.nc,f==t&&m(Error("Can not add an object and texture without valid coordinate mapping! Set the textureCoordinateMap!")),h=u,a.Wb&&(h=q),this.a.pixelStorei(this.a.UNPACK_FLIP_Y_WEBGL,h),h=this.a.createTexture(),h.Si=a.ib,this.wd.set(a.qa,h),this.a.bindTexture(this.a.TEXTURE_2D,h),a.Wb?(h=this.a.RGBA,a.hg&&(h=this.a.LUMINANCE,this.a.pixelStorei(this.a.UNPACK_ALIGNMENT,1)),this.a.texImage2D(this.a.TEXTURE_2D,0,h,a.Xe,a.We,0,h,this.a.UNSIGNED_BYTE,a.Wb)):this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGBA,this.a.RGBA,this.a.UNSIGNED_BYTE,h.Si),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,this.a.CLAMP_TO_EDGE),c?(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST)):(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.LINEAR),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.LINEAR)),this.a.bindTexture(this.a.TEXTURE_2D,t),h=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,h),this.a.bufferData(this.a.ARRAY_BUFFER,new Float32Array(f),this.a.STATIC_DRAW),f=new Sd(h,f.length,2),this.oc.set(r,f),a.j=u):f=this.oc.get(r)),jg(this.aa,.1);if(c)this.Xd=u,D.Da(this.f+".update"),jg(this.aa,.9);else{if(!n||i.j||l.j){c=l.Q,a=D.g.ba(c,i.mb,i.nb,i.ob),c=D.g.ba(c,i.jb,i.kb,i.lb);if(this.nd===t||a.x<this.nd)this.nd=a.x;if(this.kd===t||c.x>this.kd)this.kd=c.x;if(this.od===t||a.y<this.od)this.od=a.y;if(this.ld===t||c.y>this.ld)this.ld=c.y;if(this.pd===t||a.d<this.pd)this.pd=a.d;if(this.md===t||c.d>this.md)this.md=c.d;this.z=[(this.nd+this.kd)/2,(this.od+this.ld)/2,(this.pd+this.md)/2],l.j=u}n&&i.j&&(l=this.pc.get(r),l!=t&&this.a.isBuffer(l.P)&&this.a.deleteBuffer(l.P)),l=t,!n||i.j?(l=this.a.createBuffer(),i.Jb(),this.a.bindBuffer(this.a.ARRAY_BUFFER,l),this.a.bufferData(this.a.ARRAY_BUFFER,i.da,this.a.STATIC_DRAW),l=new Sd(l,i.count,3),i.j=u):l=this.pc.get(r),jg(this.aa,.3),n&&s.j&&(a=this.pc.get(r),a!=t&&this.a.isBuffer(a.P)&&this.a.deleteBuffer(a.P)),a=t,!n||s.j?(a=this.a.createBuffer(),s.Jb(),this.a.bindBuffer(this.a.ARRAY_BUFFER,a),this.a.bufferData(this.a.ARRAY_BUFFER,s.da,this.a.STATIC_DRAW),a=new Sd(a,s.count,3),s.j=u):a=this.qd.get(r),jg(this.aa,.3),n&&o&&o.j&&(s=this.Ec.get(r),s!=t&&this.a.isBuffer(s.P)&&this.a.deleteBuffer(s.P)),s=t,o&&(!n||o.j?(o.length!=i.length&&m(Error("Mismatch between points and point colors.")),s=this.a.createBuffer(),o.Jb(),this.a.bindBuffer(this.a.ARRAY_BUFFER,s),this.a.bufferData(this.a.ARRAY_BUFFER,o.da,this.a.STATIC_DRAW),s=new Sd(s,o.count,3),o.j=u):s=this.Ec.get(r)),jg(this.aa,.2),n&&p&&p.j&&(o=this.Pc.get(r),o!=t&&this.a.isBuffer(o.P)&&this.a.deleteBuffer(o.P)),o=t,p&&(o=p.dd,!n||p.j?(o.length!=i.length&&m(Error("Mismatch between points and scalars.")),i=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,i),this.a.bufferData(this.a.ARRAY_BUFFER,o,this.a.STATIC_DRAW),o=new Sd(i,o.length,3),p.j=u):o=this.Pc.get(r)),jg(this.aa,.1),n||this.pb.add(e),this.pc.set(r,l),this.qd.set(r,a),this.Ec.set(r,s),this.oc.set(r,f),this.Pc.set(r,o),this.Xd=e.j=u}}else e.j=u}}},w.Mf=function(e,t){if(this.R.PICKING_ENABLED){this.dc(q,u);var n=new Uint8Array(4);return this.a.readPixels(e,this.A-t,1,1,this.a.RGBA,this.a.UNSIGNED_BYTE,n),n[0]+255*n[1]+65025*n[2]}return-1},w.dc=function(e,n){ih.u.dc.call(this,e,n),this.a.viewport(0,0,this.K,this.A),this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);var r=this.pb.I,i=r.length;if(0!=i){e?this.a.bindFramebuffer(this.a.FRAMEBUFFER,this.rg):this.a.bindFramebuffer(this.a.FRAMEBUFFER,t);var s=this.N.Ve,o=this.N.o;this.a.uniformMatrix4fv(this.xd.get("perspective"),u,s),this.a.uniformMatrix4fv(this.xd.get("view"),u,o),s=this.z,this.a.uniform3f(this.xd.get("center"),parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])),o=this.Ha.length;for(s=0;s<o;++s){var a=this.Ha[s];if(a instanceof P){var f=D.g.ba(this.N.o,a.s[0]+a.b[0].i[0],a.s[1]+a.b[0].i[1],a.s[2]+a.b[0].i[2]),l=D.g.ba(this.N.o,a.s[0]-a.b[0].i[0],a.s[1]-a.b[0].i[1],a.s[2]-a.b[0].i[2]),c=Math.abs(f.d-l.d),f=D.g.ba(this.N.o,a.s[0]+a.b[1].i[0],a.s[1]+a.b[1].i[1],a.s[2]+a.b[1].i[2]),l=D.g.ba(this.N.o,a.s[0]-a.b[1].i[0],a.s[1]-a.b[1].i[1],a.s[2]+ -a.b[1].i[2]),h=Math.abs(f.d-l.d),f=D.g.ba(this.N.o,a.s[0]+a.b[2].i[0],a.s[1]+a.b[2].i[1],a.s[2]+a.b[2].i[2]),l=D.g.ba(this.N.o,a.s[0]-a.b[2].i[0],a.s[1]-a.b[2].i[1],a.s[2]-a.b[2].i[2]),f=Math.max(c,h,Math.abs(f.d-l.d));f==c?gf(a,0):f==h?gf(a,1):gf(a,2)}}if(this.R.ORDERING_ENABLED){c=u,o=this.Ha,a=o.length-1;do if(s=o[a],s instanceof P&&s.Ra&&-1!=s.X){var c=s.c[s.X].c,h=s.X,f=D.g.ba(this.N.o,s.s[0]+s.b[h].B[0],s.s[1]+s.b[h].B[1],s.s[2]+s.b[h].B[2]),l=D.g.ba(this.N.o,s.s[0]-s.b[h].B[0],s.s[1]-s.b[h].B[1],s.s[2]-s.b[h].B[2]),f=f.d-l.d,l=Math.max(s.Cc[s.X],Math.max(s.Cc[s.X+4],s.Cc[s.X+8])),p=Math.min(s.Cc[s.X],Math.min(s.Cc[s.X+4],s.Cc[s.X+8]));if(0>f*(l+p))for(f=f=0;f<s.ud[h]-1;f++)c[f]&&(c[f].za=s.za,c[f].ya=s.b[h].Sc*f);else for(f=s.ud[h]-1;0<=f;f--)c[f]&&(c[f].za=s.za,c[f].ya=(s.ud[h]-1)*s.b[h].Sc-s.b[h].Sc*f);c=q}while(a--);o=this.pb.I,a=o.length-1;do if(s=o[a],s.O&&!(1==s.za||s instanceof Xe))c=s,h=s.h.Rd,s=D.g.ba(s.ja.Q,h[0],h[1],h[2]),s=D.g.ba(this.N.o,s.x,s.y,s.d),s=D.m.rf(this.N.ic,s),s=Math.round(1e3*s)/1e3,c.ya=s,c=q;while(a--);c&&this.pb.sort()}if(o=!e&&n!=t&&n&&this.R.STATISTICS_ENABLED)var d=0;var s=this.Ie,a=s.get("vertexPosition"),c=s.get("vertexNormal"),h=s.get("vertexColor"),f=s.get("vertexTexturePos"),l=s.get("vertexScalar"),s=this.xd,p=s.get("usePicking"),v=s.get("useObjectColor"),m=s.get("objectColor"),g=s.get("useScalars"),y=s.get("scalarsReplaceMode"),b=s.get("scalarsMin"),w=s.get("scalarsMax"),E=s.get("scalarsMinColor"),S=s.get("scalarsMaxColor"),x=s.get("scalarsInterpolation"),T=s.get("scalarsMinThreshold"),N=s.get("scalarsMaxThreshold"),C=s.get("objectOpacity"),k=s.get("labelmapOpacity"),L=s.get("labelmapColor"),A=s.get("useTexture"),O=s.get("useLabelMapTexture"),M=s.get("textureSampler"),_=s.get("textureSampler2"),H=s.get("volumeLowerThreshold"),B=s.get("volumeUpperThreshold"),j=s.get("volumeScalarMin"),F=s.get("volumeScalarMax"),I=s.get("volumeWindowLow"),R=s.get("volumeWindowHigh"),U=s.get("volumeScalarMinColor"),z=s.get("volumeScalarMaxColor"),W=s.get("volumeTexture"),X=s.get("objectTransform"),V=s.get("pointSize"),s=i;do{var $=r[i-s];if($){var J=t;$ instanceof Xe&&$.yb&&(J=$.yb);if($.O&&(!J||J.O)&&(!e||$.rd)){var K=$.qa,Q=$.jd,G=this.pc.get(K),Y=this.qd.get(K),Z=this.Ec.get(K),et=this.Pc.get(K),tt=this.oc.get(K);this.a.bindBuffer(this.a.ARRAY_BUFFER,G.P),this.a.vertexAttribPointer(a,G.Ob,this.a.FLOAT,u,0,0),this.a.bindBuffer(this.a.ARRAY_BUFFER,Y.P),this.a.vertexAttribPointer(c,Y.Ob,this.a.FLOAT,u,0,0),e?this.a.uniform1i(p,q):this.a.uniform1i(p,u),Z&&!e&&!Q?(this.a.uniform1i(v,u),this.a.bindBuffer(this.a.ARRAY_BUFFER,Z.P),this.a.vertexAttribPointer(h,Z.Ob,this.a.FLOAT,u,0,0)):(Y=1,Q&&!e&&(Y=0),this.a.uniform1i(v,Y),Y=$.w,e&&(Y=[Math.floor(K%65025%255)/255,Math.floor(K%65025/255)/255,Math.floor(K/65025)/255]),this.a.uniform3f(m,parseFloat(Y[0]),parseFloat(Y[1]),parseFloat(Y[2])),this.a.vertexAttribPointer(h,G.Ob,this.a.FLOAT,u,0,0)),et&&!e&&!Q?(this.a.uniform1i(g,q),this.a.uniform1i(y,$.F.ug),K=$.F.Rb,Q=$.F.Pb,this.a.uniform3f(E,parseFloat(K[0]),parseFloat(K[1]),parseFloat(K[2])),this.a.uniform3f(S,parseFloat(Q[0]),parseFloat(Q[1]),parseFloat(Q[2])),this.a.uniform1f(T,parseFloat($.F.U)),this.a.uniform1f(N,parseFloat($.F.W)),this.a.uniform1f(b,parseFloat($.F.ra)),this.a.uniform1f(w,parseFloat($.F.ia)),this.a.uniform1i(x,parseInt($.F.Le,10)),this.a.bindBuffer(this.a.ARRAY_BUFFER,et.P),this.a.vertexAttribPointer(l,et.Ob,this.a.FLOAT,u,0,0)):(this.a.uniform1i(g,u),this.a.vertexAttribPointer(l,G.Ob,this.a.FLOAT,u,0,0)),this.a.uniform1f(C,parseFloat($.za)),$.G&&tt&&!e?(this.a.uniform1i(A,q),this.a.activeTexture(this.a.TEXTURE0),this.a.bindTexture(this.a.TEXTURE_2D,this.wd.get($.G.qa)),this.a.uniform1i(M,0),this.a.bindBuffer(this.a.ARRAY_BUFFER,tt.P),this.a.vertexAttribPointer(f,tt.Ob,this.a.FLOAT,u,0,0),this.a.uniform1i(W,u)):(this.a.uniform1i(A,u),this.a.vertexAttribPointer(f,G.Ob,this.a.FLOAT,u,0,0)),J&&(this.a.uniform1i(W,q),this.a.uniform1f(H,J.U),this.a.uniform1f(B,J.W),this.a.uniform1f(j,J.ra),this.a.uniform1f(F,J.ia),K=J.Rb,Q=J.Pb,this.a.uniform3f(U,parseFloat(K[0]),parseFloat(K[1]),parseFloat(K[2])),this.a.uniform3f(z,parseFloat(Q[0]),parseFloat(Q[1]),parseFloat(Q[2])),this.a.uniform1f(I,J.fa),this.a.uniform1f(R,J.ea),et=J.e,this.a.uniform1i(O,u),J.Ra?this.a.uniform1f(C,parseFloat(J.za)):et&&et.O&&(J=$.e.qa,this.a.uniform1i(O,q),this.a.activeTexture(this.a.TEXTURE1),this.a.bindTexture(this.a.TEXTURE_2D,this.wd.get(J)),this.a.uniform1i(_,1),this.a.uniform1f(k,et.za),this.a.uniform4fv(L,et.$e))),this.a.uniformMatrix4fv(X,u,$.ja.Q),J=1,"POINTS"==$.Ia&&(J=$.sd),this.a.uniform1f(V,J),J=-1,$.Ia==id?(J=this.a.TRIANGLES,o&&(d+=G.ed/3)):"LINES"==$.Ia?(this.a.lineWidth($.Lc),J=this.a.LINES):"POINTS"==$.Ia?J=this.a.POINTS:"TRIANGLE_STRIPS"==$.Ia?(J=this.a.TRIANGLE_STRIP,o&&(d+=G.ed/3)):"POLYGONS"==$.Ia&&(J=0==G.ed%3?this.a.TRIANGLES:this.a.TRIANGLE_FAN,o&&(d+=G.ed/3)),this.a.drawArrays(J,0,G.ed)}}}while(--s);o&&Math.round(d)}},w.remove=function(e){ih.u.remove.call(this,e);if(0<e.c.length)for(var n=e.c,r=n.length,i=0,i=0;i<r;i++)"undefined"!=typeof n[i]&&this.remove(n[i]);return n=e.qa,r=this.oc.get(n),r!=t&&this.a.isBuffer(r.P)&&this.a.deleteBuffer(r.P),e.G&&(r=this.wd.get(e.G.qa))&&(this.a.deleteTexture(r),this.wd.remove(e.G.qa)),r=this.pc.get(n),r!=t&&this.a.isBuffer(r.P)&&this.a.deleteBuffer(r.P),r=this.qd.get(n),r!=t&&this.a.isBuffer(r.P)&&this.a.deleteBuffer(r.P),r=this.Ec.get(n),r!=t&&this.a.isBuffer(r.P)&&this.a.deleteBuffer(r.P),r=this.Pc.get(n),r!=t&&this.a.isBuffer(r.P)&&this.a.deleteBuffer(r.P),this.pc.remove(n),this.qd.remove(n),this.Ec.remove(n),this.oc.remove(n),this.Pc.remove(n),this.pb.remove(e),q},w.Ta=function(){this.Ze=t,delete this.Ze,this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT),ih.u.Ta.call(this)},ih.prototype.__defineGetter__("bgColor",v("bd")),ih.prototype.__defineSetter__("bgColor",ca("bd")),ih.prototype.Vj=function(e,n,r,i,s){r!=t||(r=4),i!=t||(i=2);if(s==t){s=this.Mf(e,n);if(-1==s)return t;s=this.get(s);if(!s)return t}var o=Qe(this.N,2*(e/this.K)-1,2*((this.A-n)/this.A)-1,0);e=Qe(this.N,2*(e/this.K)-1,2*((this.A-n)/this.A)-1,1),o[0]+=this.z[0],o[1]+=this.z[1],o[2]+=this.z[2],e[0]+=this.z[0],e[1]+=this.z[1],e[2]+=this.z[2],n=[s.h.mb,s.h.nb,s.h.ob];var u=[s.h.jb,s.h.nb,s.h.ob],a=[s.h.jb,s.h.kb,s.h.ob],f=[s.h.mb,s.h.kb,s.h.ob],l=[s.h.mb,s.h.kb,s.h.lb],c=[s.h.mb,s.h.nb,s.h.lb],h=[s.h.jb,s.h.kb,s.h.lb],p=[s.h.jb,s.h.nb,s.h.lb];n=[D.g.ba(s.ja.Q,n[0],n[1],n[2]),D.g.ba(s.ja.Q,u[0],u[1],u[2]),D.g.ba(s.ja.Q,a[0],a[1],a[2]),D.g.ba(s.ja.Q,f[0],f[1],f[2]),D.g.ba(s.ja.Q,l[0],l[1],l[2]),D.g.ba(s.ja.Q,c[0],c[1],c[2]),D.g.ba(s.ja.Q,h[0],h[1],h[2]),D.g.ba(s.ja.Q,p[0],p[1],p[2])];var u=[Infinity,-Infinity,Infinity,-Infinity,Infinity,-Infinity],d;for(d in n)d=n[d],u=[Math.min(u[0],d.x),Math.max(u[1],d.x),Math.min(u[2],d.y),Math.max(u[3],d.y),Math.min(u[4],d.d),Math.max(u[5],d.d)];d=u,n=[],u=[];for(a=0;6>a;a++){var f=Math.floor(a/2),l=(f+1)%3,c=(f+2)%3,p=(2+2*f)%6,v=(4+2*f)%6,m=(d[a]-o[f])*(1/e[f]);Infinity!=m&&-Infinity!=m&&(h=o[l]+e[l]*m,m=o[c]+e[c]*m,h>=d[p]&&h<=d[p+1]&&m>=d[v]&&m<=d[v+1]?(p=[],p[f]=d[a],p[l]=h,p[c]=m,n.push(p)):(p=[],p[f]=d[a],p[l]=h,p[c]=m,u.push(p)))}e=[n,u],e=e[0];if(0==e.length)return t;u=Array(2);for(d=0;2>d;d++)n=e[d],u[d]=Math.sqrt((n[0]-o[0])*(n[0]-o[0])+(n[1]-o[1])*(n[1]-o[1])+(n[2]-o[2])*(n[2]-o[2]));o=n=d=t,u[0]<u[1]?(d=e[0],n=e[1]):(d=e[1],n=e[0]),o=Math.sqrt((d[0]-n[0])*(d[0]-n[0])+(d[1]-n[1])*(d[1]-n[1])+(d[2]-n[2])*(d[2]-n[2])),o/=r,e=d,d=[n[0]-d[0],n[1]-d[1],n[2]-d[2]],n=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),u=[d[0]/n,d[1]/n,d[2]/n],a=s.h.da,f=a.length;for(d=0;d<o;d+=r){e=[e[0]+r*u[0],e[1]+r*u[1],e[2]+r*u[2]];for(n=0;n<f;n+=3)if(l=a[n],c=a[n+1],h=a[n+2],p=new D.m(l,c,h),p=D.g.ba(s.ja.Q,l,c,h),Math.sqrt((e[0]-p.x)*(e[0]-p.x)+(e[1]-p.y)*(e[1]-p.y)+(e[2]-p.d)*(e[2]-p.d))<=i)return[p.x,p.y,p.d]}return t},A("X.renderer3D",ih),A("X.renderer3D.prototype.init",ih.prototype.Ca),A("X.renderer3D.prototype.add",ih.prototype.add),A("X.renderer3D.prototype.onShowtime",ih.prototype.lh),A("X.renderer3D.prototype.onRender",ih.prototype.jh),A("X.renderer3D.prototype.get",ih.prototype.get),A("X.renderer3D.prototype.render",ih.prototype.cc),A("X.renderer3D.prototype.destroy",ih.prototype.Ta),A("X.renderer3D.prototype.remove",ih.prototype.remove),A("X.renderer3D.prototype.resetBoundingBox",ih.prototype.Zj),A("X.renderer3D.prototype.resetViewAndRender",ih.prototype.Nd),A("X.renderer3D.prototype.pick",ih.prototype.Mf),A("X.renderer3D.prototype.pick3d",ih.prototype.Vj),A("X.renderer3D.prototype.afterRender",ih.prototype.yg),C(jh,Y),A("X.mesh",jh),C(kh,Y),A("X.fibers",kh),C(lh,Kg),w=lh.prototype,w.remove=function(e){return lh.u.remove.call(this,e),this.pb.remove(e),q},w.Gj=aa(),w.Qj=aa(),w.Jf=function(a){lh.u.Jf.call(this,a);var b=this.Ha[0];if(b){var c="",c=0==this.Fa?"indexX":1==this.Fa?"indexY":"indexZ";b[c]=a.V?b[c]+1:b[c]-1,eval("this.onScroll();")}},w.Rj=function(a){var b=this.Ha[0];if(b){var c=b.ea-b.fa,e=c/2,d=parseInt(c+c/15*-a.cf,10);a=parseInt(e+e/15*a.Qe,10),c==d&&d++,e==a&&a++,b.fa-=parseInt(e-a,10),b.fa-=parseInt(c-d,10),b.fa=Math.max(b.fa,b.ra),b.ea-=parseInt(e-a,10),b.ea+=parseInt(c-d,10),b.ea=Math.min(b.ea,b.ia),eval("this.onWindowLevel();")}},lh.prototype.__defineGetter__("orientation",v("Qa")),lh.prototype.__defineSetter__("orientation",function(e){e=e.toUpperCase(),"AXIAL"==e?(e="Z",this.Fa=2):"SAGITTAL"==e?(e="X",this.Fa=0):"CORONAL"==e&&(e="Y",this.Fa=1),"X"!=e&&"Y"!=e&&"Z"!=e&&m(Error("Invalid orientation.")),this.Qa=e}),lh.prototype.__defineGetter__("radiological",v("sg")),lh.prototype.__defineGetter__("normalizedScale",v("xb")),lh.prototype.__defineGetter__("canvasWidth",function(){return this.na.width}),lh.prototype.__defineGetter__("canvasHeight",function(){return this.na.height}),lh.prototype.__defineGetter__("sliceWidth",v("Tc")),lh.prototype.__defineGetter__("sliceHeight",v("Qc")),lh.prototype.__defineSetter__("radiological",ca("sg")),w=lh.prototype,w.Ca=function(){this.Qa||m(Error("No 2D orientation set.")),lh.u.Ca.call(this,"2d"),this.a.fillStyle="rgba(50,50,50,0)",this.a.fillRect(0,0,this.na.width,this.na.height),this.Vd=de("canvas"),this.fd=de("canvas"),this.fd.style.Cl="pixelated",L(this.N,xd,this.Rj.bind(this))},w.ve=function(){lh.u.ve.call(this),ph(this)},w.Nd=function(){lh.u.Nd.call(this),ph(this);var e=this.Ha[0];e&&(e.ea=e.ia,e.fa=e.ra)},w.update=function(e){this.ub(e),this.Je=-1},w.ub=function(e){lh.u.ub.call(this,e);var n=u;this.get(e.qa)&&(n=q);if(e instanceof P){var r=e.r,i=e.e,s=e.xa;if(i!=t&&i.r!=t&&i.r.j)this.ub(i);else if(s!=t&&s.r!=t&&s.r.j)this.aa.load(s,e);else{if(r!=t&&la(r)){if(e.yc==t){n=0,i=r.length;for(n=0;n<i;n++)this.aa.load(r[n],e);return}if(e.yc.xf!=r.length)return}else if(r!=t&&r.j){this.aa.load(e,e);return}this.Fa="X"==this.Qa?0:"Y"==this.Qa?1:2,this.bb=e.c[this.Fa].c,s=t,s=0==this.Fa?e.indexX:1==this.Fa?e.indexY:e.indexZ,r=e.c[this.Fa].c[s].jg,i=e.c[this.Fa].c[s].ig,this.Uc=e.c[this.Fa].c[s].Vc,this.Rc=e.c[this.Fa].c[s].Gc,this.Tc=r,this.Qc=i,s=this.Vd,s.width=r,s.height=i;var o=this.fd;o.width=r,o.height=i,this.fg=s.getContext("2d"),this.kg=o.getContext("2d"),n||(this.pb.add(e),ph(this))}}},w.Hj=aa(),w.Ih=function(e,n){var r=this.Ha[0],i=this.N.o,s=t,o=this.Tc,u=this.Qc,a=t,f=t;if("Y"==this.Qa)s=this.bb[parseInt(r.indexY,10)],a=s.Vc,f=s.Gc,this.Sb[0]="rgba(255,0,0,.3)",this.Sb[1]="rgba(0,0,255,.3)";else if("Z"==this.Qa)s=this.bb[parseInt(r.indexZ,10)],a=s.Vc,f=s.Gc,this.Sb[0]="rgba(255,0,0,.3)",this.Sb[1]="rgba(0,255,0,.3)";else{s=this.bb[parseInt(r.indexX,10)],a=s.Gc,f=s.Vc,this.Sb[0]="rgba(0,255,0,.3)",this.Sb[1]="rgba(0,0,255,.3)";var l=o,o=u,u=l}var c=1*i[12],i=-1*i[13],l=[this.K/2,this.A/2],a=o*a*this.xb,f=u*f*this.xb,h=l[0]-a/2,l=l[1]-f/2,h=h+c*this.xb,l=l+i*this.xb;return e>h&&e<h+a&&n>l&&n<l+f?(c=(e-h)/a*o,i=(n-l)/f*u,f=s.ei[4],"X"==this.Qa?(l=o-c,c=i,i=l):"Y"==this.Qa?c=o-c:"Z"==this.Qa&&(c=o-c,i=u-i),c=s.di+c*s.Vc,i=s.Yh+i*s.Gc,c=Qc(c,i,f,1),o=Rc(),cd(s.Rh,c,o),o=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])],u=Rc(),cd(s.Sh,c,u),s=Math.round((r.b[0].i[0]*u[0]+r.b[0].i[1]*u[1]+r.b[0].i[2]*u[2]+r.b[0].Te)/r.b[0].Sc),s>=r.b[0].p?s=r.b[0].p-1:0>s&&(s=0),c=Math.round((r.b[1].i[0]*u[0]+r.b[1].i[1]*u[1]+r.b[1].i[2]*u[2]+r.b[1].Te)/r.b[1].Sc),c>=r.b[1].p?c=r.b[1].p-1:0>c&&(c=0),i=Math.round((r.b[2].i[0]*u[0]+r.b[2].i[1]*u[1]+r.b[2].i[2]*u[2]+r.b[2].Te)/r.b[2].Sc),i>=r.b[2].p?i=r.b[2].p-1:0>i&&(i=0),[[s,c,i],[o[0],o[1],o[2]],[u[0],u[1],u[2]]]):t},w.dc=function(e,n){lh.u.dc.call(this,e,n);if(0!=this.pb.I.length){var r=this.Ha[0],i=t,i=0==this.Fa?r.indexX:1==this.Fa?r.indexY:r.indexZ,s=this.bb[parseInt(i,10)].jg,o=this.bb[parseInt(i,10)].ig;this.Uc=this.bb[parseInt(i,10)].Vc,this.Rc=this.bb[parseInt(i,10)].Gc,this.Tc=s,this.Qc=o;var a=this.K,f=this.A,l=this.N.o;this.a.save(),this.a.clearRect(-a,-f,2*a,2*f),this.a.restore(),this.xb=Math.max(l[14],1e-4),this.a.setTransform(this.xb,0,0,this.xb,0,0);var c=1*l[12],l=-1*l[13],h=t;r.e&&(h=r.e.$e);var p=this.bb[parseInt(i,10)],d=p.G.Wb,p=p.e,v=t;p&&(v=p.Wb);var m=this.Tc,g=this.Qc,y=this.fg,b=this.kg,w=y.getImageData(0,0,m,g),E=b.getImageData(0,0,m,g),S=w.data,x=E.data,T=S.length,N=r.U,C=r.W,k=r.fa,L=r.ea;if(this.Je!=i||this.U!=N||this.W!=C||this.fa!=k||this.ea!=L||h&&!tg(h,this.lg,0)){var A=this.Vd;A.width=s,A.height=o,A=this.fd,A.width=s,A.height=o,s=0;do{var A=[0,0,0,0],o=[0,0,0,0],O=d[s]/255*(r.ia-r.ra)+r.ra,M=L-k,_=M/2+k,D=0,D=O<_-M/2?0:O>_+M/2?255:255*(O-(_-M/2))/M;O>=N&&O<=C&&(A=new R(r.Rb[0],r.Rb[1],r.Rb[2]),A=(new R(r.Pb[0],r.Pb[1],r.Pb[2])).scale(D).add(A.scale(255-D)),A=[Math.floor(A.x),Math.floor(A.y),Math.floor(A.d),255],p&&(-255==h[3]?o=[v[s],v[s+1],v[s+2],v[s+3]]:tg(h,v,s)&&(o=[v[s],v[s+1],v[s+2],v[s+3]]))),"X"==this.Qa?(S[s]=A[0],S[s+1]=A[1],S[s+2]=A[2],S[s+3]=A[3],x[s]=o[0],x[s+1]=o[1],x[s+2]=o[2],x[s+3]=o[3]):"Y"==this.Qa?(D=Math.floor(s/(4*m)),D=4*D*m+(4*(m-1)-(s-4*D*m)),S[D]=A[0],S[D+1]=A[1],S[D+2]=A[2],S[D+3]=A[3],x[D]=o[0],x[D+1]=o[1],x[D+2]=o[2],x[D+3]=o[3]):(D=T-1-s,S[D-3]=A[0],S[D-2]=A[1],S[D-1]=A[2],S[D]=A[3],x[D-3]=o[0],x[D-2]=o[1],x[D-1]=o[2],x[D]=o[3]),s+=4}while(s<T);y.putImageData(w,0,0),b.putImageData(E,0,0),this.Je=i,this.U=N,this.W=C,this.fa=k,this.ea=L,p&&(this.lg=h)}this.a.globalAlpha=1,this.a.translate(a/2/this.xb,f/2/this.xb),"X"==this.Qa&&(this.a.rotate(.5*Math.PI),i=c,c=l,l=-i),c=-m*this.Uc/2+c,l=-g*this.Rc/2+l,this.a.drawImage(this.Vd,c,l,m*this.Uc,g*this.Rc),p&&r.e.O&&(this.a.globalAlpha=1,this.a.drawImage(this.fd,c,l,m*this.Uc,g*this.Rc));if(this.R.SLICENAVIGATORS)if(this.na.style.cursor="none",this.T.Yd&&this.T.wg&&!this.T.wb){if(c=this.T.ua,c=this.Ih(c[0],c[1]))r.Cb=c[0][0],r.Db=c[0][1],r.Eb=c[0][2],r.q(u),this.onSliceNavigation(),this.a.setTransform(1,0,0,1,0,0),this.a.beginPath(),this.a.moveTo(this.T.ua[0],0),this.a.lineTo(this.T.ua[0],this.T.ua[1]-1),this.a.moveTo(this.T.ua[0],this.T.ua[1]+1),this.a.lineTo(this.T.ua[0],this.A),this.a.strokeStyle=this.Sb[0],this.a.stroke(),this.a.closePath(),this.a.beginPath(),this.a.moveTo(0,this.T.ua[1]),this.a.lineTo(this.T.ua[0]-1,this.T.ua[1]),this.a.moveTo(this.T.ua[0]+1,this.T.ua[1]),this.a.lineTo(this.K,this.T.ua[1]),this.a.strokeStyle=this.Sb[1],this.a.stroke(),this.a.closePath(),this.a.font="10pt Arial",this.a.textAlign="left",this.a.textBaseline="top",this.a.fillStyle="white",this.a.fillText("RAS: "+c[2][0].toFixed(2)+", "+c[2][1].toFixed(2)+", "+c[2][2].toFixed(2),0,0),m=p=l="undefined","undefined"!=typeof r.$[c[1][2].toFixed(0)]&&"undefined"!=typeof r.$[c[1][2].toFixed(0)][c[1][1].toFixed(0)]&&(l=r.$[c[1][2].toFixed(0)][c[1][1].toFixed(0)][c[1][0].toFixed(0)],r.L&&(p=r.e.$[c[1][2].toFixed(0)][c[1][1].toFixed(0)][c[1][0].toFixed(0)],r.e.cd&&(m=r.e.cd.get(p),"undefined"!=typeof m&&(m=m[0])))),this.a.fillText("Background:  "+l+" ("+c[1][0].toFixed(0)+", "+c[1][1].toFixed(0)+", "+c[1][2].toFixed(0)+")",0,15),r.L&&this.a.fillText("Labelmap:  "+m+" ("+p+")",0,30)}else this.na.style.cursor="default"}},A("X.renderer2D",lh),A("X.renderer2D.prototype.init",lh.prototype.Ca),A("X.renderer2D.prototype.add",lh.prototype.add),A("X.renderer2D.prototype.onShowtime",lh.prototype.lh),A("X.renderer2D.prototype.onRender",lh.prototype.jh),A("X.renderer2D.prototype.onScroll",lh.prototype.Gj),A("X.renderer2D.prototype.onWindowLevel",lh.prototype.Qj),A("X.renderer2D.prototype.get",lh.prototype.get),A("X.renderer2D.prototype.resetViewAndRender",lh.prototype.Nd),A("X.renderer2D.prototype.xy2ijk",lh.prototype.Ih),A("X.renderer2D.prototype.render",lh.prototype.cc),A("X.renderer2D.prototype.destroy",lh.prototype.Ta),A("X.renderer2D.prototype.onSliceNavigation",lh.prototype.Hj),A("X.renderer2D.prototype.afterRender",lh.prototype.yg),define("xtk",function(){}),define("viewerjs",["jquery_ui","dicomParser","xtk"],function(){var e=e||{};return e.Viewer=function(e,t){this.version=0,this.wholeContID=t,this.toolbarContID=this.wholeContID+"_toolbar",this.thumbnailbarContID=this.wholeContID+"_thumbnailbar",this.rendersContID=this.wholeContID+"_renders",this.renders2D=[],this.rendersLinked=!1,this.maxNumOfRenders=4,this.numOfRenders=0,this.imgFileArr=[],this.init(e)},e.Viewer.prototype.init=function(t){function u(){var e,t,u,a;for(var f in i)o.imgFileArr.push({baseUrl:f,imgType:"dicom",files:i[f].sort(function(e,t){var n=[e.name,t.name].sort();return n[0]===n[1]?0:n[0]===e.name?-1:1})});for(u=0;u<s.length;u++)o.imgFileArr.push(s[u]);for(u=0;u<o.imgFileArr.length;u++)o.imgFileArr[u].id=u;for(var l in n)for(u=0;u<o.imgFileArr.length;u++){a=0;do e=o.imgFileArr[u].baseUrl+o.imgFileArr[u].files[a].name,t=e.substring(0,e.lastIndexOf("."));while(++a<o.imgFileArr[u].files.length&&l!==t);if(l===t){o.imgFileArr[u].thumbnail=n[l];break}}for(var c in r)for(u=0;u<o.imgFileArr.length;u++){a=0;do e=o.imgFileArr[u].baseUrl+o.imgFileArr[u].files[a].name,t=e.substring(0,e.lastIndexOf("."));while(++a<o.imgFileArr[u].files.length&&c!==t);if(c===t){o.imgFileArr[u].json=r[c];break}}}function a(t){var o=t.url,u=o.substring(0,o.lastIndexOf("/")+1),a,f,l;t.file?a=t.file:a={name:o.substring(o.lastIndexOf("/")+1),url:o,remote:!0},f=e.Viewer.imgType(a),f==="dicom"?(i[u]||(i[u]=[]),i[u].push(a)):f==="thumbnail"?(l=o.indexOf("-",o.lastIndexOf("/")),l===-1?n[o.substring(0,o.lastIndexOf("."))]=a:n[o.substring(0,l)]=a):f==="json"?r[o.substring(0,o.lastIndexOf("."))]=a:f!=="unsupported"&&s.push({baseUrl:o.substring(0,o.lastIndexOf("/")+1),imgType:f,files:[a]})}var n={},r={},i={},s=[],o=this;this._initInterface();for(var f=0;f<t.length;f++)a(t[f]);u();for(f=0;f<this.imgFileArr.length;f++)if(this.imgFileArr[f].imgType==="vol"||this.imgFileArr[f].imgType==="dicom"){this.add2DRender(this.imgFileArr[f],"Z");break}},e.Viewer.prototype._initInterface=function(){var e=this;$("#"+this.wholeContID).css({position:"relative",margin:0,"-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}).append('<div id="'+this.rendersContID+'" class="view-renders '+this.wholeContID+'-sortable"></div>');var t={cursor:"move",distance:"60",containment:"#"+this.wholeContID,appendTo:"#"+this.thumbnailbarContID,connectWith:"."+this.wholeContID+"-sortable",dropOnEmpty:!0,helper:function(t,n){var r=$(".view-thumbnail").css("width"),i=$(".view-thumbnail").css("height"),s=n.attr("id"),o=s.replace(e.rendersContID+"_render2D",e.thumbnailbarContID+"_th");return $("#"+o).clone().css({display:"block",width:r,height:i})},start:function(){$("#"+e.thumbnailbarContID).css({overflow:"visible"})},beforeStop:function(t,n){var r,i;n.placeholder.parent().attr("id")===e.thumbnailbarContID&&($(this).sortable("cancel"),r=n.item.attr("id"),i=r.replace(e.rendersContID+"_render2D",e.thumbnailbarContID+"_th"),$("#"+i).css({display:"block"}),e.remove2DRender(r)),$("#"+e.thumbnailbarContID).css({overflow:"auto"})}};$("#"+this.rendersContID).sortable(t)},e.Viewer.prototype.add2DRender=function(t,n){function f(n,s){var o=new FileReader;o.onload=function(){u[s]=o.result,++a;if(a===t.files.length){if(t.imgType==="dicom"){var n=new Uint8Array(u[0]);try{var f=dicomParser.parseDicom(n);t.dicomInfo={patientName:f.string("x00100010"),patientId:f.string("x00100020"),patientBirthDate:f.string("x00100030"),patientAge:f.string("x00101010"),patientSex:f.string("x00100040"),seriesDescription:f.string("x0008103e"),manufacturer:f.string("x00080070"),studyDate:f.string("x00080020")}}catch(l){console.log("Could not parse dicom "+t.baseUrl+" Error - "+l)}}i.filedata=u,r.add(i),r.render(),e.documentRepaint()}},n.remote?e.urlToBlob(n.url,function(e){o.readAsArrayBuffer(e)}):o.readAsArrayBuffer(n)}var r,i,s,o=this;s=this.rendersContID+"_render2D"+t.id,$("#"+this.rendersContID).append('<div id="'+s+'" class="view-render">'+'<div class="view-render-info view-render-info-topleft"></div>'+'<div class="view-render-info view-render-info-topright"></div>'+'<div class="view-render-info view-render-info-bottomright"></div>'+'<div class="view-render-info view-render-info-bottomleft"></div>'+"</div>"),++this.numOfRenders,this.positionRenders(),r=this.create2DRender(s,n),this.onRender2DScroll=function(e){var t;for(t=0;t<o.renders2D.length;t++)o.renders2D[t].interactor===this&&$(".view-render-info-bottomleft",$(o.renders2D[t].container)).html("slice: "+(o.renders2D[t].volume.indexZ+1)+"/"+o.renders2D[t].volume.range[2]);if(o.rendersLinked&&!e.detail){e.detail=!0;for(t=0;t<o.renders2D.length;t++)o.renders2D[t].interactor!==e.target&&o.renders2D[t].interactor.dispatchEvent(e)}},r.interactor.addEventListener(X.event.events.SCROLL,this.onRender2DScroll),r.onShowtime=function(){function n(e){var t=$("#"+s),n="",r="",o="";e.patientAge&&(n="AGE: "+e.patientAge+"<br>"),$(".view-render-info-topleft",t).html(e.patientName+"<br>"+e.patientId+"<br>"+"BIRTHDATE: "+e.patientBirthDate+"<br>"+n+"SEX: "+e.patientSex),$(".view-render-info-topright",t).html("SERIES: "+e.seriesDescription+"<br>"+e.manufacturer+"<br>"+e.studyDate+"<br>"+e.dimensions+"<br>"+e.voxelSizes),e.orientation&&(r=e.orientation+"<br>"),e.primarySliceDirection&&(o=e.primarySliceDirection),$(".view-render-info-bottomright",t).html(r+o),$(".view-render-info-bottomleft",t).html("slice: "+(i.indexZ+1)+"/"+i.range[2])}function r(t,n){var r=new FileReader;r.onload=function(){n(JSON.parse(r.result))},t.remote?e.urlToBlob(t.url,function(e){r.readAsText(e)}):r.readAsText(t)}if(t.json)r(t.json,function(e){var t={patientName:e.PatientName,patientId:e.PatientID,patientBirthDate:e.PatientBirthDate,patientSex:e.PatientSex,seriesDescription:e.SeriesDescription,manufacturer:e.Manufacturer,studyDate:e.StudyDate,orientation:e.mri_info.orientation,primarySliceDirection:e.mri_info.primarySliceDirection,dimensions:e.mri_info.dimensions,voxelSizes:e.mri_info.voxelSizes};n(t)});else if(t.dicomInfo){var o=t.dicomInfo;o.dimensions=i.range[0]+" x "+i.range[1]+" x "+i.range[2],o.voxelSizes=i.spacing[0].toPrecision(4)+", "+i.spacing[1].toPrecision(4)+", "+i.spacing[2].toPrecision(4),n(o)}else $(".view-render-info-bottomleft",$("#"+s)).html("slice: "+(i.indexZ+1)+"/"+i.range[2])},i=this.createVolume(t),r.volume=i,this.renders2D.push(r);var u=[],a=0;for(var l=0;l<t.files.length;l++)f(t.files[l],l)},e.Viewer.prototype.remove2DRender=function(t){for(var n=0;n<this.renders2D.length;n++)if($(this.renders2D[n].container).attr("id")===t){this.renders2D[n].remove(this.renders2D[n].volume),this.renders2D[n].volume.destroy(),this.renders2D[n].interactor.removeEventListener(X.event.events.SCROLL,this.onRender2DScroll),this.renders2D[n].destroy(),this.renders2D.splice(n,1),$("#"+t).remove(),--this.numOfRenders,this.positionRenders(),e.documentRepaint();break}},e.Viewer.prototype.create2DRender=function(e,t){var n;return n=new X.renderer2D,n.container=e,n.bgColor=[.2,.2,.2],n.orientation=t,n.init(),n},e.Viewer.prototype.createVolume=function(e){var t=[],n;for(var r=0;r<e.files.length;r++)t[r]=e.files[r].name;return n=new X.volume,n.reslicing="false",n.file=t.sort().map(function(t){return e.baseUrl+t}),n},e.Viewer.prototype.positionRenders=function(){var e=$("div.view-render",$("#"+this.rendersContID));switch(this.numOfRenders){case 1:e.css({width:"100%",height:"100%",top:0,left:0});break;case 2:e.css({width:"50%",height:"100%",top:0,left:0}),e[1].style.left="50%";break;case 3:e.css({width:"50%",height:"50%"}),e[0].style.top=0,e[0].style.left=0,e[1].style.top=0,e[1].style.left="50%",e[2].style.top="50%",e[2].style.left=0,e[2].style.width="100%";break;case 4:e.css({width:"50%",height:"50%"}),e[0].style.top=0,e[0].style.left=0,e[1].style.top=0,e[1].style.left="50%",e[2].style.top="50%",e[2].style.left=0,e[3].style.top="50%",e[3].style.left="50%"}},e.Viewer.prototype.addToolBar=function(){var e=this;if($("#"+this.toolbarContID).length)return;$("#"+this.wholeContID).append('<div id="'+this.toolbarContID+'" class="view-toolbar">'+'<button id="'+this.toolbarContID+'_buttonlink" class="view-toolbar-button" type="button" title="Link views">Link views</button>'+"<div>");var t=$("#"+this.toolbarContID),n=parseInt(t.css("top"))+parseInt(t.css("height"))+5;$("#"+this.rendersContID).css({height:"calc(100% - "+n+"px)"});if($("#"+this.thumbnailbarContID).length){var r=$("#"+this.thumbnailbarContID),i=parseInt(r.css("left"))+parseInt(r.css("width"))+5;t.css({width:"calc(100% - "+i+"px)"})}$("#"+this.toolbarContID+"_buttonlink").click(function(){e.rendersLinked?(e.rendersLinked=!1,$(this).text("Link views")):(e.rendersLinked=!0,$(this).text("Unlink views"))})},e.Viewer.prototype.addThumbnailBar=function(){function s(n){function f(){var r=new FileReader;r.onload=function(){u.attr("src",r.result),$("#"+t.rendersContID+"_render2D"+a).length&&o.css({display:"none"})},n.thumbnail.remote?e.urlToBlob(n.thumbnail.url,function(e){r.readAsDataURL(e)}):r.readAsDataURL(n.thumbnail)}function l(){function v(t,a){var h=new FileReader;h.onload=function(){r[a]=h.result,++f;if(f===n.files.length){if(n.imgType==="dicom"){var e=new Uint8Array(r[0]);try{var t=dicomParser.parseDicom(e);s=t.string("x0008103e"),i=s.substr(0,10),u.attr("title",s),$(".view-thumbnail-info",o).text(i)}catch(p){console.log("Could not parse dicom "+n.baseUrl+" Error - "+p)}}l.filedata=r,c.add(l),c.render()}},t.remote?e.urlToBlob(t.url,function(e){h.readAsArrayBuffer(e)}):h.readAsArrayBuffer(t)}var r=[],f=0,l=t.createVolume(n),c,h=o.attr("id")+"_temp",p=u.css("width"),d=u.css("height");u.css({display:"none"}),o.prepend('<div id="'+h+'"></div>'),$("#"+h).css({width:p,height:d}),c=t.create2DRender(h,"Z"),c.afterRender=function(){var n=$("#"+h+" > canvas")[0],r=u[0],i=new FileReader;i.onload=function(){r.src=i.result,c.remove(l),l.destroy(),$("#"+h).remove(),c.destroy(),u.css({display:"block"}),$("#"+t.rendersContID+"_render2D"+a).length&&o.css({display:"none"})},i.readAsDataURL(e.dataURItoJPGBlob(n.toDataURL("image/jpeg")))};for(var m=0;m<n.files.length;m++)v(n.files[m],m)}var r,i,s,o,u,a=n.id;n.thumbnail?r=n.thumbnail.name:n.imgType!=="dicom"?r=n.files[0].name:(r="",s="",i=""),r&&(r.lastIndexOf("-")!==-1?(s=r.substring(0,r.lastIndexOf(".")),s=s.substring(s.lastIndexOf("-")+1),i=s.substr(0,10)):(s=r,i=r.substring(0,r.lastIndexOf(".")).substr(-10))),$("#"+t.thumbnailbarContID).append('<div id="'+t.thumbnailbarContID+"_th"+a+'" class="view-thumbnail">'+'<img class="view-thumbnail-img" title="'+s+'">'+'<div class="view-thumbnail-info">'+i+"</div>"+"</div>"),o=$("#"+t.thumbnailbarContID+"_th"+a),u=$(".view-thumbnail-img",o),n.thumbnail?f():l()}var t=this;if(this.imgFileArr.length<2)return;if($("#"+this.thumbnailbarContID).length)return;$("#"+this.wholeContID).append('<div id="'+this.thumbnailbarContID+'" class="view-thumbnailbar '+this.wholeContID+'-sortable"></div>');var n={cursor:"move",containment:"#"+this.wholeContID,helper:"clone",appendTo:"#"+this.rendersContID,connectWith:"."+this.wholeContID+"-sortable",dropOnEmpty:!0,beforeStop:function(e,n){if(n.placeholder.parent().attr("id")===t.rendersContID){$(this).sortable("cancel");if(t.numOfRenders<t.maxNumOfRenders){var r=parseInt(n.item.css({display:"none"}).attr("id").replace(t.thumbnailbarContID+"_th",""));t.add2DRender(t.getImgFileObject(r),"Z")}else alert("Reached maximum number of renders allow which is 4. You must drag a render out of the viewer window and drop it into the thumbnails bar to make a render available")}}};$("#"+this.thumbnailbarContID).sortable(n);var r=$("#"+this.thumbnailbarContID),i=parseInt(r.css("left"))+parseInt(r.css("width"))+5;$("#"+this.rendersContID).css({width:"calc(100% - "+i+"px)"}),$("#"+this.toolbarContID).length&&$("#"+this.toolbarContID).css({width:"calc(100% - "+i+"px)"});for(var o=0;o<this.imgFileArr.length;o++)s(this.imgFileArr[o])},e.Viewer.prototype.destroy=function(){for(var e=0;e<this.renders2D.length;e++)this.remove2DRender($(this.renders2D[e].container).attr("id"));$("#"+this.wholeContID).empty()},e.Viewer.prototype.getImgFileObject=function(e){return this.imgFileArr[e]},e.Viewer.imgType=function(t){var n={},r;return n.DICOM=[".dcm",".ima",".DCM",".IMA"],n.VOL=[".mgh",".mgz",".nrrd",".nii",".nii.gz"],n.FIBERS=[".trk"],n.MESH=["obj","vtk","stl"],n.THUMBNAIL=["png","gif","jpg"],n.JSON=["json"],e.strEndsWith(t.name,n.DICOM)?r="dicom":e.strEndsWith(t.name,n.VOL)?r="vol":e.strEndsWith(t.name,n.FIBERS)?r="fibers":e.strEndsWith(t.name,n.MESH)?r="mesh":e.strEndsWith(t.name,n.THUMBNAIL)?r="thumbnail":e.strEndsWith(t.name,n.JSON)?r="json":r="unsupported",r},e.strEndsWith=function(e,t){var n;for(var r=0;r<t.length;r++){n=e.lastIndexOf(t[r]);if(n!==-1&&e.length-n===t[r].length)return!0}return!1},e.dataURItoJPGBlob=function(e){var t=atob(e.split(",")[1]),n=[];for(var r=0;r<t.length;r++)n.push(t.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})},e.urlToBlob=function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){t(n.response)},n.send()},e.documentRepaint=function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},e}),define("mi2b2",["viewerjs"],function(e){var t=t||{};return t.App=function(){this.views=[],this.nviews=0;var t=this;this.tabs=$("#tabs").tabs({activate:function(){e.documentRepaint()}}),this.tabs.delegate("span.ui-icon-close","click",function(){var e=$(this).closest("li").remove().attr("aria-controls"),n=e.length,r=parseInt(parseInt(e.charAt(n-2))?e.substr(n-2):e.charAt(n-1));t.views[r].destroy(),t.views[r]=null,t.nviews--,$("#"+e).remove(),t.tabs.tabs("refresh")});var n=document.getElementById("dirbtn");n.onchange=function(e){var n=e.target.files,r;t.changeUIonDataLoad("loading"),t.init(),t._totalNumFiles=n.length;for(var i=0;i<t._totalNumFiles;i++)r=n[i],"webkitRelativePath"in r?r.fullPath=r.webkitRelativePath:"fullPath"in r||(r.fullPath=r.name),t.add(r)};var r=document.getElementById("tabload");r.ondragenter=function(e){e.preventDefault()},r.ondragover=function(e){e.preventDefault()},r.ondrop=function(e){function o(e){function u(){s[r]=1;for(var e=0;e<s.length;e++)if(s[e]===0)break;if(e>=s.length){t._totalNumFiles=n.length;for(var i=0;i<t._totalNumFiles;i++)t.add(n[i])}}function a(e){e.readEntries(function(t){if(t.length)i=i.concat(t),a(e);else{var n=i.length;while(n--)o(i[n]);u()}})}var r=s.length,i=[];s[r]=0;if(e.isFile)e.file(function(t){t.fullPath=e.fullPath,n.push(t),u()});else if(e.isDirectory){var f=e.createReader();a(f)}}var n=[],r,i;e.preventDefault(),t.changeUIonDataLoad("loading"),t.init();if(!e.dataTransfer.items){if(e.dataTransfer.files){n=e.dataTransfer.files,t._totalNumFiles=n.length;for(i=0;i<t._totalNumFiles;i++)r=n[i],"fullPath"in r||(r.fullPath=r.name),t.add(r)}else alert("Unsuported browser");return}var s=[];for(i=0;i<e.dataTransfer.items.length;i++)o(e.dataTransfer.items[i].webkitGetAsEntry())}},t.App.prototype.init=function(){this._imgFileArr=[],this._numFiles=0,this._totalNumFiles=0},t.App.prototype.add=function(e){this._imgFileArr.push({url:e.fullPath,file:e}),++this._numFiles,this._numFiles===this._totalNumFiles&&this.createView()},t.App.prototype.createView=function(){var t,n=this.views.length,r="tabviewer"+n,i="viewer"+n;$("div#tabs ul").append('<li><a href="#'+r+'">'+"Viewer"+(n+1)+'</a><span class="ui-icon ui-icon-close" role=presentation>Remove Tab</span></li>'),$("div#tabs").append('<div id="'+r+'"></div>'),$("div#tabs").tabs("refresh"),$("#"+r).append('<div id="'+i+'" class="viewer-container">'),t=new e.Viewer(this._imgFileArr,i),t.addThumbnailBar(),t.addToolBar(),this.views.push(t),++this.nviews,this.changeUIonDataLoad("loaded"),$("#tabs").tabs("option","active",this.nviews)},t.App.prototype.changeUIonDataLoad=function(e){var t=$(".directory-btn");e==="loading"?t.text("Loading..."):e==="loaded"&&t.text("Drop files (or click)")},t});